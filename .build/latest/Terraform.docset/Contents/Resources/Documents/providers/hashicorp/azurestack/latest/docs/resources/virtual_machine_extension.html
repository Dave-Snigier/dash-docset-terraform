<html><!-- Online page at https://registry.terraform.io/providers/hashicorp/azurestack/latest/docs/resources/virtual_machine_extension --><head>
                <title>azurestack_virtual_machine_extension</title>
                <meta charset="utf-8"/>
                <link href="../../../../../../style.css" rel="stylesheet"/>
            </head>
            <body>
                <h1 id="azurestack_virtual_machine_extension">azurestack_virtual_machine_extension</h1>

<p>Creates a new Virtual Machine Extension to provide post deployment configuration
and run automated tasks.</p>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>Please Note</em>
    <p>The CustomScript extensions for Linux &amp; Windows require that the <code>commandToExecute</code> returns a <code>0</code> exit code to be classified as successfully deployed. You can achieve this by appending <code>exit 0</code> to the end of your <code>commandToExecute</code>.</p>
</aside>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Example%20Usage"></a><h2 id="example-usage">Example Usage</h2>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"azurestack_resource_group"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"acctestrg"</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"West US"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurestack_virtual_network"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"acctvn"</span><span class="w"></span>
<span class="w">  </span><span class="na">address_space</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"10.0.0.0/16"</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">"West US"</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurestack_resource_group.test.name</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurestack_subnet"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">"acctsub"</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">azurestack_resource_group.test.name</span><span class="w"></span>
<span class="w">  </span><span class="na">virtual_network_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurestack_virtual_network.test.name</span><span class="w"></span>
<span class="w">  </span><span class="na">address_prefix</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"10.0.2.0/24"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurestack_network_interface"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"acctni"</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">"West US"</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurestack_resource_group.test.name</span><span class="w"></span>

<span class="w">  </span><span class="nb">ip_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">name</span><span class="w">                          </span><span class="o">=</span><span class="w"> </span><span class="s2">"testconfiguration1"</span><span class="w"></span>
<span class="w">    </span><span class="na">subnet_id</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">azurestack_subnet.test.id</span><span class="w"></span>
<span class="w">    </span><span class="na">private_ip_address_allocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dynamic"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurestack_storage_account"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">"accsa"</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">azurestack_resource_group.test.name</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">"westus"</span><span class="w"></span>
<span class="w">  </span><span class="na">account_tier</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">"Standard"</span><span class="w"></span>
<span class="w">  </span><span class="na">account_replication_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"LRS"</span><span class="w"></span>

<span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"staging"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurestack_storage_container"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">"vhds"</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">azurestack_resource_group.test.name</span><span class="w"></span>
<span class="w">  </span><span class="na">storage_account_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">azurestack_storage_account.test.name</span><span class="w"></span>
<span class="w">  </span><span class="na">container_access_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"private"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurestack_virtual_machine"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">"acctvm"</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">"West US"</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">azurestack_resource_group.test.name</span><span class="w"></span>
<span class="w">  </span><span class="na">network_interface_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">azurestack_network_interface.test.id</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">vm_size</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">"Standard_A0"</span><span class="w"></span>

<span class="w">  </span><span class="nb">storage_image_reference</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">publisher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Canonical"</span><span class="w"></span>
<span class="w">    </span><span class="na">offer</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"UbuntuServer"</span><span class="w"></span>
<span class="w">    </span><span class="na">sku</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"16.04-LTS"</span><span class="w"></span>
<span class="w">    </span><span class="na">version</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"latest"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">storage_os_disk</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">"myosdisk1"</span><span class="w"></span>
<span class="w">    </span><span class="na">vhd_uri</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"${azurestack_storage_account.test.primary_blob_endpoint}${azurestack_storage_container.test.name}/myosdisk1.vhd"</span><span class="w"></span>
<span class="w">    </span><span class="na">caching</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"ReadWrite"</span><span class="w"></span>
<span class="w">    </span><span class="na">create_option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"FromImage"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">os_profile</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">computer_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"hostname"</span><span class="w"></span>
<span class="w">    </span><span class="na">admin_username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"testadmin"</span><span class="w"></span>
<span class="w">    </span><span class="na">admin_password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Password1234!"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">os_profile_linux_config</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">disable_password_authentication</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"staging"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurestack_virtual_machine_extension"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">"hostname"</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">"West US"</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">azurestack_resource_group.test.name</span><span class="w"></span>
<span class="w">  </span><span class="na">virtual_machine_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurestack_virtual_machine.test.name</span><span class="w"></span>
<span class="w">  </span><span class="na">publisher</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">"Microsoft.Azure.Extensions"</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">"CustomScript"</span><span class="w"></span>
<span class="w">  </span><span class="na">type_handler_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2.0"</span><span class="w"></span>

<span class="w">  </span><span class="na">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="dl">SETTINGS</span><span class="sh"></span>
<span class="sh">    {</span>
<span class="sh">        "commandToExecute": "hostname &amp;&amp; uptime"</span>
<span class="sh">    }</span>
<span class="dl">SETTINGS</span>

<span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Production"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Argument%20Reference"></a><h2 id="argument-reference">Argument Reference</h2>

<p>The following arguments are supported:</p>

<ul>
<li><p><code>name</code> - (Required) The name of the virtual machine extension peering. Changing
this forces a new resource to be created.</p></li>
<li><p><code>location</code> - (Required) The location where the extension is created. Changing
this forces a new resource to be created.</p></li>
<li><p><code>resource_group_name</code> - (Required) The name of the resource group in which to
create the virtual network. Changing this forces a new resource to be
created.</p></li>
<li><p><code>virtual_machine_name</code> - (Required) The name of the virtual machine. Changing
this forces a new resource to be created.</p></li>
<li><p><code>publisher</code> - (Required) The publisher of the extension, available publishers
can be found by using the Azure CLI.</p></li>
<li><p><code>type</code> - (Required) The type of extension, available types for a publisher can
be found using the Azure CLI.</p></li>
</ul>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>The <code>Publisher</code> and <code>Type</code> of Virtual Machine Extensions can be found using the Azure CLI, via: <code>shell $ az vm extension image list --location westus -o table</code></p>
</aside>

<ul>
<li><p><code>type_handler_version</code> - (Required) Specifies the version of the extension to
use, available versions can be found using the Azure CLI.</p></li>
<li><p><code>auto_upgrade_minor_version</code> - (Optional) Specifies if the platform deploys
the latest minor version update to the <code>type_handler_version</code> specified.</p></li>
<li><p><code>settings</code> - (Required) The settings passed to the extension, these are
specified as a JSON object in a string.</p></li>
</ul>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>Please Note</em>
    <p>Certain VM Extensions require that the keys in the <code>settings</code> block are case sensitive. If you're seeing unhelpful errors, please ensure the keys are consistent with how Azure is expecting them (for instance, for the <code>JsonADDomainExtension</code> extension, the keys are expected to be in <code>TitleCase</code>.)</p>
</aside>

<ul>
<li><code>protected_settings</code> - (Optional) The protected_settings passed to the
extension, like settings, these are specified as a JSON object in a string.</li>
</ul>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>Please Note</em>
    <p>Certain VM Extensions require that the keys in the <code>protected_settings</code> block are case sensitive. If you're seeing unhelpful errors, please ensure the keys are consistent with how Azure is expecting them (for instance, for the <code>JsonADDomainExtension</code> extension, the keys are expected to be in <code>TitleCase</code>.)</p>
</aside>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Attributes%20Reference"></a><h2 id="attributes-reference">Attributes Reference</h2>

<p>The following attributes are exported:</p>

<ul>
<li><code>id</code> - The Virtual Machine Extension ID.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Import"></a><h2 id="import">Import</h2>

<p>Virtual Machine Extensions can be imported using the <code>resource id</code>, e.g.</p>

<div class="codehilite"><pre><span></span><code>terraform import azurestack_virtual_machine_extension.test /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/mygroup1/providers/Microsoft.Compute/virtualMachines/myVM/extensions/hostname
</code></pre></div>

            
        
    </body></html>