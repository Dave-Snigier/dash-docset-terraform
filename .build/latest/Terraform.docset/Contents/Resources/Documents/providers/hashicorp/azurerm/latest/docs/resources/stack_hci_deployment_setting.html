<html><!-- Online page at https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/stack_hci_deployment_setting --><head>
                <title>azurerm_stack_hci_deployment_setting</title>
                <meta charset="utf-8"/>
                <link href="../../../../../../style.css" rel="stylesheet"/>
            </head>
            <body>
                <h1 id="azurerm_stack_hci_deployment_setting">azurerm_stack_hci_deployment_setting</h1>

<p>Manages a Stack HCI Deployment Setting.</p>

<aside class="admonition note">
    <strong>note</strong>
    <em>note</em>
    <p>Note: Completion of the prerequisites of deploying the Azure Stack HCI in your environment is outside the scope of this document. For more details refer to the <a href="https://learn.microsoft.com/en-us/azure-stack/hci/deploy/deployment-introduction#deployment-sequence">Azure Stack HCI deployment sequence</a>. If you encounter issues completing the prerequisites, we'd recommend opening a ticket with Microsoft Support.</p>
</aside>

<aside class="admonition note">
    <strong>note</strong>
    <em>note</em>
    <p>Note: During the deployment process, the service will generate additional resources, including a new Arc Bridge Appliance and a Custom Location containing several Stack HCI Storage Paths. The provider will attempt to remove these resources on the deletion or recreation of <code>azurerm_stack_hci_deployment_setting</code>.</p>
</aside>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Example%20Usage"></a><h2 id="example-usage">Example Usage</h2>

<div class="codehilite"><pre><span></span><code><span class="kr">provider</span><span class="w"> </span><span class="nv">"azuread"</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">"local_admin_user"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"The username of the local administrator account."</span><span class="w"></span>
<span class="w">  </span><span class="na">sensitive</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">"local_admin_password"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"The password of the local administrator account."</span><span class="w"></span>
<span class="w">  </span><span class="na">sensitive</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">"domain_admin_user"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"The username of the domain account."</span><span class="w"></span>
<span class="w">  </span><span class="na">sensitive</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">"domain_admin_password"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"The password of the domain account."</span><span class="w"></span>
<span class="w">  </span><span class="na">sensitive</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">"deployment_user"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">sensitive</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"The username for deployment user."</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">"deployment_user_password"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">sensitive</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"The password for deployment user."</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="nb">locals</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"AzSHOST1"</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="na">ipv4Address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"192.168.1.12"</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"AzSHOST2"</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="na">ipv4Address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"192.168.1.13"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">connection_roles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="s2">"Azure Connected Machine Onboarding"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"Azure Connected Machine Resource Administrator"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"Azure Resource Bridge Deployment Role"</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">machine_roles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="s2">"Key Vault Secrets User"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"Azure Connected Machine Resource Manager"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"Azure Stack HCI Device Management Role"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"Reader"</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"azurerm_resource_group"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hci-example"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azuread_application"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">display_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"example-hci-onboard"</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1"># https://learn.microsoft.com/en-us/azure-stack/hci/deploy/deployment-azure-resource-manager-template#create-a-service-principal-and-client-secret</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"azuread_service_principal"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">client_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azuread_application.example.client_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azuread_service_principal_password"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">service_principal_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azuread_service_principal.example.object_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_role_assignment"</span><span class="w"> </span><span class="nv">"connect"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="nv">local.connection_roles</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="na">scope</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_resource_group.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role_definition_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.connection_roles[count.index</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">principal_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">azuread_service_principal.example.object_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_role_assignment"</span><span class="w"> </span><span class="nv">"connect"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">scope</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_subscription.current.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role_definition_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Contributor"</span><span class="w"></span>
<span class="w">  </span><span class="na">principal_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">azuread_service_principal.example.object_id</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1"># after preparing Active Directory and registering servers with Arc, and then the Arc VM is ready</span>
<span class="kr">data</span><span class="w"> </span><span class="nc">"azurerm_arc_machine"</span><span class="w"> </span><span class="nv">"server"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="nv">local.servers</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">local.servers[count.index].name</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_resource_group.example.name</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"azurerm_client_config"</span><span class="w"> </span><span class="nv">"current"</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_key_vault"</span><span class="w"> </span><span class="nv">"DeploymentKeyVault"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="s2">"hci-examplekv"</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_resource_group.example.location</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_resource_group.example.name</span><span class="w"></span>
<span class="w">  </span><span class="na">enabled_for_deployment</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">enabled_for_template_deployment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">enabled_for_disk_encryption</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">tenant_id</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_client_config.current.tenant_id</span><span class="w"></span>
<span class="w">  </span><span class="na">soft_delete_retention_days</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">  </span><span class="na">enable_rbac_authorization</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">public_network_access_enabled</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">sku_name</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="s2">"standard"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_role_assignment"</span><span class="w"> </span><span class="nv">"KeyVault"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">scope</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_key_vault.DeploymentKeyVault.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role_definition_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Key Vault Secrets Officer"</span><span class="w"></span>
<span class="w">  </span><span class="na">principal_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_client_config.current.object_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_key_vault_secret"</span><span class="w"> </span><span class="nv">"AzureStackLCMUserCredential"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"AzureStackLCMUserCredential"</span><span class="w"></span>
<span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Secret"</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nf">base64encode</span><span class="p">(</span><span class="s2">"${var.deployment_user}:${var.deployment_user_password}"</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="na">key_vault_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_key_vault.DeploymentKeyVault.id</span><span class="w"></span>
<span class="w">  </span><span class="na">depends_on</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">azurerm_role_assignment.KeyVault</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_key_vault_secret"</span><span class="w"> </span><span class="nv">"LocalAdminCredential"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"LocalAdminCredential"</span><span class="w"></span>
<span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Secret"</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nf">base64encode</span><span class="p">(</span><span class="s2">"${var.local_admin_user}:${var.local_admin_password}"</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="na">key_vault_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_key_vault.DeploymentKeyVault.id</span><span class="w"></span>
<span class="w">  </span><span class="na">depends_on</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">azurerm_role_assignment.KeyVault</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_key_vault_secret"</span><span class="w"> </span><span class="nv">"DefaultARBApplication"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"DefaultARBApplication"</span><span class="w"></span>
<span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Secret"</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nf">base64encode</span><span class="p">(</span><span class="s2">"${azuread_service_principal.example.client_id}:${azuread_service_principal_password.example.value}"</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="na">key_vault_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_key_vault.DeploymentKeyVault.id</span><span class="w"></span>
<span class="w">  </span><span class="na">depends_on</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">azurerm_role_assignment.KeyVault</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_key_vault_secret"</span><span class="w"> </span><span class="nv">"WitnessStorageKey"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"WitnessStorageKey"</span><span class="w"></span>
<span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Secret"</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nf">base64encode</span><span class="p">(</span><span class="nv">azurerm_storage_account.witness.primary_access_key</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="na">key_vault_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_key_vault.DeploymentKeyVault.id</span><span class="w"></span>
<span class="w">  </span><span class="na">depends_on</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">azurerm_role_assignment.KeyVault</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_storage_account"</span><span class="w"> </span><span class="nv">"witness"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">"hciexamplesta"</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_resource_group.example.location</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_resource_group.example.name</span><span class="w"></span>
<span class="w">  </span><span class="na">account_tier</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">"Standard"</span><span class="w"></span>
<span class="w">  </span><span class="na">account_replication_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"LRS"</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// service principal of 'Microsoft.AzureStackHCI Resource Provider' application</span>
<span class="kr">data</span><span class="w"> </span><span class="nc">"azuread_service_principal"</span><span class="w"> </span><span class="nv">"hciRp"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">client_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"1412d89f-b8a8-4111-b4fd-e82905cbd85d"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_role_assignment"</span><span class="w"> </span><span class="nv">"MachineRoleAssign1"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="nv">local.machine_roles</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="na">scope</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_resource_group.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role_definition_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.machine_roles[count.index</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">principal_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_arc_machine.server[0].identity[0].principal_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_role_assignment"</span><span class="w"> </span><span class="nv">"MachineRoleAssign2"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="nv">local.machine_roles</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="na">scope</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_resource_group.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role_definition_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.machine_roles[count.index</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">principal_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_arc_machine.server[1].identity[0].principal_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_role_assignment"</span><span class="w"> </span><span class="nv">"ServicePrincipalRoleAssign"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">scope</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_resource_group.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role_definition_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Azure Connected Machine Resource Manager"</span><span class="w"></span>
<span class="w">  </span><span class="na">principal_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azuread_service_principal.hciRp.object_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_stack_hci_cluster"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="nv">azurerm_key_vault_secret.DefaultARBApplication</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">azurerm_key_vault_secret.AzureStackLCMUserCredential</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">azurerm_key_vault_secret.LocalAdminCredential</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">azurerm_key_vault_secret.WitnessStorageKey</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">azurerm_role_assignment.connect</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">azurerm_role_assignment.connect2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">azurerm_role_assignment.ServicePrincipalRoleAssign</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">azurerm_role_assignment.MachineRoleAssign1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">azurerm_role_assignment.MachineRoleAssign2</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"hci-cl"</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_resource_group.example.name</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azurerm_resource_group.example.location</span><span class="w"></span>
<span class="w">  </span><span class="nb">identity</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SystemAssigned"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="c1"></span>

<span class="c1">  // the client_id will be populated after deployment</span>
<span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">ignore_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb"></span>
<span class="nb">      client_id</span>
<span class="nb">    </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_stack_hci_deployment_setting"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">stack_hci_cluster_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_stack_hci_cluster.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">arc_resource_ids</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="err">for</span><span class="w"> </span><span class="err">server</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">data.azurerm_arc_machine.server</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">server.id</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">version</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">"10.0.0.0"</span><span class="w"></span>

<span class="w">  </span><span class="nb">scale_unit</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">active_directory_organizational_unit_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"OU=hci,DC=jumpstart,DC=local"</span><span class="w"></span>
<span class="w">    </span><span class="na">domain_fqdn</span><span class="w">                               </span><span class="o">=</span><span class="w"> </span><span class="s2">"jumpstart.local"</span><span class="w"></span>
<span class="w">    </span><span class="na">secrets_location</span><span class="w">                          </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_key_vault.DeploymentKeyVault.vault_uri</span><span class="w"></span>
<span class="w">    </span><span class="na">name_prefix</span><span class="w">                               </span><span class="o">=</span><span class="w"> </span><span class="s2">"hci"</span><span class="w"></span>

<span class="w">    </span><span class="nb">cluster</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">azure_service_endpoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"core.windows.net"</span><span class="w"></span>
<span class="w">      </span><span class="na">cloud_account_name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_storage_account.witness.name</span><span class="w"></span>
<span class="w">      </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_stack_hci_cluster.example.name</span><span class="w"></span>
<span class="w">      </span><span class="na">witness_type</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cloud"</span><span class="w"></span>
<span class="w">      </span><span class="na">witness_path</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cloud"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">host_network</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_auto_ip_enabled</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_connectivity_switchless_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">      </span><span class="nb">intent</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">name</span><span class="w">                                          </span><span class="o">=</span><span class="w"> </span><span class="s2">"ManagementCompute"</span><span class="w"></span>
<span class="w">        </span><span class="na">adapter_property_override_enabled</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">        </span><span class="na">qos_policy_override_enabled</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">        </span><span class="na">virtual_switch_configuration_override_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">        </span><span class="na">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">          </span><span class="s2">"FABRIC"</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="s2">"FABRIC2"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="na">traffic_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">          </span><span class="s2">"Management"</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="s2">"Compute"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="nb">qos_policy_override</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">priority_value8021_action_cluster</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"7"</span><span class="w"></span>
<span class="w">          </span><span class="na">priority_value8021_action_smb</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"3"</span><span class="w"></span>
<span class="w">          </span><span class="na">bandwidth_percentage_smb</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">"50"</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="nb">adapter_property_override</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">jumbo_packet</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">"9014"</span><span class="w"></span>
<span class="w">          </span><span class="na">network_direct</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w"></span>
<span class="w">          </span><span class="na">network_direct_technology</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"RoCEv2"</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="nb">intent</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">name</span><span class="w">                                          </span><span class="o">=</span><span class="w"> </span><span class="s2">"Storage"</span><span class="w"></span>
<span class="w">        </span><span class="na">adapter_property_override_enabled</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">        </span><span class="na">qos_policy_override_enabled</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">        </span><span class="na">virtual_switch_configuration_override_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">        </span><span class="na">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">          </span><span class="s2">"StorageA"</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="s2">"StorageB"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="na">traffic_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">          </span><span class="s2">"Storage"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="nb">qos_policy_override</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">priority_value8021_action_cluster</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"7"</span><span class="w"></span>
<span class="w">          </span><span class="na">priority_value8021_action_smb</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"3"</span><span class="w"></span>
<span class="w">          </span><span class="na">bandwidth_percentage_smb</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">"50"</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="nb">adapter_property_override</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">jumbo_packet</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">"9014"</span><span class="w"></span>
<span class="w">          </span><span class="na">network_direct</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">          </span><span class="na">network_direct_technology</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"RoCEv2"</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="nb">storage_network</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">name</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">"Storage1Network"</span><span class="w"></span>
<span class="w">        </span><span class="na">network_adapter_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"StorageA"</span><span class="w"></span>
<span class="w">        </span><span class="na">vlan_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">"711"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="nb">storage_network</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">name</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">"Storage2Network"</span><span class="w"></span>
<span class="w">        </span><span class="na">network_adapter_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"StorageB"</span><span class="w"></span>
<span class="w">        </span><span class="na">vlan_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">"712"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">infrastructure_network</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">gateway</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"192.168.1.1"</span><span class="w"></span>
<span class="w">      </span><span class="na">subnet_mask</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"255.255.255.0"</span><span class="w"></span>
<span class="w">      </span><span class="na">dhcp_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">      </span><span class="na">dns_server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="s2">"192.168.1.254"</span><span class="w"></span>
<span class="w">      </span><span class="p">]</span><span class="w"></span>
<span class="w">      </span><span class="nb">ip_pool</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">ending_address</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"192.168.1.65"</span><span class="w"></span>
<span class="w">        </span><span class="na">starting_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"192.168.1.55"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">optional_service</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">custom_location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"customlocation"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">physical_node</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">ipv4_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"192.168.1.12"</span><span class="w"></span>
<span class="w">      </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"AzSHOST1"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">physical_node</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">ipv4_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"192.168.1.13"</span><span class="w"></span>
<span class="w">      </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"AzSHOST2"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">observability</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">streaming_data_client_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">      </span><span class="na">eu_location_enabled</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">      </span><span class="na">episodic_data_upload_enabled</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">security_setting</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">bitlocker_boot_volume_enabled</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">      </span><span class="na">bitlocker_data_volume_enabled</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">      </span><span class="na">credential_guard_enabled</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">      </span><span class="na">drift_control_enabled</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">      </span><span class="na">drtm_protection_enabled</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">      </span><span class="na">hvci_protection_enabled</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">      </span><span class="na">side_channel_mitigation_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">      </span><span class="na">smb_cluster_encryption_enabled</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">      </span><span class="na">smb_signing_enabled</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">      </span><span class="na">wdac_enabled</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">storage</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">configuration_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Express"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Arguments%20Reference"></a><h2 id="arguments-reference">Arguments Reference</h2>

<p>The following arguments are supported:</p>

<ul>
<li><p><code>stack_hci_cluster_id</code> - (Required) The ID of the Azure Stack HCI cluster. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>arc_resource_ids</code> - (Required) Specifies a list of IDs of Azure ARC machine resource to be part of cluster. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>scale_unit</code> - (Required) One or more <code>scale_unit</code> blocks as defined below. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>version</code> - (Required) The deployment template version. The format must be a set of numbers separated by dots such as <code>10.0.0.0</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<hr/>

<p>A <code>adapter_property_override</code> block supports the following:</p>

<ul>
<li><p><code>jumbo_packet</code> - (Optional) The jumbo frame size of the adapter. This parameter should only be modified based on your OEM guidance. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>network_direct</code> - (Optional) The network direct of the adapter. This parameter should only be modified based on your OEM guidance. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>network_direct_technology</code> - (Optional) The network direct technology of the adapter. This parameter should only be modified based on your OEM guidance. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<hr/>

<p>A <code>cluster</code> block supports the following:</p>

<ul>
<li><p><code>azure_service_endpoint</code> - (Required) Specifies the Azure blob service endpoint, for example, <code>core.windows.net</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>cloud_account_name</code> - (Required) Specifies the Azure Storage account name of the cloud witness for the Azure Stack HCI cluster. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>name</code> - (Required) Specifies the name of the cluster. It must be 3-15 characters long and contain only letters, numbers and hyphens. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>witness_path</code> - (Required) Specifies the fileshare path of the local witness for the Azure Stack HCI cluster. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>witness_type</code> - (Required) Specifies the type of the witness. Possible values are <code>Cloud</code>, <code>FileShare</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<hr/>

<p>A <code>host_network</code> block supports the following:</p>

<ul>
<li><p><code>intent</code> - (Required) One or more <code>intent</code> blocks as defined below. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>storage_network</code> - (Required) One or more <code>storage_network</code> blocks as defined below. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>storage_auto_ip_enabled</code> - (Optional) Whether allows users to specify IPs and Mask for Storage NICs when Network ATC is not assigning the IPs for storage automatically. Optional parameter required only for <a href="https://learn.microsoft.com/azure-stack/hci/concepts/physical-network-requirements?tabs=overview%2C23H2reqs#using-switchless">3 nodes switchless deployments</a>. Possible values are <code>true</code> and <code>false</code>. Defaults to <code>true</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>storage_connectivity_switchless_enabled</code> - (Optional) Defines how the storage adapters between nodes are connected either switch or switch less. Possible values are <code>true</code> and <code>false</code>. Defaults to <code>false</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<hr/>

<p>A <code>infrastructure_network</code> block supports the following:</p>

<ul>
<li><p><code>dns_server</code> - (Required) Specifies a list of IPv4 addresses of the DNS servers in your environment. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>gateway</code> - (Required) Specifies the default gateway that should be used for the provided IP address space. It should be in the format of an IPv4 IP address. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>ip_pool</code> - (Required) One or more <code>ip_pool</code> blocks as defined below. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>subnet_mask</code> - (Required) Specifies the subnet mask that matches the provided IP address space. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>dhcp_enabled</code> - (Optional) Whether DHCP is enabled for hosts and cluster IPs. Possible values are <code>true</code> and <code>false</code>. defaults to <code>false</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<aside class="admonition note">
    <strong>note</strong>
    <em>note</em>
    <p>If <code>dhcp_enabled</code> is set to <code>false</code>, the deployment will use static IPs. If set to <code>true</code>, the gateway and DNS servers are not required.</p>
</aside>

<hr/>

<p>A <code>intent</code> block supports the following:</p>

<ul>
<li><p><code>name</code> - (Required) Specifies the name of the intent. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>adapter</code> - (Required) Specifies a list of ID of network interfaces used for the network intent. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>traffic_type</code> - (Required) Specifies a list of network traffic types. Possible values are <code>Compute</code>, <code>Storage</code>, <code>Management</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>adapter_property_override</code> - (Optional) A <code>adapter_property_override</code> block as defined above. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>adapter_property_override_enabled</code> - (Optional) Whether to override adapter properties. Possible values are <code>true</code> and <code>false</code>. defaults to <code>false</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>qos_policy_override</code> - (Optional) A <code>qos_policy_override</code> block as defined below. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>qos_policy_override_enabled</code> - (Optional) Whether to override QoS policy. Possible values are <code>true</code> and <code>false</code>. defaults to <code>false</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>virtual_switch_configuration_override</code> - (Optional) A <code>virtual_switch_configuration_override</code> block as defined below. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>virtual_switch_configuration_override_enabled</code> - (Optional) Whether to override virtual switch configuration. Possible values are <code>true</code> and <code>false</code>. defaults to <code>false</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<hr/>

<p>A <code>ip_pool</code> block supports the following:</p>

<ul>
<li><p><code>ending_address</code> - (Required) Specifies starting IP address for the management network. A minimum of six free, contiguous IPv4 addresses (excluding your host IPs) are needed for infrastructure services such as clustering. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>starting_address</code> - (Required) Specifies ending IP address for the management network. A minimum of six free, contiguous IPv4 addresses (excluding your host IPs) are needed for infrastructure services such as clustering. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<hr/>

<p>A <code>observability</code> block supports the following:</p>

<ul>
<li><p><code>episodic_data_upload_enabled</code> - (Required) Whether to collect log data to facilitate quicker issue resolution. Possible values are <code>true</code> and <code>false</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>eu_location_enabled</code> - (Required) Whether to store log and diagnostic data sent to Microsoft in EU or outside of EU. The log and diagnostic data is sent to the appropriate diagnostics servers depending upon where your cluster resides. Setting this to <code>false</code> results in all data sent to Microsoft to be stored outside of EU. Possible values are <code>true</code> and <code>false</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>streaming_data_client_enabled</code> - (Required) Whether the telemetry data will be sent to Microsoft. Possible values are <code>true</code> and <code>false</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<hr/>

<p>A <code>optional_service</code> block supports the following:</p>

<ul>
<li><code>custom_location</code> - (Required) Specifies the name of custom location. A custom location will be created after the deployment is completed. Changing this forces a new Stack HCI Deployment Setting to be created.</li>
</ul>

<hr/>

<p>A <code>physical_node</code> block supports the following:</p>

<ul>
<li><p><code>ipv4_address</code> - (Required) Specifies the IPv4 address assigned to each physical server on your Azure Stack HCI cluster. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>name</code> - (Required) The NETBIOS name of each physical server on your Azure Stack HCI cluster. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<hr/>

<p>A <code>qos_policy_override</code> block supports the following:</p>

<ul>
<li><p><code>bandwidth_percentage_smb</code> - (Optional) Specifies the percentage of the allocated storage traffic bandwidth. This parameter should only be modified based on your OEM guidance. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>priority_value8021_action_cluster</code> - (Optional) Specifies the Cluster traffic priority. This parameter should only be modified based on your OEM guidance. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>priority_value8021_action_smb</code> - (Optional) Specifies the Priority Flow Control where Data Center Bridging (DCB) is used. This parameter should only be modified based on your OEM guidance. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<hr/>

<p>A <code>scale_unit</code> block supports the following:</p>

<ul>
<li><p><code>active_directory_organizational_unit_path</code> - (Required) Specify the full name of the Active Directory Organizational Unit container object prepared for the deployment, including the domain components. For example:<code>OU=HCI01,DC=contoso,DC=com</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>cluster</code> - (Required) A <code>cluster</code> block as defined above. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>domain_fqdn</code> - (Required) Specifies the FQDN for deploying cluster. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>host_network</code> - (Required) A <code>host_network</code> block as defined above. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>infrastructure_network</code> - (Required) One or more <code>infrastructure_network</code> blocks as defined above. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>name_prefix</code> - (Required) Specifies the name prefix to deploy cluster. It must be 1-8 characters long and contain only letters, numbers and hyphens Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>optional_service</code> - (Required) A <code>optional_service</code> block as defined above. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>physical_node</code> - (Required) One or more <code>physical_node</code> blocks as defined above. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>secrets_location</code> - (Required) The URI to the Key Vault or secret store. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>security_setting</code> - (Required) A <code>security_setting</code> block as defined below. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>storage</code> - (Required) A <code>storage</code> block as defined below. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>episodic_data_upload_enabled</code> - (Optional) Whether to collect log data to facilitate quicker issue resolution. Possible values are <code>true</code> and <code>false</code>. Defaults to <code>true</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>eu_location_enabled</code> - (Optional) Whether to store data sent to Microsoft in EU. The log and diagnostic data is sent to the appropriate diagnostics servers depending upon where your cluster resides. Setting this to <code>false</code> results in all data sent to Microsoft to be stored outside of the EU. Possible values are <code>true</code> and <code>false</code>. Defaults to <code>false</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>streaming_data_client_enabled</code> - (Optional) Whether the telemetry data will be sent to Microsoft. Possible values are <code>true</code> and <code>false</code>. Defaults to <code>true</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>bitlocker_boot_volume_enabled</code> - (Optional) Whether to enable BitLocker for boot volume. Possible values are <code>true</code> and <code>false</code>. When set to <code>true</code>, BitLocker XTS_AES 256-bit encryption is enabled for all data-at-rest on the OS volume of your Azure Stack HCI cluster. This setting is TPM-hardware dependent. Defaults to <code>true</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>bitlocker_data_volume_enabled</code> - (Optional) Whether to enable BitLocker for data volume. Possible values are <code>true</code> and <code>false</code>. When set to <code>true</code>, BitLocker XTS-AES 256-bit encryption is enabled for all data-at-rest on your Azure Stack HCI cluster shared volumes. Defaults to <code>true</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>credential_guard_enabled</code> - (Optional) Whether to enable credential guard. Possible values are <code>true</code> and <code>false</code>. Defaults to <code>false</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>drift_control_enabled</code> - (Optional) Whether to enable drift control. Possible values are <code>true</code> and <code>false</code>. When set to <code>true</code>, the security baseline is re-applied regularly. Defaults to <code>true</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>drtm_protection_enabled</code> - (Optional) Whether to enable DRTM protection. Possible values are <code>true</code> and <code>false</code>. When set to <code>true</code>, Secure Boot is enabled on your Azure HCI cluster. This setting is hardware dependent. Defaults to <code>true</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>hvci_protection_enabled</code> - (Optional) Whether to enable HVCI protection. Possible values are <code>true</code> and <code>false</code>. When set to <code>true</code>, Hypervisor-protected Code Integrity is enabled on your Azure HCI cluster. Defaults to <code>true</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>side_channel_mitigation_enabled</code> - (Optional) Whether to enable side channel mitigation. Possible values are <code>true</code> and <code>false</code>. When set to <code>true</code>, all side channel mitigations are enabled on your Azure HCI cluster. Defaults to <code>true</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>smb_cluster_encryption_enabled</code> - (Optional) Whether to enable SMB cluster encryption. Possible values are <code>true</code> and <code>false</code>. When set to <code>true</code>, cluster east-west traffic is encrypted. Defaults to <code>false</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>smb_signing_enabled</code> - (Optional) Whether to enable SMB signing. Possible values are <code>true</code> and <code>false</code>. When set to <code>true</code>, the SMB default instance requires sign in for the client and server services. Defaults to <code>true</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>wdac_enabled</code> - (Optional) Whether to enable WDAC. Possible values are <code>true</code> and <code>false</code>. When set to <code>true</code>, applications and the code that you can run on your Azure Stack HCI cluster are limited. Defaults to <code>true</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<hr/>

<p>A <code>storage</code> block supports the following:</p>

<ul>
<li><code>configuration_mode</code> - (Required) The configuration mode of storage. If set to <code>Express</code> and your storage is configured as per best practices based on the number of nodes in the cluster. Possible values are <code>Express</code>, <code>InfraOnly</code> and <code>KeepStorage</code>. Changing this forces a new Stack HCI Deployment Setting to be created.</li>
</ul>

<hr/>

<p>A <code>storage_network</code> block supports the following:</p>

<ul>
<li><p><code>name</code> - (Required) The name of the storage network. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>network_adapter_name</code> - (Required) The name of the network adapter. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>vlan_id</code> - (Required) Specifies the ID for the VLAN storage network. This setting is applied to the network interfaces that route the storage and VM migration traffic. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<hr/>

<p>A <code>virtual_switch_configuration_override</code> block supports the following:</p>

<ul>
<li><p><code>enable_iov</code> - (Optional) Specifies the IoV enable status for Virtual Switch. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
<li><p><code>load_balancing_algorithm</code> - (Optional) Specifies the load balancing algorithm for Virtual Switch. Changing this forces a new Stack HCI Deployment Setting to be created.</p></li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Attributes%20Reference"></a><h2 id="attributes-reference">Attributes Reference</h2>

<p>In addition to the Arguments listed above - the following Attributes are exported: </p>

<ul>
<li><code>id</code> - The ID of the Stack HCI Deployment Setting.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Timeouts"></a><h2 id="timeouts">Timeouts</h2>

<p>The <code>timeouts</code> block allows you to specify <a href="https://www.terraform.io/language/resources/syntax#operation-timeouts">timeouts</a> for certain actions:</p>

<ul>
<li><code>create</code> - (Defaults to 6 hours) Used when creating the Stack HCI Deployment Setting.</li>
<li><code>read</code> - (Defaults to 5 minutes) Used when retrieving the Stack HCI Deployment Setting.</li>
<li><code>delete</code> - (Defaults to 1 hour) Used when deleting the Stack HCI Deployment Setting.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Import"></a><h2 id="import">Import</h2>

<p>Stack HCI Deployment Settings can be imported using the <code>resource id</code>, e.g.</p>

<div class="codehilite"><pre><span></span><code>terraform import azurerm_stack_hci_deployment_setting.example /subscriptions/12345678-1234-9876-4563-123456789012/resourceGroups/group1/providers/Microsoft.AzureStackHCI/clusters/clus1/deploymentSettings/default
</code></pre></div>

            
        
    </body></html>