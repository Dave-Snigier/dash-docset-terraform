<html><!-- Online page at https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_scheduled_query_rules_alert --><head>
                <title>azurerm_monitor_scheduled_query_rules_alert</title>
                <meta charset="utf-8"/>
                <link href="../../../../../../style.css" rel="stylesheet"/>
            </head>
            <body>
                <h1 id="azurerm_monitor_scheduled_query_rules_alert">azurerm_monitor_scheduled_query_rules_alert</h1>

<p>Manages an AlertingAction Scheduled Query Rules resource within Azure Monitor.</p>

<aside class="admonition note">
    <strong>note</strong>
    <em>Warning</em>
    <p>This resource is using an older AzureRM API version which is known to cause problems e.g. with custom webhook properties not included in triggered alerts. This resource is superseded by the <a href="./monitor_scheduled_query_rules_alert_v2.html.markdown">azurerm_monitor_scheduled_query_rules_alert_v2</a> resource using newer API versions.</p>
</aside>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Example%20Usage"></a><h2 id="example-usage">Example Usage</h2>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_resource_group"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"monitoring-resources"</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"West Europe"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_application_insights"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"appinsights"</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.location</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.name</span><span class="w"></span>
<span class="w">  </span><span class="na">application_type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"web"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_application_insights"</span><span class="w"> </span><span class="nv">"example2"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"appinsights2"</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.location</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.name</span><span class="w"></span>
<span class="w">  </span><span class="na">application_type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"web"</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1"># Example: Alerting Action with result count trigger</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_monitor_scheduled_query_rules_alert"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"example"</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.location</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.name</span><span class="w"></span>

<span class="w">  </span><span class="nb">action</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">action_group</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="w">    </span><span class="na">email_subject</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">"Email Header"</span><span class="w"></span>
<span class="w">    </span><span class="na">custom_webhook_payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"{}"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="na">data_source_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_application_insights.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"Alert when total results cross threshold"</span><span class="w"></span>
<span class="w">  </span><span class="na">enabled</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="c1"></span>
<span class="c1">  # Count all requests with server error result code grouped into 5-minute bins</span>
<span class="w">  </span><span class="na">query</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="dl">QUERY</span><span class="sh"></span>
<span class="sh">  requests</span>
<span class="sh">    | where tolong(resultCode) &gt;= 500</span>
<span class="sh">    | summarize count() by bin(timestamp, 5m)</span>
<span class="dl">  QUERY</span>
<span class="w">  </span><span class="na">severity</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">  </span><span class="na">frequency</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
<span class="w">  </span><span class="na">time_window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">  </span><span class="nb">trigger</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">operator</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"GreaterThan"</span><span class="w"></span>
<span class="w">    </span><span class="na">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bar"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1"># Example: Alerting Action Cross-Resource</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"azurerm_monitor_scheduled_query_rules_alert"</span><span class="w"> </span><span class="nv">"example2"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"example"</span><span class="w"></span>
<span class="w">  </span><span class="na">location</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.location</span><span class="w"></span>
<span class="w">  </span><span class="na">resource_group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_resource_group.example.name</span><span class="w"></span>

<span class="w">  </span><span class="na">authorized_resource_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">azurerm_application_insights.example2.id</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="nb">action</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">action_group</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="w">    </span><span class="na">email_subject</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">"Email Header"</span><span class="w"></span>
<span class="w">    </span><span class="na">custom_webhook_payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"{}"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="na">data_source_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">azurerm_application_insights.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"Query may access data within multiple resources"</span><span class="w"></span>
<span class="w">  </span><span class="na">enabled</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="c1"></span>
<span class="c1">  # Count requests in multiple log resources and group into 5-minute bins by HTTP operation</span>
<span class="w">  </span><span class="na">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="o">&lt;&lt;-</span><span class="dl">QUERY</span><span class="sh"></span>
<span class="sh">  let a=requests</span>
<span class="sh">    | where toint(resultCode) &gt;= 500</span>
<span class="sh">    | extend fail=1; let b=app('%s').requests</span>
<span class="sh">    | where toint(resultCode) &gt;= 500 | extend fail=1; a</span>
<span class="sh">    | join b on fail</span>
<span class="dl">QUERY</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="nv">azurerm_application_insights.example2.id</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="na">severity</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">  </span><span class="na">frequency</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="w"></span>
<span class="w">  </span><span class="na">time_window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">  </span><span class="nb">trigger</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">operator</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"GreaterThan"</span><span class="w"></span>
<span class="w">    </span><span class="na">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bar"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Argument%20Reference"></a><h2 id="argument-reference">Argument Reference</h2>

<p>The following arguments are supported:</p>

<ul>
<li><code>name</code> - (Required) The name of the scheduled query rule. Changing this forces a new resource to be created.</li>
<li><code>resource_group_name</code> - (Required) The name of the resource group in which to create the scheduled query rule instance. Changing this forces a new resource to be created.</li>
<li><code>location</code> - (Required) Specifies the Azure Region where the resource should exist. Changing this forces a new resource to be created.</li>
<li><code>data_source_id</code> - (Required) The resource URI over which log search query is to be run. Changing this forces a new resource to be created.</li>
<li><code>frequency</code> - (Required) Frequency (in minutes) at which rule condition should be evaluated. Values must be between 5 and 1440 (inclusive).</li>
<li><code>query</code> - (Required) Log search query.</li>
<li><code>time_window</code> - (Required) Time window for which data needs to be fetched for query (must be greater than or equal to <code>frequency</code>). Values must be between 5 and 2880 (inclusive).</li>
<li><code>trigger</code> - (Required) A <code>trigger</code> block as defined below.</li>
<li><code>action</code> - (Required) An <code>action</code> block as defined below.</li>
<li><code>authorized_resource_ids</code> - (Optional) List of Resource IDs referred into query.</li>
<li><code>auto_mitigation_enabled</code> - (Optional) Should the alerts in this Metric Alert be auto resolved? Defaults to <code>false</code>.
<aside class="admonition note">
<strong>note</strong>
<em>note</em>
<p><code>auto_mitigation_enabled</code> and <code>throttling</code> are mutually exclusive and cannot both be set. * <code>description</code> - (Optional) The description of the scheduled query rule. * <code>enabled</code> - (Optional) Whether this scheduled query rule is enabled. Default is <code>true</code>. * <code>query_type</code> - (Optional) The type of query results. Possible values are <code>ResultCount</code> and <code>Number</code>. Default is <code>ResultCount</code>. If set to <code>ResultCount</code>, <code>query</code> must include an <code>AggregatedValue</code> column of a numeric type, for example, <code>Heartbeat | summarize AggregatedValue = count() by bin(TimeGenerated, 5m)</code>. * <code>severity</code> - (Optional) Severity of the alert. Possible values include: 0, 1, 2, 3, or 4. * <code>throttling</code> - (Optional) Time (in minutes) for which Alerts should be throttled or suppressed. Values must be between 0 and 10000 (inclusive). * <code>tags</code> - (Optional) A mapping of tags to assign to the resource.</p>
</aside></li>
</ul>

<hr/>

<p>The <code>action</code> block supports the following:</p>

<ul>
<li><code>action_group</code> - (Required) List of action group reference resource IDs.</li>
<li><code>custom_webhook_payload</code> - (Optional) Custom payload to be sent for all webhook payloads in alerting action.</li>
<li><code>email_subject</code> - (Optional) Custom subject override for all email ids in Azure action group.</li>
</ul>

<hr/>

<p>The <code>metric_trigger</code> block supports the following:</p>

<ul>
<li><code>metric_trigger_type</code> - (Required) Metric Trigger Type - 'Consecutive' or 'Total'.</li>
<li><code>operator</code> - (Required) Evaluation operation for rule - 'Equal', 'GreaterThan', GreaterThanOrEqual', 'LessThan', or 'LessThanOrEqual'.</li>
<li><code>threshold</code> - (Required) The threshold of the metric trigger. Values must be between 0 and 10000 inclusive.</li>
<li><code>metric_column</code> - (Optional) Evaluation of metric on a particular column.</li>
</ul>

<hr/>

<p>The <code>trigger</code> block supports the following:</p>

<ul>
<li><code>metric_trigger</code> - (Optional) A <code>metric_trigger</code> block as defined above. Trigger condition for metric query rule.</li>
<li><code>operator</code> - (Required) Evaluation operation for rule - 'GreaterThan', GreaterThanOrEqual', 'LessThan', or 'LessThanOrEqual'.</li>
<li><code>threshold</code> - (Required) Result or count threshold based on which rule should be triggered. Values must be between 0 and 10000 inclusive.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Attributes%20Reference"></a><h2 id="attributes-reference">Attributes Reference</h2>

<p>In addition to the Arguments listed above - the following Attributes are exported:</p>

<ul>
<li><code>id</code> - The ID of the scheduled query rule.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Timeouts"></a><h2 id="timeouts">Timeouts</h2>

<p>The <code>timeouts</code> block allows you to specify <a href="https://www.terraform.io/language/resources/syntax#operation-timeouts">timeouts</a> for certain actions:</p>

<ul>
<li><code>create</code> - (Defaults to 30 minutes) Used when creating the Scheduled Query Rule Alert.</li>
<li><code>update</code> - (Defaults to 30 minutes) Used when updating the Scheduled Query Rule Alert.</li>
<li><code>read</code> - (Defaults to 5 minutes) Used when retrieving the Scheduled Query Rule Alert.</li>
<li><code>delete</code> - (Defaults to 30 minutes) Used when deleting the Scheduled Query Rule Alert.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Import"></a><h2 id="import">Import</h2>

<p>Scheduled Query Rule Alerts can be imported using the <code>resource id</code>, e.g.</p>

<div class="codehilite"><pre><span></span><code>terraform import azurerm_monitor_scheduled_query_rules_alert.example /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/group1/providers/Microsoft.Insights/scheduledQueryRules/myrulename
</code></pre></div>

            
        
    </body></html>