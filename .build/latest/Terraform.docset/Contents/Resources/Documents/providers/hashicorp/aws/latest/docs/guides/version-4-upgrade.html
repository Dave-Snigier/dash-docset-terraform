<html><!-- Online page at https://registry.terraform.io/providers/hashicorp/aws/latest/docs/guides/version-4-upgrade --><head>
                <title>Terraform AWS Provider Version 4 Upgrade Guide</title>
                <meta charset="utf-8"/>
                <link href="../../../../../../style.css" rel="stylesheet"/>
            </head>
            <body>
                <h1 id="terraform-aws-provider-version-4-upgrade-guide">Terraform AWS Provider Version 4 Upgrade Guide</h1>

<p>Version 4.0.0 of the AWS provider for Terraform is a major release and includes some changes that you will need to consider when upgrading. We intend this guide to help with that process and focus only on changes from version 3.X to version 4.0.0. See the <a href="../guides/version-3-upgrade.html">Version 3 Upgrade Guide</a> for information about upgrading from 2.X to version 3.0.0.</p>

<p>We previously marked most of the changes we outline in this guide as deprecated in the Terraform plan/apply output throughout previous provider releases. You can find these changes, including deprecation notices, in the <a href="https://github.com/hashicorp/terraform-provider-aws/blob/main/CHANGELOG.md">Terraform AWS Provider CHANGELOG</a>.</p>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>Versions 4.0.0 through v4.8.0 of the AWS Provider introduce significant breaking changes to the <code>aws_s3_bucket</code> resource. See <a href="#s3-bucket-refactor">S3 Bucket Refactor</a> for more details. We recommend upgrading to v4.9.0 or later of the AWS Provider instead, where only non-breaking changes and deprecation notices are introduced to the <code>aws_s3_bucket</code>. See  <a href="#changes-to-s3-bucket-drift-detection">Changes to S3 Bucket Drift Detection</a> for additional considerations when upgrading to v4.9.0 or later.</p>
</aside>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>Version 4.0.0 of the AWS Provider introduces changes to the precedence of some authentication and configuration parameters. These changes bring the provider in line with the AWS CLI and SDKs. See <a href="#changes-to-authentication">Changes to Authentication</a> for more details.</p>
</aside>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>Version 4.0.0 of the AWS Provider will be the last major version to support <a href="#ec2-classic-resource-and-data-source-support">EC2-Classic resources</a> as AWS plans to fully retire EC2-Classic Networking. See the <a href="https://aws.amazon.com/blogs/aws/ec2-classic-is-retiring-heres-how-to-prepare/">AWS News Blog</a> for additional details.</p>
</aside>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>Version 4.0.0 of the AWS Provider will be the last major version to support <a href="#macie-classic-resource-support">Macie Classic resources</a> as AWS plans to fully retire Macie Classic. See the <a href="https://aws.amazon.com/macie/classic-faqs/">Amazon Macie Classic FAQs</a> for additional details.</p>
</aside>

<p>Upgrade topics:</p>

<!-- TOC depthFrom:2 depthTo:2 -->

<ul>
<li><a href="#provider-version-configuration">Provider Version Configuration</a></li>
<li><a href="#changes-to-authentication">Changes to Authentication</a></li>
<li><a href="#new-provider-arguments">New Provider Arguments</a></li>
<li><a href="#changes-to-s3-bucket-drift-detection">Changes to S3 Bucket Drift Detection</a> (<strong>Applicable to v4.9.0 and later of the AWS Provider</strong>)</li>
<li><a href="#s3-bucket-refactor">S3 Bucket Refactor</a> (<strong>Only applicable to v4.0.0 through v4.8.0 of the AWS Provider</strong>)
<ul>
<li><a href="#acceleration_status-argument"><code>acceleration_status</code> Argument</a></li>
<li><a href="#acl-argument"><code>acl</code> Argument</a></li>
<li><a href="#cors_rule-argument"><code>cors_rule</code> Argument</a></li>
<li><a href="#grant-argument"><code>grant</code> Argument</a></li>
<li><a href="#lifecycle_rule-argument"><code>lifecycle_rule</code> Argument</a></li>
<li><a href="#logging-argument"><code>logging</code> Argument</a></li>
<li><a href="#object_lock_configuration-rule-argument"><code>object_lock_configuration</code> <code>rule</code> Argument</a></li>
<li><a href="#policy-argument"><code>policy</code> Argument</a></li>
<li><a href="#replication_configuration-argument"><code>replication_configuration</code> Argument</a></li>
<li><a href="#request_payer-argument"><code>request_payer</code> Argument</a></li>
<li><a href="#server_side_encryption_configuration-argument"><code>server_side_encryption_configuration</code> Argument</a></li>
<li><a href="#versioning-argument"><code>versioning</code> Argument</a></li>
<li><a href="#website-website_domain-and-website_endpoint-arguments"><code>website</code>, <code>website_domain</code>, and <code>website_endpoint</code> Arguments</a></li>
</ul></li>
<li><a href="#full-resource-lifecycle-of-default-resources">Full Resource Lifecycle of Default Resources</a>
<ul>
<li><a href="#resource-aws_default_subnet">Resource: aws_default_subnet</a></li>
<li><a href="#resource-aws_default_vpc">Resource: aws_default_vpc</a></li>
</ul></li>
<li><a href="#plural-data-source-behavior">Plural Data Source Behavior</a></li>
<li><a href="#empty-strings-not-valid-for-certain-resources">Empty Strings Not Valid For Certain Resources</a>
<ul>
<li><a href="#resource-aws_cloudwatch_event_target-empty-string">Resource: aws_cloudwatch_event_target (Empty String)</a></li>
<li><a href="#resource-aws_customer_gateway">Resource: aws_customer_gateway</a></li>
<li><a href="#resource-aws_default_network_acl">Resource: aws_default_network_acl</a></li>
<li><a href="#resource-aws_default_route_table">Resource: aws_default_route_table</a></li>
<li><a href="#resource-aws_default_vpc-empty-string">Resource: aws_default_vpc (Empty String)</a></li>
<li><a href="#resource-aws_efs_mount_target">Resource: aws_efs_mount_target</a></li>
<li><a href="#resource-aws_elasticsearch_domain">Resource: aws_elasticsearch_domain</a></li>
<li><a href="#resource-aws_instance">Resource: aws_instance</a></li>
<li><a href="#resource-aws_network_acl">Resource: aws_network_acl</a></li>
<li><a href="#resource-aws_route">Resource: aws_route</a></li>
<li><a href="#resource-aws_route_table">Resource: aws_route_table</a></li>
<li><a href="#resource-aws_vpc">Resource: aws_vpc</a></li>
<li><a href="#resource-aws_vpc_ipv6_cidr_block_association">Resource: aws_vpc_ipv6_cidr_block_association</a></li>
</ul></li>
<li><a href="#data-source-aws_cloudwatch_log_group">Data Source: aws_cloudwatch_log_group</a></li>
<li><a href="#data-source-aws_subnet_ids">Data Source: aws_subnet_ids</a></li>
<li><a href="#data-source-aws_s3_bucket_object">Data Source: aws_s3_bucket_object</a></li>
<li><a href="#data-source-aws_s3_bucket_objects">Data Source: aws_s3_bucket_objects</a></li>
<li><a href="#resource-aws_batch_compute_environment">Resource: aws_batch_compute_environment</a></li>
<li><a href="#resource-aws_cloudwatch_event_target">Resource: aws_cloudwatch_event_target</a></li>
<li><a href="#resource-aws_elasticache_cluster">Resource: aws_elasticache_cluster</a></li>
<li><a href="#resource-aws_elasticache_global_replication_group">Resource: aws_elasticache_global_replication_group</a></li>
<li><a href="#resource-aws_fsx_ontap_storage_virtual_machine">Resource: aws_fsx_ontap_storage_virtual_machine</a></li>
<li><a href="#resource-aws_lb_target_group">Resource: aws_lb_target_group</a></li>
<li><a href="#resource-aws_s3_bucket_object">Resource: aws_s3_bucket_object</a></li>
</ul>

<!-- /TOC -->

<p>Additional Topics:</p>

<!-- TOC depthFrom:2 depthTo:2 -->

<ul>
<li><a href="#ec2-classic-resource-and-data-source-support">EC2-Classic resource and data source support</a></li>
<li><a href="#macie-classic-resource-support">Macie Classic resource support</a></li>
</ul>

<!-- /TOC -->

<a class="dashAnchor" name="//apple_ref/cpp/Section/Provider%20Version%20Configuration"></a><h2 id="provider-version-configuration">Provider Version Configuration</h2>

<aside class="admonition note">
    <strong>note</strong>
    <em>note</em>
    <p>Before upgrading to version 4.0.0, upgrade to the most recent 3.X version of the provider and ensure that your environment successfully runs <a href="https://www.terraform.io/docs/commands/plan.html"><code>terraform plan</code></a>. You should not see changes you don't expect or deprecation notices.</p>
</aside>

<p>Use <a href="https://www.terraform.io/docs/configuration/providers.html#provider-versions">version constraints when configuring Terraform providers</a>. If you are following that recommendation, update the version constraints in your Terraform configuration and run <a href="https://www.terraform.io/docs/commands/init.html"><code>terraform init -upgrade</code></a> to download the new version.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">required_providers</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"hashicorp/aws"</span><span class="w"></span>
<span class="w">      </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"~&gt; 3.74"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">provider</span><span class="w"> </span><span class="nv">"aws"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # Configuration options</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update to the latest 4.X version:</p>

<div class="codehilite"><pre><span></span><code><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">required_providers</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"hashicorp/aws"</span><span class="w"></span>
<span class="w">      </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"~&gt; 4.0"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">provider</span><span class="w"> </span><span class="nv">"aws"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # Configuration options</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Changes%20to%20Authentication"></a><h2 id="changes-to-authentication">Changes to Authentication</h2>

<p>The authentication configuration for the AWS Provider has changed in this version to match the behavior of other AWS products, including the AWS SDK and AWS CLI. _This will cause authentication failures in AWS provider configurations where you set a non-empty <code>profile</code> in the <code>provider</code> configuration but the profile does not correspond to an AWS profile with valid credentials._</p>

<p>Precedence for authentication settings is as follows:</p>

<ul>
<li><code>provider</code> configuration</li>
<li>Environment variables</li>
<li>Shared credentials and configuration files (_e.g._, <code>~/.aws/credentials</code> and <code>~/.aws/config</code>)</li>
</ul>

<p>In previous versions of the provider, you could explicitly set <code>profile</code> in the <code>provider</code>, and if the profile did not correspond to valid credentials, the provider would use credentials from environment variables. Starting in v4.0, the Terraform AWS provider enforces the precedence shown above, similarly to how the AWS SDK and AWS CLI behave.</p>

<p>In other words, when you explicitly set <code>profile</code> in <code>provider</code>, the AWS provider will not use environment variables per the precedence shown above. Before v4.0, if <code>profile</code> was configured in the <code>provider</code> configuration but did not correspond to an AWS profile or valid credentials, the provider would attempt to use environment variables. <strong>This is no longer the case.</strong> An explicitly set profile that does not have valid credentials will cause an authentication error.</p>

<p>For example, with the following, the environment variables will not be used:</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span><span class="nb">export</span> <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s2">"anaccesskey"</span>
<span class="gp">$ </span><span class="nb">export</span> <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s2">"asecretkey"</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kr">provider</span><span class="w"> </span><span class="nv">"aws"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">region</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"us-west-2"</span><span class="w"></span>
<span class="w">  </span><span class="na">profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"customprofile"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/New%20Provider%20Arguments"></a><h2 id="new-provider-arguments">New Provider Arguments</h2>

<p>Version 4.x adds these new <code>provider</code> arguments:</p>

<ul>
<li><code>assume_role.duration</code> - Assume role duration as a string, _e.g._, <code>"1h"</code> or <code>"1h30s"</code>. Terraform AWS Provider v4.0.0 deprecates <code>assume_role.duration_seconds</code> and a future version will remove it.</li>
<li><code>custom_ca_bundle</code> - File containing custom root and intermediate certificates. Can also be configured using the <code>AWS_CA_BUNDLE</code> environment variable. (Setting <code>ca_bundle</code> in the shared config file is not supported.)</li>
<li><code>ec2_metadata_service_endpoint</code> - Address of the EC2 metadata service (IMDS) endpoint to use. Can also be set with the <code>AWS_EC2_METADATA_SERVICE_ENDPOINT</code> environment variable.</li>
<li><code>ec2_metadata_service_endpoint_mode</code> - Mode to use in communicating with the metadata service. Valid values are <code>IPv4</code> and <code>IPv6</code>. Can also be set with the <code>AWS_EC2_METADATA_SERVICE_ENDPOINT_MODE</code> environment variable.</li>
<li><code>s3_use_path_style</code> - Replaces <code>s3_force_path_style</code>, which has been deprecated in Terraform AWS Provider v4.0.0 and support will be removed in a future version.</li>
<li><code>shared_config_files</code> - List of paths to AWS shared config files. If not set, the default is <code>[~/.aws/config]</code>. A single value can also be set with the <code>AWS_CONFIG_FILE</code> environment variable.</li>
<li><code>shared_credentials_files</code> - List of paths to the shared credentials file. If not set, the default  is <code>[~/.aws/credentials]</code>. A single value can also be set with the <code>AWS_SHARED_CREDENTIALS_FILE</code> environment variable. Replaces <code>shared_credentials_file</code>, which has been deprecated in Terraform AWS Provider v4.0.0 and support will be removed in a future version.</li>
<li><code>sts_region</code> - Region where AWS STS operations will take place. For example, <code>us-east-1</code> and <code>us-west-2</code>.</li>
<li><code>use_dualstack_endpoint</code> - Force the provider to resolve endpoints with DualStack capability. Can also be set with the <code>AWS_USE_DUALSTACK_ENDPOINT</code> environment variable or in a shared config file (<code>use_dualstack_endpoint</code>).</li>
<li><code>use_fips_endpoint</code> - Force the provider to resolve endpoints with FIPS capability. Can also be set with the <code>AWS_USE_FIPS_ENDPOINT</code> environment variable or in a shared config file (<code>use_fips_endpoint</code>).</li>
</ul>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>Using the <code>AWS_METADATA_URL</code> environment variable has been deprecated in Terraform AWS Provider v4.0.0 and support will be removed in a future version. Change any scripts or environments using <code>AWS_METADATA_URL</code> to instead use <code>AWS_EC2_METADATA_SERVICE_ENDPOINT</code>.</p>
</aside>

<p>For example, in previous versions, to use FIPS endpoints, you would need to provide all the FIPS endpoints that you wanted to use in the <code>endpoints</code> configuration block:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">provider</span><span class="w"> </span><span class="nv">"aws"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">endpoints</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">ec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://ec2-fips.us-west-2.amazonaws.com"</span><span class="w"></span>
<span class="w">    </span><span class="na">s3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://s3-fips.us-west-2.amazonaws.com"</span><span class="w"></span>
<span class="w">    </span><span class="na">sts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://sts-fips.us-west-2.amazonaws.com"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>In v4.0.0, you can still set endpoints in the same way. However, you can instead use the <code>use_fips_endpoint</code> argument to have the provider automatically resolve FIPS endpoints for all supported services:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">provider</span><span class="w"> </span><span class="nv">"aws"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">use_fips_endpoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Note that the provider can only resolve FIPS endpoints where AWS provides FIPS support. Support depends on the service and may include <code>us-east-1</code>, <code>us-east-2</code>, <code>us-west-1</code>, <code>us-west-2</code>, <code>us-gov-east-1</code>, <code>us-gov-west-1</code>, and <code>ca-central-1</code>. For more information, see <a href="https://aws.amazon.com/compliance/fips/">Federal Information Processing Standard (FIPS) 140-2</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Changes%20to%20S3%20Bucket%20Drift%20Detection"></a><h2 id="changes-to-s3-bucket-drift-detection">Changes to S3 Bucket Drift Detection</h2>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>This only applies to v4.9.0 and later of the AWS Provider.</p>
</aside>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>If you are migrating from v3.75.x of the AWS Provider and you have already adopted the standalone S3 bucket resources (e.g. <code>aws_s3_bucket_lifecycle_configuration</code>), a <a href="https://www.terraform.io/language/meta-arguments/lifecycle#ignore_changes"><code>lifecycle</code> configuration block to ignore changes</a> to the internal parameters of the source <code>aws_s3_bucket</code> resources will no longer be necessary and can be removed upon upgrade.</p>
</aside>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>In the next major version, v5.0, the parameters listed below will be removed entirely from the <code>aws_s3_bucket</code> resource. For this reason, a deprecation notice is printed in the Terraform CLI for each of the parameters when used in a configuration.</p>
</aside>

<p>To remediate the breaking changes introduced to the <code>aws_s3_bucket</code> resource in v4.0.0 of the AWS Provider,
v4.9.0 and later retain the same configuration parameters of the <code>aws_s3_bucket</code> resource as in v3.x and functionality of the <code>aws_s3_bucket</code> resource only differs from v3.x
in that Terraform will only perform drift detection for each of the following parameters if a configuration value is provided:</p>

<ul>
<li><code>acceleration_status</code></li>
<li><code>acl</code></li>
<li><code>cors_rule</code></li>
<li><code>grant</code></li>
<li><code>lifecycle_rule</code></li>
<li><code>logging</code></li>
<li><code>object_lock_configuration</code></li>
<li><code>policy</code></li>
<li><code>replication_configuration</code></li>
<li><code>request_payer</code></li>
<li><code>server_side_encryption_configuration</code></li>
<li><code>versioning</code></li>
<li><code>website</code></li>
</ul>

<p>Thus, if one of these parameters was once configured and then is entirely removed from an <code>aws_s3_bucket</code> resource configuration,
Terraform will not pick up on these changes on a subsequent <code>terraform plan</code> or <code>terraform apply</code>.</p>

<p>For example, given the following configuration with a single <code>cors_rule</code>:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"*"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"PUT", "POST"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://s3-website-test.hashicorp.com"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">expose_headers</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"ETag"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">max_age_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>When updated to the following configuration without a <code>cors_rule</code>:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Terraform CLI with v4.9.0 of the AWS Provider will report back:</p>

<div class="codehilite"><pre><span></span><code><span class="go">aws_s3_bucket.example: Refreshing state... [id=yournamehere]</span>
<span class="go">...</span>
<span class="go">No changes. Your infrastructure matches the configuration.</span>
</code></pre></div>

<p>With that said, to manage changes to these parameters in the <code>aws_s3_bucket</code> resource, practitioners should configure each parameter's respective standalone resource
and perform updates directly on those new configurations. The parameters are mapped to the standalone resources as follows:</p>

<table>
<thead>
<tr>
  <th><code>aws_s3_bucket</code> Parameter</th>
  <th>Standalone Resource</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>acceleration_status</code></td>
  <td><code>aws_s3_bucket_accelerate_configuration</code></td>
</tr>
<tr>
  <td><code>acl</code></td>
  <td><code>aws_s3_bucket_acl</code></td>
</tr>
<tr>
  <td><code>cors_rule</code></td>
  <td><code>aws_s3_bucket_cors_configuration</code></td>
</tr>
<tr>
  <td><code>grant</code></td>
  <td><code>aws_s3_bucket_acl</code></td>
</tr>
<tr>
  <td><code>lifecycle_rule</code></td>
  <td><code>aws_s3_bucket_lifecycle_configuration</code></td>
</tr>
<tr>
  <td><code>logging</code></td>
  <td><code>aws_s3_bucket_logging</code></td>
</tr>
<tr>
  <td><code>object_lock_configuration</code></td>
  <td><code>aws_s3_bucket_object_lock_configuration</code></td>
</tr>
<tr>
  <td><code>policy</code></td>
  <td><code>aws_s3_bucket_policy</code></td>
</tr>
<tr>
  <td><code>replication_configuration</code></td>
  <td><code>aws_s3_bucket_replication_configuration</code></td>
</tr>
<tr>
  <td><code>request_payer</code></td>
  <td><code>aws_s3_bucket_request_payment_configuration</code></td>
</tr>
<tr>
  <td><code>server_side_encryption_configuration</code></td>
  <td><code>aws_s3_bucket_server_side_encryption_configuration</code></td>
</tr>
<tr>
  <td><code>versioning</code></td>
  <td><code>aws_s3_bucket_versioning</code></td>
</tr>
<tr>
  <td><code>website</code></td>
  <td><code>aws_s3_bucket_website_configuration</code></td>
</tr>
</tbody>
</table>

<p>Going back to the earlier example, given the following configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"*"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"PUT", "POST"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://s3-website-test.hashicorp.com"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">expose_headers</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"ETag"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">max_age_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Practitioners can upgrade to v4.9.0 and then introduce the standalone <code>aws_s3_bucket_cors_configuration</code> resource, e.g.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>
<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_cors_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"*"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"PUT", "POST"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://s3-website-test.hashicorp.com"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">expose_headers</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"ETag"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">max_age_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Depending on the tools available to you, the above configuration can either be directly applied with Terraform or the standalone resource
can be imported into Terraform state. Please refer to each standalone resource's _Import_ documentation for the proper syntax.</p>

<p>Once the standalone resources are managed by Terraform, updates and removal can be performed as needed.</p>

<p>The following sections depict standalone resource adoption per individual parameter. Standalone resource adoption is not required to upgrade but is recommended to ensure drift is detected by Terraform.
The examples below are by no means exhaustive. The aim is to provide important concepts when migrating to a standalone resource whose parameters may not entirely align with the corresponding parameter in the <code>aws_s3_bucket</code> resource.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_accelerate_configuration"></a><h3 id="migrating-to-aws_s3_bucket_accelerate_configuration">Migrating to <code>aws_s3_bucket_accelerate_configuration</code></h3>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="na">acceleration_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_accelerate_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_acl"></a><h3 id="migrating-to-aws_s3_bucket_acl">Migrating to <code>aws_s3_bucket_acl</code></h3>

<a class="dashAnchor" name="//apple_ref/cpp/Section/With%20acl"></a><h4 id="with-acl">With <code>acl</code></h4>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="w"></span>
<span class="w">  </span><span class="na">acl</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"private"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_acl"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">acl</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"private"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/With%20grant"></a><h4 id="with-grant">With <code>grant</code></h4>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">grant</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_canonical_user_id.current_user.id</span><span class="w"></span>
<span class="w">    </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"CanonicalUser"</span><span class="w"></span>
<span class="w">    </span><span class="na">permissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"FULL_CONTROL"</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">grant</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"Group"</span><span class="w"></span>
<span class="w">    </span><span class="na">permissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"READ_ACP", "WRITE"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">uri</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://acs.amazonaws.com/groups/s3/LogDelivery"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_acl"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">access_control_policy</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">grant</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">grantee</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_canonical_user_id.current_user.id</span><span class="w"></span>
<span class="w">        </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"CanonicalUser"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="na">permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"FULL_CONTROL"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">grant</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">grantee</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Group"</span><span class="w"></span>
<span class="w">        </span><span class="na">uri</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://acs.amazonaws.com/groups/s3/LogDelivery"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="na">permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"READ_ACP"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">grant</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">grantee</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Group"</span><span class="w"></span>
<span class="w">        </span><span class="na">uri</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://acs.amazonaws.com/groups/s3/LogDelivery"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="na">permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"WRITE"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">owner</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_canonical_user_id.current_user.id</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_cors_configuration"></a><h3 id="migrating-to-aws_s3_bucket_cors_configuration">Migrating to <code>aws_s3_bucket_cors_configuration</code></h3>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"*"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"PUT", "POST"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://s3-website-test.hashicorp.com"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">expose_headers</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"ETag"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">max_age_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_cors_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"*"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"PUT", "POST"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://s3-website-test.hashicorp.com"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">expose_headers</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"ETag"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">max_age_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_lifecycle_configuration"></a><h3 id="migrating-to-aws_s3_bucket_lifecycle_configuration">Migrating to <code>aws_s3_bucket_lifecycle_configuration</code></h3>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>In version <code>3.x</code> of the provider, the <code>lifecycle_rule.id</code> argument was optional, while in version <code>4.x</code>, the <code>aws_s3_bucket_lifecycle_configuration.rule.id</code> argument required. Use the AWS CLI s3api <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3api/get-bucket-lifecycle-configuration.html">get-bucket-lifecycle-configuration</a> to get the source bucket's lifecycle configuration to determine the ID.</p>
</aside>

<a class="dashAnchor" name="//apple_ref/cpp/Section/For%20Lifecycle%20Rules%20with%20no%20prefix%20previously%20configured"></a><h4 id="for-lifecycle-rules-with-no-prefix-previously-configured">For Lifecycle Rules with no <code>prefix</code> previously configured</h4>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>When configuring the <code>rule.filter</code> configuration block in the new <code>aws_s3_bucket_lifecycle_configuration</code> resource, use the AWS CLI s3api <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3api/get-bucket-lifecycle-configuration.html">get-bucket-lifecycle-configuration</a> to get the source bucket's lifecycle configuration and determine if the <code>Filter</code> is configured as <code>"Filter" : {}</code> or <code>"Filter" : { "Prefix": "" }</code>. If AWS returns the former, configure <code>rule.filter</code> as <code>filter {}</code>. Otherwise, neither a <code>rule.filter</code> nor <code>rule.prefix</code> parameter should be configured as shown here:</p>
</aside>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="w"></span>

<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"Keep previous version 30 days, then in Glacier another 60"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>

<span class="w">    </span><span class="nb">noncurrent_version_transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">noncurrent_version_expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">                                     </span><span class="o">=</span><span class="w"> </span><span class="s2">"Delete old incomplete multi-part uploads"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w">                                </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">abort_incomplete_multipart_upload_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"Keep previous version 30 days, then in Glacier another 60"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">noncurrent_version_transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">noncurrent_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">noncurrent_version_expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">noncurrent_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"Delete old incomplete multi-part uploads"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">abort_incomplete_multipart_upload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days_after_initiation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/For%20Lifecycle%20Rules%20with%20prefix%20previously%20configured%20as%20an%20empty%20string"></a><h4 id="for-lifecycle-rules-with-prefix-previously-configured-as-an-empty-string">For Lifecycle Rules with <code>prefix</code> previously configured as an empty string</h4>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="w"></span>

<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"log-expiration"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">prefix</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">180</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"log-expiration"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">180</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/For%20Lifecycle%20Rules%20with%20prefix"></a><h4 id="for-lifecycle-rules-with-prefix">For Lifecycle Rules with <code>prefix</code></h4>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="w"></span>

<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"log-expiration"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">prefix</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"foobar"</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">180</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"log-expiration"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"foobar"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">180</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/For%20Lifecycle%20Rules%20with%20prefix%20and%20tags"></a><h4 id="for-lifecycle-rules-with-prefix-and-tags">For Lifecycle Rules with <code>prefix</code> and <code>tags</code></h4>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"log"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">prefix</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"log/"</span><span class="w"></span>

<span class="w">    </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">rule</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"log"</span><span class="w"></span>
<span class="w">      </span><span class="na">autoclean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"true"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">60</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp"</span><span class="w"></span>
<span class="w">    </span><span class="na">prefix</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp/"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>

<span class="w">    </span><span class="nb">expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2022-12-31"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"log"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">and</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"log/"</span><span class="w"></span>

<span class="w">        </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">rule</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"log"</span><span class="w"></span>
<span class="w">          </span><span class="na">autoclean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"true"</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">60</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp/"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2022-12-31T00:00:00Z"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_logging"></a><h3 id="migrating-to-aws_s3_bucket_logging">Migrating to <code>aws_s3_bucket_logging</code></h3>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"log_bucket"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"example-log-bucket"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">logging</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">target_bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.log_bucket.id</span><span class="w"></span>
<span class="w">    </span><span class="na">target_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"log/"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"log_bucket"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"example-log-bucket"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_logging"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">target_bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.log_bucket.id</span><span class="w"></span>
<span class="w">  </span><span class="na">target_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"log/"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_object_lock_configuration"></a><h3 id="migrating-to-aws_s3_bucket_object_lock_configuration">Migrating to <code>aws_s3_bucket_object_lock_configuration</code></h3>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">object_lock_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">object_lock_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">default_retention</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"COMPLIANCE"</span><span class="w"></span>
<span class="w">        </span><span class="na">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="na">object_lock_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_object_lock_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">default_retention</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"COMPLIANCE"</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_policy"></a><h3 id="migrating-to-aws_s3_bucket_policy">Migrating to <code>aws_s3_bucket_policy</code></h3>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="dl">EOF</span><span class="sh"></span>
<span class="sh">{</span>
<span class="sh">  "Id": "Policy1446577137248",</span>
<span class="sh">  "Statement": [</span>
<span class="sh">    {</span>
<span class="sh">      "Action": "s3:PutObject",</span>
<span class="sh">      "Effect": "Allow",</span>
<span class="sh">      "Principal": {</span>
<span class="sh">        "AWS": "${data.aws_elb_service_account.current.arn}"</span>
<span class="sh">      },</span>
<span class="sh">      "Resource": "arn:${data.aws_partition.current.partition}:s3:::yournamehere/*",</span>
<span class="sh">      "Sid": "Stmt1446575236270"</span>
<span class="sh">    }</span>
<span class="sh">  ],</span>
<span class="sh">  "Version": "2012-10-17"</span>
<span class="sh">}</span>
<span class="dl">EOF</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_policy"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="dl">EOF</span><span class="sh"></span>
<span class="sh">{</span>
<span class="sh">  "Id": "Policy1446577137248",</span>
<span class="sh">  "Statement": [</span>
<span class="sh">    {</span>
<span class="sh">      "Action": "s3:PutObject",</span>
<span class="sh">      "Effect": "Allow",</span>
<span class="sh">      "Principal": {</span>
<span class="sh">        "AWS": "${data.aws_elb_service_account.current.arn}"</span>
<span class="sh">      },</span>
<span class="sh">      "Resource": "${aws_s3_bucket.example.arn}/*",</span>
<span class="sh">      "Sid": "Stmt1446575236270"</span>
<span class="sh">    }</span>
<span class="sh">  ],</span>
<span class="sh">  "Version": "2012-10-17"</span>
<span class="sh">}</span>
<span class="dl">EOF</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_replication_configuration"></a><h3 id="migrating-to-aws_s3_bucket_replication_configuration">Migrating to <code>aws_s3_bucket_replication_configuration</code></h3>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws.central</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>

<span class="w">  </span><span class="nb">replication_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.replication.arn</span><span class="w"></span>
<span class="w">    </span><span class="nb">rules</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"foobar"</span><span class="w"></span>
<span class="w">      </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">      </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="nb">destination</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">bucket</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.destination.arn</span><span class="w"></span>
<span class="w">        </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD"</span><span class="w"></span>
<span class="w">        </span><span class="nb">replication_time</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">status</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">          </span><span class="na">minutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="nb">metrics</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">status</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">          </span><span class="na">minutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws.central</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_replication_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.source.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.replication.arn</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"foobar"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">    </span><span class="nb">delete_marker_replication</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">destination</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">bucket</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.destination.arn</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD"</span><span class="w"></span>

<span class="w">      </span><span class="nb">replication_time</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">        </span><span class="nb">time</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">minutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="nb">metrics</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">        </span><span class="nb">event_threshold</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">minutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_request_payment_configuration"></a><h3 id="migrating-to-aws_s3_bucket_request_payment_configuration">Migrating to <code>aws_s3_bucket_request_payment_configuration</code></h3>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="na">request_payer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Requester"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_request_payment_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">payer</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"Requester"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_server_side_encryption_configuration"></a><h3 id="migrating-to-aws_s3_bucket_server_side_encryption_configuration">Migrating to <code>aws_s3_bucket_server_side_encryption_configuration</code></h3>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">server_side_encryption_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">apply_server_side_encryption_by_default</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">kms_master_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_kms_key.mykey.arn</span><span class="w"></span>
<span class="w">        </span><span class="na">sse_algorithm</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"aws:kms"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_server_side_encryption_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">apply_server_side_encryption_by_default</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">kms_master_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_kms_key.mykey.arn</span><span class="w"></span>
<span class="w">      </span><span class="na">sse_algorithm</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"aws:kms"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_versioning"></a><h3 id="migrating-to-aws_s3_bucket_versioning">Migrating to <code>aws_s3_bucket_versioning</code></h3>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>As <code>aws_s3_bucket_versioning</code> is a separate resource, any S3 objects for which versioning is important (_e.g._, a truststore for mutual TLS authentication) must implicitly or explicitly depend on the <code>aws_s3_bucket_versioning</code> resource. Otherwise, the S3 objects may be created before versioning has been set. <a href="#ensure-objects-depend-on-versioning">See below</a> for an example. Also note that AWS recommends waiting 15 minutes after enabling versioning on a bucket before putting or deleting objects in/from the bucket.</p>
</aside>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Buckets%20With%20Versioning%20Enabled"></a><h4 id="buckets-with-versioning-enabled">Buckets With Versioning Enabled</h4>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">versioning</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_versioning"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Buckets%20With%20Versioning%20Disabled%20or%20Suspended"></a><h4 id="buckets-with-versioning-disabled-or-suspended">Buckets With Versioning Disabled or Suspended</h4>

<p>Depending on the version of the Terraform AWS Provider you are migrating from, the interpretation of <code>versioning.enabled = false</code>
in your <code>aws_s3_bucket</code> resource will differ and thus the migration to the <code>aws_s3_bucket_versioning</code> resource will also differ as follows.</p>

<p>If you are migrating from the Terraform AWS Provider <code>v3.70.0</code> or later:</p>

<ul>
<li>For new S3 buckets, <code>enabled = false</code> is synonymous to <code>Disabled</code>.</li>
<li>For existing S3 buckets, <code>enabled = false</code> is synonymous to <code>Suspended</code>.</li>
</ul>

<p>If you are migrating from an earlier version of the Terraform AWS Provider:</p>

<ul>
<li>For both new and existing S3 buckets, <code>enabled = false</code> is synonymous to <code>Suspended</code>.</li>
</ul>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">versioning</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to one of the following:</p>

<ul>
<li><p>If migrating from Terraform AWS Provider <code>v3.70.0</code> or later and bucket versioning was never enabled:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_versioning"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></li>
<li><p>If migrating from Terraform AWS Provider <code>v3.70.0</code> or later and bucket versioning was enabled at one point:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_versioning"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Suspended"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></li>
<li><p>If migrating from an earlier version of Terraform AWS Provider:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_versioning"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Suspended"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Ensure%20Objects%20Depend%20on%20Versioning"></a><h4 id="ensure-objects-depend-on-versioning">Ensure Objects Depend on Versioning</h4>

<p>When you create an object whose <code>version_id</code> you need and an <code>aws_s3_bucket_versioning</code> resource in the same configuration, you are more likely to have success by ensuring the <code>s3_object</code> depends either implicitly (see below) or explicitly (i.e., using <code>depends_on = [aws_s3_bucket_versioning.example]</code>) on the <code>aws_s3_bucket_versioning</code> resource.</p>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>For critical and/or production S3 objects, do not create a bucket, enable versioning, and create an object in the bucket within the same configuration. Doing so will not allow the AWS-recommended 15 minutes between enabling versioning and writing to the bucket.</p>
</aside>

<p>This example shows the <code>aws_s3_object.example</code> depending implicitly on the versioning resource through the reference to <code>aws_s3_bucket_versioning.example.id</code> to define <code>bucket</code>:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yotto"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_versioning"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_object"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket_versioning.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">key</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"droeloe"</span><span class="w"></span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"example.txt"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Migrating%20to%20aws_s3_bucket_website_configuration"></a><h3 id="migrating-to-aws_s3_bucket_website_configuration">Migrating to <code>aws_s3_bucket_website_configuration</code></h3>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">website</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">index_document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"index.html"</span><span class="w"></span>
<span class="w">    </span><span class="na">error_document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"error.html"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_website_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">index_document</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"index.html"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">error_document</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"error.html"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Given this previous configuration that uses the <code>aws_s3_bucket</code> parameter <code>website_domain</code> with <code>aws_route53_record</code>:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route53_zone"</span><span class="w"> </span><span class="nv">"main"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"domain.test"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"website"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">website</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">index_document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"index.html"</span><span class="w"></span>
<span class="w">    </span><span class="na">error_document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"error.html"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route53_record"</span><span class="w"> </span><span class="nv">"alias"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_route53_zone.main.zone_id</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"www"</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"A"</span><span class="w"></span>

<span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">zone_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.hosted_zone_id</span><span class="w"></span>
<span class="w">    </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.website_domain</span><span class="w"></span>
<span class="w">    </span><span class="na">evaluate_target_health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Update the configuration to use the <code>aws_s3_bucket_website_configuration</code> resource and its <code>website_domain</code> parameter:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route53_zone"</span><span class="w"> </span><span class="nv">"main"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"domain.test"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"website"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_website_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">index_document</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"index.html"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route53_record"</span><span class="w"> </span><span class="nv">"alias"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_route53_zone.main.zone_id</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"www"</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"A"</span><span class="w"></span>

<span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">zone_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.hosted_zone_id</span><span class="w"></span>
<span class="w">    </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket_website_configuration.example.website_domain</span><span class="w"></span>
<span class="w">    </span><span class="na">evaluate_target_health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/S3%20Bucket%20Refactor"></a><h2 id="s3-bucket-refactor">S3 Bucket Refactor</h2>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>This only applies to v4.0.0 through v4.8.0 of the AWS Provider, which introduce significant breaking changes to the <code>aws_s3_bucket</code> resource. We recommend upgrading to v4.9.0 of the AWS Provider instead. See the section above, <a href="#changes-to-s3-bucket-drift-detection">Changes to S3 Bucket Drift Detection</a>, for additional upgrade considerations.</p>
</aside>

<p>To help distribute the management of S3 bucket settings via independent resources, various arguments and attributes in the <code>aws_s3_bucket</code> resource have become <strong>read-only</strong>.</p>

<p>Configurations dependent on these arguments should be updated to use the corresponding <code>aws_s3_bucket_*</code> resource in order to prevent Terraform from reporting unconfigurable attribute errors for read-only arguments. Once updated, it is recommended to import new <code>aws_s3_bucket_*</code> resources into Terraform state.</p>

<p>In the event practitioners do not anticipate future modifications to the S3 bucket settings associated with these read-only arguments or drift detection is not needed, these read-only arguments should be removed from <code>aws_s3_bucket</code> resource configurations in order to prevent Terraform from reporting unconfigurable attribute errors; the states of these arguments will be preserved but are subject to change with modifications made outside Terraform.</p>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>Each of the new <code>aws_s3_bucket_*</code> resources relies on S3 API calls that utilize a <code>PUT</code> action in order to modify the target S3 bucket. These calls follow standard HTTP methods for REST APIs, and therefore <strong>should</strong> handle situations where the target configuration already exists. While it is not strictly necessary to import new <code>aws_s3_bucket_*</code> resources where the updated configuration matches the configuration used in previous versions of the AWS provider, skipping this step will lead to a diff in the first plan after a configuration change indicating that any new <code>aws_s3_bucket_*</code> resources will be created, making it more difficult to determine whether the appropriate actions will be taken.</p>
</aside>

<a class="dashAnchor" name="//apple_ref/cpp/Section/acceleration_status%20Argument"></a><h3 id="acceleration_status-argument"><code>acceleration_status</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_accelerate_configuration.html"><code>aws_s3_bucket_accelerate_configuration</code> resource</a> instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="na">acceleration_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "acceleration_status": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>acceleration_status</code> is now read only, update your configuration to use the <code>aws_s3_bucket_accelerate_configuration</code>
resource and remove <code>acceleration_status</code> in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_accelerate_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_accelerate_configuration.example yournamehere
<span class="go">aws_s3_bucket_accelerate_configuration.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_accelerate_configuration.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_accelerate_configuration for import</span>
<span class="go">aws_s3_bucket_accelerate_configuration.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/acl%20Argument"></a><h3 id="acl-argument"><code>acl</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_acl.html"><code>aws_s3_bucket_acl</code> resource</a> instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="w"></span>
<span class="w">  </span><span class="na">acl</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"private"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "acl": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>acl</code> is now read only, update your configuration to use the <code>aws_s3_bucket_acl</code>
resource and remove the <code>acl</code> argument in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_acl"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">acl</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"private"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>When importing into <code>aws_s3_bucket_acl</code>, make sure you use the S3 bucket name (_e.g._, <code>yournamehere</code> in the example above) as part of the ID, and _not_ the Terraform bucket configuration name (_e.g._, <code>example</code> in the example above).</p>
</aside>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_acl.example yournamehere,private
<span class="go">aws_s3_bucket_acl.example: Importing from ID "yournamehere,private"...</span>
<span class="go">aws_s3_bucket_acl.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_acl for import</span>
<span class="go">aws_s3_bucket_acl.example: Refreshing state... [id=yournamehere,private]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/cors_rule%20Argument"></a><h3 id="cors_rule-argument"><code>cors_rule</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_cors_configuration.html"><code>aws_s3_bucket_cors_configuration</code> resource</a> instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"*"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"PUT", "POST"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://s3-website-test.hashicorp.com"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">expose_headers</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"ETag"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">max_age_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "cors_rule": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>cors_rule</code> is now read only, update your configuration to use the <code>aws_s3_bucket_cors_configuration</code>
resource and remove <code>cors_rule</code> and its nested arguments in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_cors_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"*"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"PUT", "POST"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://s3-website-test.hashicorp.com"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">expose_headers</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"ETag"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">max_age_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_cors_configuration.example yournamehere
<span class="go">aws_s3_bucket_cors_configuration.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_cors_configuration.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_cors_configuration for import</span>
<span class="go">aws_s3_bucket_cors_configuration.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/grant%20Argument"></a><h3 id="grant-argument"><code>grant</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_acl.html"><code>aws_s3_bucket_acl</code> resource</a> instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">grant</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_canonical_user_id.current_user.id</span><span class="w"></span>
<span class="w">    </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"CanonicalUser"</span><span class="w"></span>
<span class="w">    </span><span class="na">permissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"FULL_CONTROL"</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">grant</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"Group"</span><span class="w"></span>
<span class="w">    </span><span class="na">permissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"READ_ACP", "WRITE"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">uri</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://acs.amazonaws.com/groups/s3/LogDelivery"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "grant": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>grant</code> is now read only, update your configuration to use the <code>aws_s3_bucket_acl</code>
resource and remove <code>grant</code> in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_acl"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">access_control_policy</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">grant</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">grantee</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_canonical_user_id.current_user.id</span><span class="w"></span>
<span class="w">        </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"CanonicalUser"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="na">permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"FULL_CONTROL"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">grant</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">grantee</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Group"</span><span class="w"></span>
<span class="w">        </span><span class="na">uri</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://acs.amazonaws.com/groups/s3/LogDelivery"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="na">permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"READ_ACP"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">grant</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">grantee</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Group"</span><span class="w"></span>
<span class="w">        </span><span class="na">uri</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://acs.amazonaws.com/groups/s3/LogDelivery"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="na">permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"WRITE"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">owner</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_canonical_user_id.current_user.id</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_acl.example yournamehere
<span class="go">aws_s3_bucket_acl.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_acl.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_acl for import</span>
<span class="go">aws_s3_bucket_acl.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/lifecycle_rule%20Argument"></a><h3 id="lifecycle_rule-argument"><code>lifecycle_rule</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_lifecycle_configuration.html"><code>aws_s3_bucket_lifecycle_configuration</code> resource</a> instead.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/For%20Lifecycle%20Rules%20with%20no%20prefix%20previously%20configured"></a><h4 id="for-lifecycle-rules-with-no-prefix-previously-configured-2">For Lifecycle Rules with no <code>prefix</code> previously configured</h4>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="w"></span>

<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"Keep previous version 30 days, then in Glacier another 60"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>

<span class="w">    </span><span class="nb">noncurrent_version_transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">noncurrent_version_expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">                                     </span><span class="o">=</span><span class="w"> </span><span class="s2">"Delete old incomplete multi-part uploads"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w">                                </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">abort_incomplete_multipart_upload_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will receive the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "lifecycle_rule": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since the <code>lifecycle_rule</code> argument changed to read-only, update the configuration to use the <code>aws_s3_bucket_lifecycle_configuration</code>
resource and remove <code>lifecycle_rule</code> and its nested arguments in the <code>aws_s3_bucket</code> resource.</p>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>When configuring the <code>rule.filter</code> configuration block in the new <code>aws_s3_bucket_lifecycle_configuration</code> resource, use the AWS CLI s3api <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3api/get-bucket-lifecycle-configuration.html">get-bucket-lifecycle-configuration</a> to get the source bucket's lifecycle configuration and determine if the <code>Filter</code> is configured as <code>"Filter" : {}</code> or <code>"Filter" : { "Prefix": "" }</code>. If AWS returns the former, configure <code>rule.filter</code> as <code>filter {}</code>. Otherwise, neither a <code>rule.filter</code> nor <code>rule.prefix</code> parameter should be configured as shown here:</p>
</aside>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"Keep previous version 30 days, then in Glacier another 60"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">noncurrent_version_transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">noncurrent_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">noncurrent_version_expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">noncurrent_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"Delete old incomplete multi-part uploads"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">abort_incomplete_multipart_upload</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days_after_initiation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_lifecycle_configuration.example yournamehere
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_lifecycle_configuration for import</span>
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/For%20Lifecycle%20Rules%20with%20prefix%20previously%20configured%20as%20an%20empty%20string"></a><h4 id="for-lifecycle-rules-with-prefix-previously-configured-as-an-empty-string-2">For Lifecycle Rules with <code>prefix</code> previously configured as an empty string</h4>

<p>For example, given this configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="w"></span>

<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"log-expiration"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">prefix</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">180</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will receive the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "lifecycle_rule": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since the <code>lifecycle_rule</code> argument changed to read-only, update the configuration to use the <code>aws_s3_bucket_lifecycle_configuration</code>
resource and remove <code>lifecycle_rule</code> and its nested arguments in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"log-expiration"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">180</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_lifecycle_configuration.example yournamehere
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_lifecycle_configuration for import</span>
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/For%20Lifecycle%20Rules%20with%20prefix"></a><h4 id="for-lifecycle-rules-with-prefix-2">For Lifecycle Rules with <code>prefix</code></h4>

<p>For example, given this configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="w"></span>

<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"log-expiration"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">prefix</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"foobar"</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">180</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will receive the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "lifecycle_rule": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since the <code>lifecycle_rule</code> argument changed to read-only, update the configuration to use the <code>aws_s3_bucket_lifecycle_configuration</code>
resource and remove <code>lifecycle_rule</code> and its nested arguments in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"log-expiration"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"foobar"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">180</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_lifecycle_configuration.example yournamehere
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_lifecycle_configuration for import</span>
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/For%20Lifecycle%20Rules%20with%20prefix%20and%20tags"></a><h4 id="for-lifecycle-rules-with-prefix-and-tags-2">For Lifecycle Rules with <code>prefix</code> and <code>tags</code></h4>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"log"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">prefix</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"log/"</span><span class="w"></span>

<span class="w">    </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">rule</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"log"</span><span class="w"></span>
<span class="w">      </span><span class="na">autoclean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"true"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">60</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">lifecycle_rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp"</span><span class="w"></span>
<span class="w">    </span><span class="na">prefix</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp/"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>

<span class="w">    </span><span class="nb">expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2022-12-31"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "lifecycle_rule": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>lifecycle_rule</code> is now read only, update your configuration to use the <code>aws_s3_bucket_lifecycle_configuration</code>
resource and remove <code>lifecycle_rule</code> and its nested arguments in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"log"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">and</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"log/"</span><span class="w"></span>

<span class="w">        </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">rule</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"log"</span><span class="w"></span>
<span class="w">          </span><span class="na">autoclean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"true"</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">60</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp/"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2022-12-31T00:00:00Z"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_lifecycle_configuration.example yournamehere
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_lifecycle_configuration for import</span>
<span class="go">aws_s3_bucket_lifecycle_configuration.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/logging%20Argument"></a><h3 id="logging-argument"><code>logging</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_logging.html"><code>aws_s3_bucket_logging</code> resource</a> instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"log_bucket"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"example-log-bucket"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">logging</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">target_bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.log_bucket.id</span><span class="w"></span>
<span class="w">    </span><span class="na">target_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"log/"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "logging": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>logging</code> is now read only, update your configuration to use the <code>aws_s3_bucket_logging</code>
resource and remove <code>logging</code> and its nested arguments in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"log_bucket"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"example-log-bucket"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_logging"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">target_bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.log_bucket.id</span><span class="w"></span>
<span class="w">  </span><span class="na">target_prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"log/"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_logging.example yournamehere
<span class="go">aws_s3_bucket_logging.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_logging.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_logging for import</span>
<span class="go">aws_s3_bucket_logging.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/object_lock_configuration%20rule%20Argument"></a><h3 id="object_lock_configuration-rule-argument"><code>object_lock_configuration</code> <code>rule</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_object_lock_configuration.html"><code>aws_s3_bucket_object_lock_configuration</code> resource</a> instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">object_lock_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">object_lock_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">default_retention</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"COMPLIANCE"</span><span class="w"></span>
<span class="w">        </span><span class="na">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "object_lock_configuration.0.rule": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since the <code>rule</code> argument of the <code>object_lock_configuration</code> configuration block changed to read-only, update your configuration to use the <code>aws_s3_bucket_object_lock_configuration</code>
resource and remove <code>rule</code> and its nested arguments in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="na">object_lock_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_object_lock_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">default_retention</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"COMPLIANCE"</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_object_lock_configuration.example yournamehere
<span class="go">aws_s3_bucket_object_lock_configuration.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_object_lock_configuration.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_object_lock_configuration for import</span>
<span class="go">aws_s3_bucket_object_lock_configuration.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/policy%20Argument"></a><h3 id="policy-argument"><code>policy</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_policy.html"><code>aws_s3_bucket_policy</code> resource</a> instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="dl">EOF</span><span class="sh"></span>
<span class="sh">{</span>
<span class="sh">  "Id": "Policy1446577137248",</span>
<span class="sh">  "Statement": [</span>
<span class="sh">    {</span>
<span class="sh">      "Action": "s3:PutObject",</span>
<span class="sh">      "Effect": "Allow",</span>
<span class="sh">      "Principal": {</span>
<span class="sh">        "AWS": "${data.aws_elb_service_account.current.arn}"</span>
<span class="sh">      },</span>
<span class="sh">      "Resource": "arn:${data.aws_partition.current.partition}:s3:::yournamehere/*",</span>
<span class="sh">      "Sid": "Stmt1446575236270"</span>
<span class="sh">    }</span>
<span class="sh">  ],</span>
<span class="sh">  "Version": "2012-10-17"</span>
<span class="sh">}</span>
<span class="dl">EOF</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "policy": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>policy</code> is now read only, update your configuration to use the <code>aws_s3_bucket_policy</code>
resource and remove <code>policy</code> in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_policy"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="dl">EOF</span><span class="sh"></span>
<span class="sh">{</span>
<span class="sh">  "Id": "Policy1446577137248",</span>
<span class="sh">  "Statement": [</span>
<span class="sh">    {</span>
<span class="sh">      "Action": "s3:PutObject",</span>
<span class="sh">      "Effect": "Allow",</span>
<span class="sh">      "Principal": {</span>
<span class="sh">        "AWS": "${data.aws_elb_service_account.current.arn}"</span>
<span class="sh">      },</span>
<span class="sh">      "Resource": "${aws_s3_bucket.example.arn}/*",</span>
<span class="sh">      "Sid": "Stmt1446575236270"</span>
<span class="sh">    }</span>
<span class="sh">  ],</span>
<span class="sh">  "Version": "2012-10-17"</span>
<span class="sh">}</span>
<span class="dl">EOF</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_policy.example yournamehere
<span class="go">aws_s3_bucket_policy.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_policy.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_policy for import</span>
<span class="go">aws_s3_bucket_policy.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/replication_configuration%20Argument"></a><h3 id="replication_configuration-argument"><code>replication_configuration</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_replication_configuration.html"><code>aws_s3_bucket_replication_configuration</code> resource</a> instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws.central</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>

<span class="w">  </span><span class="nb">replication_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.replication.arn</span><span class="w"></span>
<span class="w">    </span><span class="nb">rules</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"foobar"</span><span class="w"></span>
<span class="w">      </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">      </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="nb">destination</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">bucket</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.destination.arn</span><span class="w"></span>
<span class="w">        </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD"</span><span class="w"></span>
<span class="w">        </span><span class="nb">replication_time</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">status</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">          </span><span class="na">minutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="nb">metrics</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">status</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">          </span><span class="na">minutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "replication_configuration": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>replication_configuration</code> is now read only, update your configuration to use the <code>aws_s3_bucket_replication_configuration</code>
resource and remove <code>replication_configuration</code> and its nested arguments in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws.central</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_replication_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.replication.arn</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"foobar"</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">    </span><span class="nb">delete_marker_replication</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">destination</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">bucket</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.destination.arn</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD"</span><span class="w"></span>

<span class="w">      </span><span class="nb">replication_time</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">        </span><span class="nb">time</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">minutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="nb">metrics</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">        </span><span class="nb">event_threshold</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">minutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_replication_configuration.example yournamehere
<span class="go">aws_s3_bucket_replication_configuration.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_replication_configuration.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_replication_configuration for import</span>
<span class="go">aws_s3_bucket_replication_configuration.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/request_payer%20Argument"></a><h3 id="request_payer-argument"><code>request_payer</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_request_payment_configuration.html"><code>aws_s3_bucket_request_payment_configuration</code> resource</a> instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="na">request_payer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Requester"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "request_payer": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>request_payer</code> is now read only, update your configuration to use the <code>aws_s3_bucket_request_payment_configuration</code>
resource and remove <code>request_payer</code> in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_request_payment_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">payer</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"Requester"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_request_payment_configuration.example yournamehere
<span class="go">aws_s3_bucket_request_payment_configuration.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_request_payment_configuration.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_request_payment_configuration for import</span>
<span class="go">aws_s3_bucket_request_payment_configuration.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/server_side_encryption_configuration%20Argument"></a><h3 id="server_side_encryption_configuration-argument"><code>server_side_encryption_configuration</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_server_side_encryption_configuration.html"><code>aws_s3_bucket_server_side_encryption_configuration</code> resource</a> instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">server_side_encryption_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">apply_server_side_encryption_by_default</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">kms_master_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_kms_key.mykey.arn</span><span class="w"></span>
<span class="w">        </span><span class="na">sse_algorithm</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"aws:kms"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "server_side_encryption_configuration": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>server_side_encryption_configuration</code> is now read only, update your configuration to use the <code>aws_s3_bucket_server_side_encryption_configuration</code>
resource and remove <code>server_side_encryption_configuration</code> and its nested arguments in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_server_side_encryption_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">apply_server_side_encryption_by_default</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">kms_master_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_kms_key.mykey.arn</span><span class="w"></span>
<span class="w">      </span><span class="na">sse_algorithm</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"aws:kms"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_server_side_encryption_configuration.example yournamehere
<span class="go">aws_s3_bucket_server_side_encryption_configuration.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_server_side_encryption_configuration.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_server_side_encryption_configuration for import</span>
<span class="go">aws_s3_bucket_server_side_encryption_configuration.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/versioning%20Argument"></a><h3 id="versioning-argument"><code>versioning</code> Argument</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_versioning.html"><code>aws_s3_bucket_versioning</code> resource</a> instead.</p>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>As <code>aws_s3_bucket_versioning</code> is a separate resource, any S3 objects for which versioning is important (_e.g._, a truststore for mutual TLS authentication) must implicitly or explicitly depend on the <code>aws_s3_bucket_versioning</code> resource. Otherwise, the S3 objects may be created before versioning has been set. <a href="#ensure-objects-depend-on-versioning">See below</a> for an example. Also note that AWS recommends waiting 15 minutes after enabling versioning on a bucket before putting or deleting objects in/from the bucket.</p>
</aside>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Buckets%20With%20Versioning%20Enabled"></a><h4 id="buckets-with-versioning-enabled-2">Buckets With Versioning Enabled</h4>

<p>Given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">versioning</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "versioning": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>versioning</code> is now read only, update your configuration to use the <code>aws_s3_bucket_versioning</code>
resource and remove <code>versioning</code> and its nested arguments in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_versioning"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_versioning.example yournamehere
<span class="go">aws_s3_bucket_versioning.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_versioning.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_versioning for import</span>
<span class="go">aws_s3_bucket_versioning.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Buckets%20With%20Versioning%20Disabled%20or%20Suspended"></a><h4 id="buckets-with-versioning-disabled-or-suspended-2">Buckets With Versioning Disabled or Suspended</h4>

<p>Depending on the version of the Terraform AWS Provider you are migrating from, the interpretation of <code>versioning.enabled = false</code>
in your <code>aws_s3_bucket</code> resource will differ and thus the migration to the <code>aws_s3_bucket_versioning</code> resource will also differ as follows.</p>

<p>If you are migrating from the Terraform AWS Provider <code>v3.70.0</code> or later:</p>

<ul>
<li>For new S3 buckets, <code>enabled = false</code> is synonymous to <code>Disabled</code>.</li>
<li>For existing S3 buckets, <code>enabled = false</code> is synonymous to <code>Suspended</code>.</li>
</ul>

<p>If you are migrating from an earlier version of the Terraform AWS Provider:</p>

<ul>
<li>For both new and existing S3 buckets, <code>enabled = false</code> is synonymous to <code>Suspended</code>.</li>
</ul>

<p>Given this previous configuration :</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">versioning</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "versioning": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>versioning</code> is now read only, update your configuration to use the <code>aws_s3_bucket_versioning</code>
resource and remove <code>versioning</code> and its nested arguments in the <code>aws_s3_bucket</code> resource.</p>

<ul>
<li><p>If migrating from Terraform AWS Provider <code>v3.70.0</code> or later and bucket versioning was never enabled:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_versioning"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Disabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></li>
<li><p>If migrating from Terraform AWS Provider <code>v3.70.0</code> or later and bucket versioning was enabled at one point:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_versioning"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Suspended"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></li>
<li><p>If migrating from an earlier version of Terraform AWS Provider:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_versioning"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>
<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Suspended"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></li>
</ul>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_versioning.example yournamehere
<span class="go">aws_s3_bucket_versioning.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_versioning.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_versioning for import</span>
<span class="go">aws_s3_bucket_versioning.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Ensure%20Objects%20Depend%20on%20Versioning"></a><h4 id="ensure-objects-depend-on-versioning-2">Ensure Objects Depend on Versioning</h4>

<p>When you create an object whose <code>version_id</code> you need and an <code>aws_s3_bucket_versioning</code> resource in the same configuration, you are more likely to have success by ensuring the <code>s3_object</code> depends either implicitly (see below) or explicitly (i.e., using <code>depends_on = [aws_s3_bucket_versioning.example]</code>) on the <code>aws_s3_bucket_versioning</code> resource.</p>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>For critical and/or production S3 objects, do not create a bucket, enable versioning, and create an object in the bucket within the same configuration. Doing so will not allow the AWS-recommended 15 minutes between enabling versioning and writing to the bucket.</p>
</aside>

<p>This example shows the <code>aws_s3_object.example</code> depending implicitly on the versioning resource through the reference to <code>aws_s3_bucket_versioning.example.bucket</code> to define <code>bucket</code>:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yotto"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_versioning"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_object"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket_versioning.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">key</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"droeloe"</span><span class="w"></span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"example.txt"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/website%2C%20website_domain%2C%20and%20website_endpoint%20Arguments"></a><h3 id="website-website_domain-and-website_endpoint-arguments"><code>website</code>, <code>website_domain</code>, and <code>website_endpoint</code> Arguments</h3>

<p>Switch your Terraform configuration to the <a href="../resources/s3_bucket_website_configuration.html"><code>aws_s3_bucket_website_configuration</code> resource</a> instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">website</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">index_document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"index.html"</span><span class="w"></span>
<span class="w">    </span><span class="na">error_document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"error.html"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You will get the following error after upgrading:</p>

<pre><code> Error: Value for unconfigurable attribute

   with aws_s3_bucket.example,
   on main.tf line 1, in resource "aws_s3_bucket" "example":
    1: resource "aws_s3_bucket" "example" {

 Can't configure a value for "website": its value will be decided automatically based on the result of applying this configuration.
</code></pre>

<p>Since <code>website</code> is now read only, update your configuration to use the <code>aws_s3_bucket_website_configuration</code>
resource and remove <code>website</code> and its nested arguments in the <code>aws_s3_bucket</code> resource:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yournamehere"</span><span class="c1"></span>

<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_website_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.example.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">index_document</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"index.html"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">error_document</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"error.html"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Run <code>terraform import</code> on each new resource, _e.g._,</p>

<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>terraform import aws_s3_bucket_website_configuration.example yournamehere
<span class="go">aws_s3_bucket_website_configuration.example: Importing from ID "yournamehere"...</span>
<span class="go">aws_s3_bucket_website_configuration.example: Import prepared!</span>
<span class="go">  Prepared aws_s3_bucket_website_configuration for import</span>
<span class="go">aws_s3_bucket_website_configuration.example: Refreshing state... [id=yournamehere]</span>

<span class="go">Import successful!</span>

<span class="go">The resources that were imported are shown above. These resources are now in</span>
<span class="go">your Terraform state and will henceforth be managed by Terraform.</span>
</code></pre></div>

<p>For example, if you use the <code>aws_s3_bucket</code> attribute <code>website_domain</code> with <code>aws_route53_record</code>, as shown below, you will need to update your configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route53_zone"</span><span class="w"> </span><span class="nv">"main"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"domain.test"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"website"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="nb">website</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">index_document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"index.html"</span><span class="w"></span>
<span class="w">    </span><span class="na">error_document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"error.html"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route53_record"</span><span class="w"> </span><span class="nv">"alias"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_route53_zone.main.zone_id</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"www"</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"A"</span><span class="w"></span>

<span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">zone_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.hosted_zone_id</span><span class="w"></span>
<span class="w">    </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.website_domain</span><span class="w"></span>
<span class="w">    </span><span class="na">evaluate_target_health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Instead, you will now use the <code>aws_s3_bucket_website_configuration</code> resource and its <code>website_domain</code> attribute:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route53_zone"</span><span class="w"> </span><span class="nv">"main"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"domain.test"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"website"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ... other configuration ...</span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_website_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">index_document</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"index.html"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route53_record"</span><span class="w"> </span><span class="nv">"alias"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_route53_zone.main.zone_id</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"www"</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"A"</span><span class="w"></span>

<span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">zone_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.hosted_zone_id</span><span class="w"></span>
<span class="w">    </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket_website_configuration.example.website_domain</span><span class="w"></span>
<span class="w">    </span><span class="na">evaluate_target_health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Full%20Resource%20Lifecycle%20of%20Default%20Resources"></a><h2 id="full-resource-lifecycle-of-default-resources">Full Resource Lifecycle of Default Resources</h2>

<p>Default subnets and vpcs can now do full resource lifecycle operations such that resource
creation and deletion are now supported.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_default_subnet"></a><h3 id="resource-aws_default_subnet">Resource: aws_default_subnet</h3>

<p>The <code>aws_default_subnet</code> resource behaves differently from normal resources in that if a default subnet exists in the specified Availability Zone, Terraform does not _create_ this resource, but instead "adopts" it into management.
If no default subnet exists, Terraform creates a new default subnet.
By default, <code>terraform destroy</code> does not delete the default subnet but does remove the resource from Terraform state.
Set the <code>force_destroy</code> argument to <code>true</code> to delete the default subnet.</p>

<p>For example, given this previous configuration with no existing default subnet:</p>

<div class="codehilite"><pre><span></span><code><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">required_providers</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hashicorp/aws"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="na">required_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&gt;= 0.13"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">provider</span><span class="w"> </span><span class="nv">"aws"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"eu-west-2"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_default_subnet"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>

<p>The following error was thrown on <code>terraform apply</code>:</p>

<pre><code> Error: Default subnet not found.

   with aws_default_subnet.default,
   on main.tf line 5, in resource "aws_default_subnet" "default":
    5: resource "aws_default_subnet" "default" {}
</code></pre>

<p>Now after upgrading, the above configuration will apply successfully.</p>

<p>To delete the default subnet, the above configuration should be updated as follows:</p>

<div class="codehilite"><pre><span></span><code><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">required_providers</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hashicorp/aws"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="na">required_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&gt;= 0.13"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_default_subnet"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">force_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_default_vpc"></a><h3 id="resource-aws_default_vpc">Resource: aws_default_vpc</h3>

<p>The <code>aws_default_vpc</code> resource behaves differently from normal resources in that if a default VPC exists, Terraform does not _create_ this resource, but instead "adopts" it into management.
If no default VPC exists, Terraform creates a new default VPC, which leads to the implicit creation of <a href="https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html#default-vpc-components">other resources</a>.
By default, <code>terraform destroy</code> does not delete the default VPC but does remove the resource from Terraform state.
Set the <code>force_destroy</code> argument to <code>true</code> to delete the default VPC.</p>

<p>For example, given this previous configuration with no existing default VPC:</p>

<div class="codehilite"><pre><span></span><code><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">required_providers</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hashicorp/aws"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="na">required_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&gt;= 0.13"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_default_vpc"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
</code></pre></div>

<p>The following error was thrown on <code>terraform apply</code>:</p>

<pre><code> Error: No default VPC found in this region.

   with aws_default_vpc.default,
   on main.tf line 5, in resource "aws_default_vpc" "default":
    5: resource "aws_default_vpc" "default" {}
</code></pre>

<p>Now after upgrading, the above configuration will apply successfully.</p>

<p>To delete the default VPC, the above configuration should be updated to:</p>

<div class="codehilite"><pre><span></span><code><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">required_providers</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hashicorp/aws"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="na">required_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&gt;= 0.13"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_default_vpc"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">force_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Plural%20Data%20Source%20Behavior"></a><h2 id="plural-data-source-behavior">Plural Data Source Behavior</h2>

<p>The following plural data sources are now consistent with <a href="https://hashicorp.github.io/terraform-provider-aws/provider-design/#plural-data-sources">Provider Design</a>
such that they no longer return an error if zero results are found.</p>

<ul>
<li><a href="../data-sources/cognito_user_pools.html">aws_cognito_user_pools</a></li>
<li><a href="../data-sources/db_event_categories.html">aws_db_event_categories</a></li>
<li><a href="../data-sources/ebs_volumes.html">aws_ebs_volumes</a></li>
<li><a href="../data-sources/ec2_coip_pools.html">aws_ec2_coip_pools</a></li>
<li><a href="../data-sources/ec2_local_gateway_route_tables.html">aws_ec2_local_gateway_route_tables</a></li>
<li><a href="../data-sources/ec2_local_gateway_virtual_interface_groups.html">aws_ec2_local_gateway_virtual_interface_groups</a></li>
<li><a href="../data-sources/ec2_local_gateways.html">aws_ec2_local_gateways</a></li>
<li><a href="../data-sources/ec2_transit_gateway_route_tables.html">aws_ec2_transit_gateway_route_tables</a></li>
<li><a href="../data-sources/efs_access_points.html">aws_efs_access_points</a></li>
<li><a href="../data-sources/emr_release_labels.html">aws_emr_release_labels</a></li>
<li><a href="../data-sources/inspector_rules_packages.html">aws_inspector_rules_packages</a></li>
<li><a href="../data-sources/ip_ranges.html">aws_ip_ranges</a></li>
<li><a href="../data-sources/network_acls.html">aws_network_acls</a></li>
<li><a href="../data-sources/route_tables.html">aws_route_tables</a></li>
<li><a href="../data-sources/security_groups.html">aws_security_groups</a></li>
<li><a href="../data-sources/ssoadmin_instances.html">aws_ssoadmin_instances</a></li>
<li><a href="../data-sources/vpcs.html">aws_vpcs</a></li>
<li><a href="../data-sources/vpc_peering_connections.html">aws_vpc_peering_connections</a></li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Empty%20Strings%20Not%20Valid%20For%20Certain%20Resources"></a><h2 id="empty-strings-not-valid-for-certain-resources">Empty Strings Not Valid For Certain Resources</h2>

<p>First, this is a breaking change but should affect very few configurations.</p>

<p>Second, the motivation behind this change is that previously, you might set an argument to <code>""</code> to explicitly convey it is empty. However, with the introduction of <code>null</code> in Terraform 0.12 and to prepare for continuing enhancements that distinguish between unset arguments and those that have a value, including an empty string (<code>""</code>), we are moving away from this use of zero values. We ask practitioners to either use <code>null</code> instead or remove the arguments that are set to <code>""</code>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_cloudwatch_event_target%20%28Empty%20String%29"></a><h3 id="resource-aws_cloudwatch_event_target-empty-string">Resource: aws_cloudwatch_event_target (Empty String)</h3>

<p>Previously, you could set <code>ecs_target.0.launch_type</code> to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>launch_type = null</code>) or remove the empty-string configuration.</p>

<p>For example, this type of configuration is now not valid:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_cloudwatch_event_target"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">ecs_target</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">task_count</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="na">task_definition_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_ecs_task_definition.task.arn</span><span class="w"></span>
<span class="w">    </span><span class="na">launch_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="c1"></span>
<span class="c1">    # ...</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>We fix this configuration by setting <code>launch_type</code> to <code>null</code>:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_cloudwatch_event_target"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">ecs_target</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">task_count</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="na">task_definition_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_ecs_task_definition.task.arn</span><span class="w"></span>
<span class="w">    </span><span class="na">launch_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="kt">null</span><span class="c1"></span>
<span class="c1">    # ...</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_customer_gateway"></a><h3 id="resource-aws_customer_gateway">Resource: aws_customer_gateway</h3>

<p>Previously, you could set <code>ip_address</code> to <code>""</code>, which would result in an AWS error. However, the provider now also gives an error.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_default_network_acl"></a><h3 id="resource-aws_default_network_acl">Resource: aws_default_network_acl</h3>

<p>Previously, you could set <code>egress.*.cidr_block</code>, <code>egress.*.ipv6_cidr_block</code>, <code>ingress.*.cidr_block</code>, or <code>ingress.*.ipv6_cidr_block</code> to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>ipv6_cidr_block = null</code>) or remove the empty-string configuration.</p>

<p>For example, this type of configuration is now not valid:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_default_network_acl"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">egress</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">cidr_block</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"0.0.0.0/0"</span><span class="w"></span>
<span class="w">    </span><span class="na">ipv6_cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="c1"></span>
<span class="c1">    # ...</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>To fix this configuration, we remove the empty-string configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_default_network_acl"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">egress</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0.0.0.0/0"</span><span class="c1"></span>
<span class="c1">    # ...</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_default_route_table"></a><h3 id="resource-aws_default_route_table">Resource: aws_default_route_table</h3>

<p>Previously, you could set <code>route.*.cidr_block</code> or <code>route.*.ipv6_cidr_block</code> to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>ipv6_cidr_block = null</code>) or remove the empty-string configuration.</p>

<p>For example, this type of configuration is now not valid:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_default_route_table"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">route</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">cidr_block</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">local.destination</span><span class="w"></span>
<span class="w">    </span><span class="na">ipv6_cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">local.destination_ipv6</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>We fix this configuration by using <code>null</code> instead of an empty string (<code>""</code>):</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_default_route_table"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">route</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">cidr_block</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="kt">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">local.destination</span><span class="w"></span>
<span class="w">    </span><span class="na">ipv6_cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">local.destination_ipv6</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kt">null</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_default_vpc%20%28Empty%20String%29"></a><h3 id="resource-aws_default_vpc-empty-string">Resource: aws_default_vpc (Empty String)</h3>

<p>Previously, you could set <code>ipv6_cidr_block</code> to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>ipv6_cidr_block = null</code>) or remove the empty-string configuration.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_instance"></a><h3 id="resource-aws_instance">Resource: aws_instance</h3>

<p>Previously, you could set <code>private_ip</code> to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>private_ip = null</code>) or remove the empty-string configuration.</p>

<p>For example, this type of configuration is now not valid:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_instance"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"t2.micro"</span><span class="w"></span>
<span class="w">  </span><span class="na">private_ip</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>We fix this configuration by removing the empty-string configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_instance"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"t2.micro"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_efs_mount_target"></a><h3 id="resource-aws_efs_mount_target">Resource: aws_efs_mount_target</h3>

<p>Previously, you could set <code>ip_address</code> to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>ip_address = null</code>) or remove the empty-string configuration.</p>

<p>For example, this type of configuration is now not valid: <code>ip_address = ""</code>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_elasticsearch_domain"></a><h3 id="resource-aws_elasticsearch_domain">Resource: aws_elasticsearch_domain</h3>

<p>Previously, you could set <code>ebs_options.0.volume_type</code> to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>volume_type = null</code>) or remove the empty-string configuration.</p>

<p>For example, this type of configuration is now not valid:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_elasticsearch_domain"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">ebs_options</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">ebs_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">volume_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.volume_size</span><span class="w"></span>
<span class="w">    </span><span class="na">volume_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.volume_size</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">local.volume_type</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>We fix this configuration by using <code>null</code> instead of <code>""</code>:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_elasticsearch_domain"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">ebs_options</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">ebs_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">volume_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.volume_size</span><span class="w"></span>
<span class="w">    </span><span class="na">volume_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.volume_size</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">local.volume_type</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kt">null</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_network_acl"></a><h3 id="resource-aws_network_acl">Resource: aws_network_acl</h3>

<p>Previously, <code>egress.*.cidr_block</code>, <code>egress.*.ipv6_cidr_block</code>, <code>ingress.*.cidr_block</code>, and <code>ingress.*.ipv6_cidr_block</code> could be set to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>ipv6_cidr_block = null</code>) or remove the empty-string configuration.</p>

<p>For example, this type of configuration is now not valid:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_network_acl"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">egress</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">cidr_block</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"0.0.0.0/0"</span><span class="w"></span>
<span class="w">    </span><span class="na">ipv6_cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="c1"></span>
<span class="c1">    # ...</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>We fix this configuration by removing the empty-string configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_network_acl"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">egress</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0.0.0.0/0"</span><span class="c1"></span>
<span class="c1">    # ...</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_route"></a><h3 id="resource-aws_route">Resource: aws_route</h3>

<p>Previously, <code>destination_cidr_block</code> and <code>destination_ipv6_cidr_block</code> could be set to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>destination_ipv6_cidr_block = null</code>) or remove the empty-string configuration.</p>

<p>In addition, now exactly one of <code>destination_cidr_block</code>, <code>destination_ipv6_cidr_block</code>, and <code>destination_prefix_list_id</code> can be set.</p>

<p>For example, this type of configuration for <code>aws_route</code> is now not valid:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">route_table_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_route_table.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">gateway_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_internet_gateway.example.id</span><span class="w"></span>

<span class="w">  </span><span class="na">destination_cidr_block</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">local.destination</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_ipv6_cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">local.destination_ipv6</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>We fix this configuration by using <code>null</code> instead of an empty-string (<code>""</code>):</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">route_table_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_route_table.example.id</span><span class="w"></span>
<span class="w">  </span><span class="na">gateway_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_internet_gateway.example.id</span><span class="w"></span>

<span class="w">  </span><span class="na">destination_cidr_block</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="kt">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">local.destination</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_ipv6_cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">local.destination_ipv6</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kt">null</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_route_table"></a><h3 id="resource-aws_route_table">Resource: aws_route_table</h3>

<p>Previously, <code>route.*.cidr_block</code> and <code>route.*.ipv6_cidr_block</code> could be set to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>ipv6_cidr_block = null</code>) or remove the empty-string configuration.</p>

<p>For example, this type of configuration is now not valid:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route_table"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">route</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">cidr_block</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">local.destination</span><span class="w"></span>
<span class="w">    </span><span class="na">ipv6_cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">local.destination_ipv6</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>We fix this configuration by usingd <code>null</code> instead of an empty-string (<code>""</code>):</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_route_table"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ...</span>
<span class="w">  </span><span class="nb">route</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">cidr_block</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="kt">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">local.destination</span><span class="w"></span>
<span class="w">    </span><span class="na">ipv6_cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.ipv6</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">local.destination_ipv6</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kt">null</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_vpc"></a><h3 id="resource-aws_vpc">Resource: aws_vpc</h3>

<p>Previously, <code>ipv6_cidr_block</code> could be set to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>ipv6_cidr_block = null</code>) or remove the empty-string configuration.</p>

<p>For example, this type of configuration is now not valid:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_vpc"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"10.1.0.0/16"</span><span class="w"></span>
<span class="w">  </span><span class="na">ipv6_cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>We fix this configuration by removing <code>ipv6_cidr_block</code>:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_vpc"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"10.1.0.0/16"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_vpc_ipv6_cidr_block_association"></a><h3 id="resource-aws_vpc_ipv6_cidr_block_association">Resource: aws_vpc_ipv6_cidr_block_association</h3>

<p>Previously, <code>ipv6_cidr_block</code> could be set to <code>""</code>. However, the value <code>""</code> is no longer valid. Now, set the argument to <code>null</code> (_e.g._, <code>ipv6_cidr_block = null</code>) or remove the empty-string configuration.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Data%20Source%3A%20aws_cloudwatch_log_group"></a><h2 id="data-source-aws_cloudwatch_log_group">Data Source: aws_cloudwatch_log_group</h2>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Removal%20of%20arn%20Wildcard%20Suffix"></a><h3 id="removal-of-arn-wildcard-suffix">Removal of arn Wildcard Suffix</h3>

<p>Previously, the data source returned the ARN directly from the API, which included a <code>:*</code> suffix to denote all CloudWatch Log Streams under the CloudWatch Log Group. Most other AWS resources that return ARNs and many other AWS services do not use the <code>:*</code> suffix. The suffix is now automatically removed. For example, the data source previously returned an ARN such as <code>arn:aws:logs:us-east-1:123456789012:log-group:/example:*</code> but will now return <code>arn:aws:logs:us-east-1:123456789012:log-group:/example</code>.</p>

<p>Workarounds, such as using <code>replace()</code> as shown below, should be removed:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"aws_cloudwatch_log_group"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"example"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_datasync_task"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # ... other configuration ...</span>
<span class="w">  </span><span class="na">cloudwatch_log_group_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="nv">data.aws_cloudwatch_log_group.example.arn</span><span class="p">,</span><span class="w"> </span><span class="s2">":*", ""</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Removing the <code>:*</code> suffix is a breaking change for some configurations. Fix these configurations using string interpolations as demonstrated below. For example, this configuration is now broken:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"aws_iam_policy_document"</span><span class="w"> </span><span class="nv">"ad-log-policy"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">statement</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">actions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="s2">"logs:CreateLogStream"</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s2">"logs:PutLogEvents"</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="nb">principals</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">identifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"ds.amazonaws.com"</span><span class="p">]</span><span class="w"></span>
<span class="w">      </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"Service"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="na">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">data.aws_cloudwatch_log_group.example.arn</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">effect</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"Allow"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>An updated configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"aws_iam_policy_document"</span><span class="w"> </span><span class="nv">"ad-log-policy"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">statement</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">actions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="s2">"logs:CreateLogStream"</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s2">"logs:PutLogEvents"</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="nb">principals</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">identifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"ds.amazonaws.com"</span><span class="p">]</span><span class="w"></span>
<span class="w">      </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"Service"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="na">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"${data.aws_cloudwatch_log_group.example.arn}:*"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">effect</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"Allow"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Data%20Source%3A%20aws_subnet_ids"></a><h2 id="data-source-aws_subnet_ids">Data Source: aws_subnet_ids</h2>

<p>The <code>aws_subnet_ids</code> data source has been deprecated and will be removed in a future version. Use the <code>aws_subnets</code> data source instead.</p>

<p>For example, change a configuration such as</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"aws_subnet_ids"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"aws_subnet"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">for_each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_subnet_ids.example.ids</span><span class="w"></span>
<span class="w">  </span><span class="na">id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">each.value</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">output</span><span class="w"> </span><span class="nv">"subnet_cidr_blocks"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="err">for</span><span class="w"> </span><span class="err">s</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">data.aws_subnet.example</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">s.cidr_block</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>to</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"aws_subnets"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"vpc-id"</span><span class="w"></span>
<span class="w">    </span><span class="na">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">var.vpc_id</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"aws_subnet"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">for_each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_subnets.example.ids</span><span class="w"></span>
<span class="w">  </span><span class="na">id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">each.value</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">output</span><span class="w"> </span><span class="nv">"subnet_cidr_blocks"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="err">for</span><span class="w"> </span><span class="err">s</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">data.aws_subnet.example</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">s.cidr_block</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Data%20Source%3A%20aws_s3_bucket_object"></a><h2 id="data-source-aws_s3_bucket_object">Data Source: aws_s3_bucket_object</h2>

<p>Version 4.x deprecates the <code>aws_s3_bucket_object</code> data source. Maintainers will remove it in a future version. Use <code>aws_s3_object</code> instead, where new features and fixes will be added.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Data%20Source%3A%20aws_s3_bucket_objects"></a><h2 id="data-source-aws_s3_bucket_objects">Data Source: aws_s3_bucket_objects</h2>

<p>Version 4.x deprecates the <code>aws_s3_bucket_objects</code> data source. Maintainers will remove it in a future version. Use <code>aws_s3_objects</code> instead, where new features and fixes will be added.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_batch_compute_environment"></a><h2 id="resource-aws_batch_compute_environment">Resource: aws_batch_compute_environment</h2>

<p>You can no longer specify <code>compute_resources</code> when <code>type</code> is <code>UNMANAGED</code>.</p>

<p>Previously, you could apply this configuration and the provider would ignore any compute resources:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_batch_compute_environment"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">compute_environment_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"test"</span><span class="w"></span>

<span class="w">  </span><span class="nb">compute_resources</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_instance_profile.ecs_instance.arn</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="s2">"c4.large"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">max_vcpus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="w"></span>
<span class="w">    </span><span class="na">min_vcpus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="na">security_group_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="nv">aws_security_group.test.id</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">subnets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="nv">aws_subnet.test.id</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"EC2"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="na">service_role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.batch_service.arn</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"UNMANAGED"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Now, this configuration is invalid and will result in an error during plan.</p>

<p>To resolve this error, simply remove or comment out the <code>compute_resources</code> configuration block.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_batch_compute_environment"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">compute_environment_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"test"</span><span class="w"></span>

<span class="w">  </span><span class="na">service_role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.batch_service.arn</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"UNMANAGED"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_cloudwatch_event_target"></a><h2 id="resource-aws_cloudwatch_event_target">Resource: aws_cloudwatch_event_target</h2>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Removal%20of%20ecs_target%20launch_type%20default%20value"></a><h3 id="removal-of-ecs_target-launch_type-default-value">Removal of <code>ecs_target</code> <code>launch_type</code> default value</h3>

<p>Previously, the provider assigned <code>ecs_target</code> <code>launch_type</code> the default value of <code>EC2</code> if you did not configure a value. However, the provider no longer assigns a default value.</p>

<p>For example, previously you could workaround the default value by using an empty string (<code>""</code>), as shown:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_cloudwatch_event_target"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">arn</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_ecs_cluster.test.id</span><span class="w"></span>
<span class="w">  </span><span class="na">rule</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudwatch_event_rule.test.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.test.arn</span><span class="w"></span>
<span class="w">  </span><span class="nb">ecs_target</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">launch_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"></span>
<span class="w">    </span><span class="na">task_count</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="na">task_definition_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_ecs_task_definition.task.arn</span><span class="w"></span>
<span class="w">    </span><span class="nb">network_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">subnets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_subnet.subnet.id</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>This is no longer necessary. We fix the configuration by removing the empty string assignment:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_cloudwatch_event_target"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">arn</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_ecs_cluster.test.id</span><span class="w"></span>
<span class="w">  </span><span class="na">rule</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudwatch_event_rule.test.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.test.arn</span><span class="w"></span>
<span class="w">  </span><span class="nb">ecs_target</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">task_count</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="na">task_definition_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_ecs_task_definition.task.arn</span><span class="w"></span>
<span class="w">    </span><span class="nb">network_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">subnets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_subnet.subnet.id</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_elasticache_cluster"></a><h2 id="resource-aws_elasticache_cluster">Resource: aws_elasticache_cluster</h2>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Error%20raised%20if%20neither%20engine%20nor%20replication_group_id%20is%20specified"></a><h3 id="error-raised-if-neither-engine-nor-replication_group_id-is-specified">Error raised if neither <code>engine</code> nor <code>replication_group_id</code> is specified</h3>

<p>Previously, when you did not specify either <code>engine</code> or <code>replication_group_id</code>, Terraform would not prevent you from applying the invalid configuration.
Now, this will produce an error similar to the one below:</p>

<pre><code>Error: Invalid combination of arguments

          with aws_elasticache_cluster.example,
          on terraform_plugin_test.tf line 2, in resource "aws_elasticache_cluster" "example":
           2: resource "aws_elasticache_cluster" "example" {

        "replication_group_id": one of `engine,replication_group_id` must be
        specified

        Error: Invalid combination of arguments

          with aws_elasticache_cluster.example,
          on terraform_plugin_test.tf line 2, in resource "aws_elasticache_cluster" "example":
           2: resource "aws_elasticache_cluster" "example" {

        "engine": one of `engine,replication_group_id` must be specified
</code></pre>

<p>Update your configuration to supply one of <code>engine</code> or <code>replication_group_id</code>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_elasticache_global_replication_group"></a><h2 id="resource-aws_elasticache_global_replication_group">Resource: aws_elasticache_global_replication_group</h2>

<a class="dashAnchor" name="//apple_ref/cpp/Section/actual_engine_version%20Attribute%20removal"></a><h3 id="actual_engine_version-attribute-removal">actual_engine_version Attribute removal</h3>

<p>Switch your Terraform configuration from using <code>actual_engine_version</code> to use the <code>engine_version_actual</code> attribute instead.</p>

<p>For example, given this previous configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">output</span><span class="w"> </span><span class="nv">"elasticache_global_replication_group_version_result"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_elasticache_global_replication_group.example.actual_engine_version</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>An updated configuration:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">output</span><span class="w"> </span><span class="nv">"elasticache_global_replication_group_version_result"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_elasticache_global_replication_group.example.engine_version_actual</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_fsx_ontap_storage_virtual_machine"></a><h2 id="resource-aws_fsx_ontap_storage_virtual_machine">Resource: aws_fsx_ontap_storage_virtual_machine</h2>

<p>We removed the misspelled argument <code>active_directory_configuration.0.self_managed_active_directory_configuration.0.organizational_unit_distinguidshed_name</code> that we previously deprecated. Use <code>active_directory_configuration.0.self_managed_active_directory_configuration.0.organizational_unit_distinguished_name</code> now instead. Terraform will automatically migrate the state to <code>active_directory_configuration.0.self_managed_active_directory_configuration.0.organizational_unit_distinguished_name</code> during planning.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_lb_target_group"></a><h2 id="resource-aws_lb_target_group">Resource: aws_lb_target_group</h2>

<p>For <code>protocol = "TCP"</code>, you can no longer set <code>stickiness.type</code> to <code>lb_cookie</code> even when <code>enabled = false</code>. Instead, either change the <code>protocol</code> to <code>"HTTP"</code> or <code>"HTTPS"</code>, or change <code>stickiness.type</code> to <code>"source_ip"</code>.</p>

<p>For example, this configuration is no longer valid:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_lb_target_group"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="w"></span>
<span class="w">  </span><span class="na">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"TCP"</span><span class="w"></span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_vpc.test.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">stickiness</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"lb_cookie"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>To fix this, we change the <code>stickiness.type</code> to <code>"source_ip"</code>.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_lb_target_group"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="w"></span>
<span class="w">  </span><span class="na">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"TCP"</span><span class="w"></span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_vpc.test.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">stickiness</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"source_ip"</span><span class="w"></span>
<span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource%3A%20aws_s3_bucket_object"></a><h2 id="resource-aws_s3_bucket_object">Resource: aws_s3_bucket_object</h2>

<p>Version 4.x deprecates the <code>aws_s3_bucket_object</code> and maintainers will remove it in a future version. Use <code>aws_s3_object</code> instead, where new features and fixes will be added.</p>

<p>When replacing <code>aws_s3_bucket_object</code> with <code>aws_s3_object</code> in your configuration, on the next apply, Terraform will recreate the object. If you prefer to not have Terraform recreate the object, import the object using <code>aws_s3_object</code>.</p>

<p>For example, the following will import an S3 object into state, assuming the configuration exists, as <code>aws_s3_object.example</code>:</p>

<div class="codehilite"><pre><span></span><code><span class="gp">% </span>terraform import aws_s3_object.example s3://some-bucket-name/some/key.txt
</code></pre></div>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>CAUTION</em>
    <p>We do not recommend modifying the state file manually. If you do, you can make it unusable. However, if you accept that risk, some community members have upgraded to the new resource by searching and replacing <code>"type": "aws_s3_bucket_object",</code> with <code>"type": "aws_s3_object",</code> in the state file, and then running <code>terraform apply -refresh-only</code>.</p>
</aside>

<a class="dashAnchor" name="//apple_ref/cpp/Section/EC2-Classic%20Resource%20and%20Data%20Source%20Support"></a><h2 id="ec2-classic-resource-and-data-source-support">EC2-Classic Resource and Data Source Support</h2>

<p>While an upgrade to this major version will not directly impact EC2-Classic resources configured with Terraform,
it is important to keep in the mind the following AWS Provider resources will eventually no longer
be compatible with EC2-Classic as AWS completes their EC2-Classic networking retirement (expected around August 15, 2022).</p>

<ul>
<li>Running or stopped <a href="../resources/instance.html">EC2 instances</a></li>
<li>Running or stopped <a href="../resources/db_instance.html">RDS database instances</a></li>
<li><a href="../resources/eip.html">Elastic IP addresses</a></li>
<li><a href="../resources/lb.html">Classic Load Balancers</a></li>
<li><a href="../resources/redshift_cluster.html">Redshift clusters</a></li>
<li><a href="../resources/elastic_beanstalk_environment.html">Elastic Beanstalk environments</a></li>
<li><a href="../resources/emr_cluster.html">EMR clusters</a></li>
<li><a href="../resources/datapipeline_pipeline.html">AWS Data Pipelines pipelines</a></li>
<li><a href="../resources/elasticache_cluster.html">ElastiCache clusters</a></li>
<li><a href="../resources/spot_instance_request.html">Spot Requests</a></li>
<li><a href="../resources/ec2_capacity_reservation.html">Capacity Reservations</a></li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Macie%20Classic%20Resource%20Support"></a><h2 id="macie-classic-resource-support">Macie Classic Resource Support</h2>

<p>These resources should be considered deprecated and will be removed in version 5.0.0.</p>

<ul>
<li>Macie Member Account Association</li>
<li>Macie S3 Bucket Association</li>
</ul>

            
        
    </body></html>