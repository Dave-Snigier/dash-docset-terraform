<html><!-- Online page at https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_lifecycle_configuration --><head>
                <title>aws_s3_bucket_lifecycle_configuration</title>
                <meta charset="utf-8"/>
                <link href="../../../../../../style.css" rel="stylesheet"/>
            </head>
            <body>
                <h1 id="resource-aws_s3_bucket_lifecycle_configuration">Resource: aws_s3_bucket_lifecycle_configuration</h1>

<p>Provides an independent configuration resource for S3 bucket <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html">lifecycle configuration</a>.</p>

<p>An S3 Lifecycle configuration consists of one or more Lifecycle rules. Each rule consists of the following:</p>

<ul>
<li>Rule metadata (<code>id</code> and <code>status</code>)</li>
<li><a href="#filter">Filter</a> identifying objects to which the rule applies</li>
<li>One or more transition or expiration actions</li>
</ul>

<p>For more information see the Amazon S3 User Guide on <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/intro-lifecycle-rules.html"><code>Lifecycle Configuration Elements</code></a>.</p>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>S3 Buckets only support a single lifecycle configuration. Declaring multiple <code>aws_s3_bucket_lifecycle_configuration</code> resources to the same S3 Bucket will cause a perpetual difference in configuration.</p>
</aside>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>Lifecycle configurations may take some time to fully propagate to all AWS S3 systems. Running Terraform operations shortly after creating a lifecycle configuration may result in changes that affect configuration idempotence. See the Amazon S3 User Guide on <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/how-to-set-lifecycle-configuration-intro.html">setting lifecycle configuration on a bucket</a>.</p>
</aside>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Example%20Usage"></a><h2 id="example-usage">Example Usage</h2>

<a class="dashAnchor" name="//apple_ref/cpp/Section/With%20neither%20a%20filter%20nor%20prefix%20specified"></a><h3 id="with-neither-a-filter-nor-prefix-specified">With neither a filter nor prefix specified</h3>

<p>The Lifecycle rule applies to a subset of objects based on the key name prefix (<code>""</code>).</p>

<p>This configuration is intended to replicate the default behavior of the <code>lifecycle_rule</code>
parameter in the Terraform AWS Provider <code>aws_s3_bucket</code> resource prior to <code>v4.0</code>.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rule-1"</span><span class="c1"></span>

<span class="c1">    # ... other transition/expiration actions ...</span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specifying%20an%20empty%20filter"></a><h3 id="specifying-an-empty-filter">Specifying an empty filter</h3>

<p>The Lifecycle rule applies to all objects in the bucket.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rule-1"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{}</span><span class="c1"></span>

<span class="c1">    # ... other transition/expiration actions ...</span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specifying%20a%20filter%20using%20key%20prefixes"></a><h3 id="specifying-a-filter-using-key-prefixes">Specifying a filter using key prefixes</h3>

<p>The Lifecycle rule applies to a subset of objects based on the key name prefix (<code>logs/</code>).</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rule-1"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"logs/"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="c1"></span>

<span class="c1">    # ... other transition/expiration actions ...</span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>If you want to apply a Lifecycle action to a subset of objects based on different key name prefixes, specify separate rules.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rule-1"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"logs/"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="c1"></span>

<span class="c1">    # ... other transition/expiration actions ...</span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rule-2"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp/"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="c1"></span>

<span class="c1">    # ... other transition/expiration actions ...</span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specifying%20a%20filter%20based%20on%20an%20object%20tag"></a><h3 id="specifying-a-filter-based-on-an-object-tag">Specifying a filter based on an object tag</h3>

<p>The Lifecycle rule specifies a filter based on a tag key and value. The rule then applies only to a subset of objects with the specific tag.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rule-1"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">tag</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">key</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"Name"</span><span class="w"></span>
<span class="w">        </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Staging"</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="c1"></span>

<span class="c1">    # ... other transition/expiration actions ...</span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specifying%20a%20filter%20based%20on%20multiple%20tags"></a><h3 id="specifying-a-filter-based-on-multiple-tags">Specifying a filter based on multiple tags</h3>

<p>The Lifecycle rule directs Amazon S3 to perform lifecycle actions on objects with two tags (with the specific tag keys and values). Notice <code>tags</code> is wrapped in the <code>and</code> configuration block.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rule-1"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">and</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">Key1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Value1"</span><span class="w"></span>
<span class="w">          </span><span class="na">Key2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Value2"</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="c1"></span>

<span class="c1">    # ... other transition/expiration actions ...</span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specifying%20a%20filter%20based%20on%20both%20prefix%20and%20one%20or%20more%20tags"></a><h3 id="specifying-a-filter-based-on-both-prefix-and-one-or-more-tags">Specifying a filter based on both prefix and one or more tags</h3>

<p>The Lifecycle rule directs Amazon S3 to perform lifecycle actions on objects with the specified prefix and two tags (with the specific tag keys and values). Notice both <code>prefix</code> and <code>tags</code> are wrapped in the <code>and</code> configuration block.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rule-1"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">and</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"logs/"</span><span class="w"></span>
<span class="w">        </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">Key1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Value1"</span><span class="w"></span>
<span class="w">          </span><span class="na">Key2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Value2"</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="c1"></span>

<span class="c1">    # ... other transition/expiration actions ...</span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specifying%20a%20filter%20based%20on%20object%20size"></a><h3 id="specifying-a-filter-based-on-object-size">Specifying a filter based on object size</h3>

<p>Object size values are in bytes. Maximum filter size is 5TB. Amazon S3 applies a default behavior to your Lifecycle configuration that prevents objects smaller than 128 KB from being transitioned to any storage class. You can allow smaller objects to transition by adding a minimum size (<code>object_size_greater_than</code>) or a maximum size (<code>object_size_less_than</code>) filter that specifies a smaller size to the configuration. This example allows any object smaller than 128 KB to transition to the S3 Glacier Instant Retrieval storage class:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Allow small object transitions"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">object_size_greater_than</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">365</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER_IR"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specifying%20a%20filter%20based%20on%20object%20size%20range%20and%20prefix"></a><h3 id="specifying-a-filter-based-on-object-size-range-and-prefix">Specifying a filter based on object size range and prefix</h3>

<p>The <code>object_size_greater_than</code> must be less than the <code>object_size_less_than</code>. Notice both the object size range and prefix are wrapped in the <code>and</code> configuration block.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rule-1"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">and</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">prefix</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="s2">"logs/"</span><span class="w"></span>
<span class="w">        </span><span class="na">object_size_greater_than</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="w"></span>
<span class="w">        </span><span class="na">object_size_less_than</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="m">64000</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="c1"></span>

<span class="c1">    # ... other transition/expiration actions ...</span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Creating%20a%20Lifecycle%20Configuration%20for%20a%20bucket%20with%20versioning"></a><h3 id="creating-a-lifecycle-configuration-for-a-bucket-with-versioning">Creating a Lifecycle Configuration for a bucket with versioning</h3>

<div class="codehilite"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"bucket"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"my-bucket"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_acl"</span><span class="w"> </span><span class="nv">"bucket_acl"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket.id</span><span class="w"></span>
<span class="w">  </span><span class="na">acl</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"private"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"bucket-config"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"log"</span><span class="w"></span>

<span class="w">    </span><span class="nb">expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nb">and</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"log/"</span><span class="w"></span>

<span class="w">        </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="na">rule</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"log"</span><span class="w"></span>
<span class="w">          </span><span class="na">autoclean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"true"</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">days</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">60</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tmp/"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2023-01-13T00:00:00Z"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket"</span><span class="w"> </span><span class="nv">"versioning_bucket"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"my-versioning-bucket"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_acl"</span><span class="w"> </span><span class="nv">"versioning_bucket_acl"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.versioning_bucket.id</span><span class="w"></span>
<span class="w">  </span><span class="na">acl</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"private"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_versioning"</span><span class="w"> </span><span class="nv">"versioning"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.versioning_bucket.id</span><span class="w"></span>
<span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"aws_s3_bucket_lifecycle_configuration"</span><span class="w"> </span><span class="nv">"versioning-bucket-config"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  # Must have bucket versioning enabled first</span>
<span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_s3_bucket_versioning.versioning</span><span class="p">]</span><span class="w"></span>

<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.versioning_bucket.id</span><span class="w"></span>

<span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"config"</span><span class="w"></span>

<span class="w">    </span><span class="nb">filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"config/"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">noncurrent_version_expiration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">noncurrent_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">noncurrent_version_transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">noncurrent_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"STANDARD_IA"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nb">noncurrent_version_transition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">noncurrent_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">60</span><span class="w"></span>
<span class="w">      </span><span class="na">storage_class</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"GLACIER"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enabled"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Argument%20Reference"></a><h2 id="argument-reference">Argument Reference</h2>

<p>This resource supports the following arguments:</p>

<ul>
<li><code>bucket</code> - (Required) Name of the source S3 bucket you want Amazon S3 to monitor.</li>
<li><code>expected_bucket_owner</code> - (Optional) Account ID of the expected bucket owner. If the bucket is owned by a different account, the request will fail with an HTTP 403 (Access Denied) error.</li>
<li><code>rule</code> - (Required) List of configuration blocks describing the rules managing the replication. <a href="#rule">See below</a>.</li>
<li><code>transition_default_minimum_object_size</code> - (Optional) The default minimum object size behavior applied to the lifecycle configuration. Valid values: <code>all_storage_classes_128K</code> (default), <code>varies_by_storage_class</code>. To customize the minimum object size for any transition you can add a <code>filter</code> that specifies a custom <code>object_size_greater_than</code> or <code>object_size_less_than</code> value. Custom filters always take precedence over the default transition behavior.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/rule"></a><h3 id="rule">rule</h3>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>The <code>filter</code> argument, while Optional, is required if the <code>rule</code> configuration block does not contain a <code>prefix</code> <strong>and</strong> you intend to override the default behavior of setting the rule to filter objects with the empty string prefix (<code>""</code>). Since <code>prefix</code> is deprecated by Amazon S3 and will be removed in the next major version of the Terraform AWS Provider, we recommend users either specify <code>filter</code> or leave both <code>filter</code> and <code>prefix</code> unspecified.</p>
</aside>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>A rule cannot be updated from having a filter (via either the <code>rule.filter</code> parameter or when neither <code>rule.filter</code> and <code>rule.prefix</code> are specified) to only having a prefix via the <code>rule.prefix</code> parameter.</p>
</aside>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>Terraform cannot distinguish a difference between configurations that use <code>rule.filter {}</code> and configurations that neither use <code>rule.filter</code> nor <code>rule.prefix</code>, so a rule cannot be updated from applying to all objects in the bucket via <code>rule.filter {}</code> to applying to a subset of objects based on the key prefix <code>""</code> and vice versa.</p>
</aside>

<p>The <code>rule</code> configuration block supports the following arguments:</p>

<ul>
<li><code>abort_incomplete_multipart_upload</code> - (Optional) Configuration block that specifies the days since the initiation of an incomplete multipart upload that Amazon S3 will wait before permanently removing all parts of the upload. <a href="#abort_incomplete_multipart_upload">See below</a>.</li>
<li><code>expiration</code> - (Optional) Configuration block that specifies the expiration for the lifecycle of the object in the form of date, days and, whether the object has a delete marker. <a href="#expiration">See below</a>.</li>
<li><code>filter</code> - (Optional) Configuration block used to identify objects that a Lifecycle Rule applies to. <a href="#filter">See below</a>. If not specified, the <code>rule</code> will default to using <code>prefix</code>.</li>
<li><code>id</code> - (Required) Unique identifier for the rule. The value cannot be longer than 255 characters.</li>
<li><code>noncurrent_version_expiration</code> - (Optional) Configuration block that specifies when noncurrent object versions expire. <a href="#noncurrent_version_expiration">See below</a>.</li>
<li><code>noncurrent_version_transition</code> - (Optional) Set of configuration blocks that specify the transition rule for the lifecycle rule that describes when noncurrent objects transition to a specific storage class. <a href="#noncurrent_version_transition">See below</a>.</li>
<li><code>prefix</code> - (Optional) <strong>DEPRECATED</strong> Use <code>filter</code> instead. This has been deprecated by Amazon S3. Prefix identifying one or more objects to which the rule applies. Defaults to an empty string (<code>""</code>) if <code>filter</code> is not specified.</li>
<li><code>status</code> - (Required) Whether the rule is currently being applied. Valid values: <code>Enabled</code> or <code>Disabled</code>.</li>
<li><code>transition</code> - (Optional) Set of configuration blocks that specify when an Amazon S3 object transitions to a specified storage class. <a href="#transition">See below</a>.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/abort_incomplete_multipart_upload"></a><h3 id="abort_incomplete_multipart_upload">abort_incomplete_multipart_upload</h3>

<p>The <code>abort_incomplete_multipart_upload</code> configuration block supports the following arguments:</p>

<ul>
<li><code>days_after_initiation</code> - Number of days after which Amazon S3 aborts an incomplete multipart upload.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/expiration"></a><h3 id="expiration">expiration</h3>

<p>The <code>expiration</code> configuration block supports the following arguments:</p>

<ul>
<li><code>date</code> - (Optional) Date the object is to be moved or deleted. The date value must be in <a href="https://datatracker.ietf.org/doc/html/rfc3339#section-5.6">RFC3339 full-date format</a> e.g. <code>2023-08-22</code>.</li>
<li><code>days</code> - (Optional) Lifetime, in days, of the objects that are subject to the rule. The value must be a non-zero positive integer.</li>
<li><code>expired_object_delete_marker</code> - (Optional, Conflicts with <code>date</code> and <code>days</code>) Indicates whether Amazon S3 will remove a delete marker with no noncurrent versions. If set to <code>true</code>, the delete marker will be expired; if set to <code>false</code> the policy takes no action.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/filter"></a><h3 id="filter">filter</h3>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>The <code>filter</code> configuration block must either be specified as the empty configuration block (<code>filter {}</code>) or with exactly one of <code>prefix</code>, <code>tag</code>, <code>and</code>, <code>object_size_greater_than</code> or <code>object_size_less_than</code> specified.</p>
</aside>

<p>The <code>filter</code> configuration block supports the following arguments:</p>

<ul>
<li><code>and</code>- (Optional) Configuration block used to apply a logical <code>AND</code> to two or more predicates. <a href="#and">See below</a>. The Lifecycle Rule will apply to any object matching all the predicates configured inside the <code>and</code> block.</li>
<li><code>object_size_greater_than</code> - (Optional) Minimum object size (in bytes) to which the rule applies.</li>
<li><code>object_size_less_than</code> - (Optional) Maximum object size (in bytes) to which the rule applies.</li>
<li><code>prefix</code> - (Optional) Prefix identifying one or more objects to which the rule applies. Defaults to an empty string (<code>""</code>) if not specified.</li>
<li><code>tag</code> - (Optional) Configuration block for specifying a tag key and value. <a href="#tag">See below</a>.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/noncurrent_version_expiration"></a><h3 id="noncurrent_version_expiration">noncurrent_version_expiration</h3>

<p>The <code>noncurrent_version_expiration</code> configuration block supports the following arguments:</p>

<ul>
<li><code>newer_noncurrent_versions</code> - (Optional) Number of noncurrent versions Amazon S3 will retain. Must be a non-zero positive integer.</li>
<li><code>noncurrent_days</code> - (Optional) Number of days an object is noncurrent before Amazon S3 can perform the associated action. Must be a positive integer.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/noncurrent_version_transition"></a><h3 id="noncurrent_version_transition">noncurrent_version_transition</h3>

<p>The <code>noncurrent_version_transition</code> configuration block supports the following arguments:</p>

<ul>
<li><code>newer_noncurrent_versions</code> - (Optional) Number of noncurrent versions Amazon S3 will retain. Must be a non-zero positive integer.</li>
<li><code>noncurrent_days</code> - (Optional) Number of days an object is noncurrent before Amazon S3 can perform the associated action.</li>
<li><code>storage_class</code> - (Required) Class of storage used to store the object. Valid Values: <code>GLACIER</code>, <code>STANDARD_IA</code>, <code>ONEZONE_IA</code>, <code>INTELLIGENT_TIERING</code>, <code>DEEP_ARCHIVE</code>, <code>GLACIER_IR</code>.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/transition"></a><h3 id="transition">transition</h3>

<p>The <code>transition</code> configuration block supports the following arguments:</p>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>Only one of <code>date</code> or <code>days</code> should be specified. If neither are specified, the <code>transition</code> will default to 0 <code>days</code>.</p>
</aside>

<ul>
<li><code>date</code> - (Optional, Conflicts with <code>days</code>) Date objects are transitioned to the specified storage class. The date value must be in <a href="https://datatracker.ietf.org/doc/html/rfc3339#section-5.6">RFC3339 full-date format</a> e.g. <code>2023-08-22</code>.</li>
<li><code>days</code> - (Optional, Conflicts with <code>date</code>) Number of days after creation when objects are transitioned to the specified storage class. The value must be a positive integer. If both <code>days</code> and <code>date</code> are not specified, defaults to <code>0</code>. Valid values depend on <code>storage_class</code>, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/lifecycle-transition-general-considerations.html">Transition objects using Amazon S3 Lifecycle</a> for more details.</li>
<li><code>storage_class</code> - Class of storage used to store the object. Valid Values: <code>GLACIER</code>, <code>STANDARD_IA</code>, <code>ONEZONE_IA</code>, <code>INTELLIGENT_TIERING</code>, <code>DEEP_ARCHIVE</code>, <code>GLACIER_IR</code>.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/and"></a><h3 id="and">and</h3>

<p>The <code>and</code> configuration block supports the following arguments:</p>

<ul>
<li><code>object_size_greater_than</code> - (Optional) Minimum object size to which the rule applies. Value must be at least <code>0</code> if specified. Defaults to 128000 (128 KB) for all <code>storage_class</code> values unless <code>transition_default_minimum_object_size</code> specifies otherwise.</li>
<li><code>object_size_less_than</code> - (Optional) Maximum object size to which the rule applies. Value must be at least <code>1</code> if specified.</li>
<li><code>prefix</code> - (Optional) Prefix identifying one or more objects to which the rule applies.</li>
<li><code>tags</code> - (Optional) Key-value map of resource tags. All of these tags must exist in the object's tag set in order for the rule to apply.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/tag"></a><h3 id="tag">tag</h3>

<p>The <code>tag</code> configuration block supports the following arguments:</p>

<ul>
<li><code>key</code> - (Required) Name of the object key.</li>
<li><code>value</code> - (Required) Value of the tag.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Attribute%20Reference"></a><h2 id="attribute-reference">Attribute Reference</h2>

<p>This resource exports the following attributes in addition to the arguments above:</p>

<ul>
<li><code>id</code> - The <code>bucket</code> or <code>bucket</code> and <code>expected_bucket_owner</code> separated by a comma (<code>,</code>) if the latter is provided.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Import"></a><h2 id="import">Import</h2>

<p>In Terraform v1.5.0 and later, use an <a href="https://developer.hashicorp.com/terraform/language/import"><code>import</code> block</a> to import an S3 bucket lifecycle configuration using the <code>bucket</code> or the <code>bucket</code> and <code>expected_bucket_owner</code> separated by a comma (<code>,</code>). For example:</p>

<p>If the owner (account ID) of the source bucket is the same account used to configure the Terraform AWS Provider, import using the <code>bucket</code>:</p>

<div class="codehilite"><pre><span></span><code><span class="nb">import</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket_lifecycle_configuration.example</span><span class="w"></span>
<span class="w">  </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bucket-name"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>If the owner (account ID) of the source bucket differs from the account used to configure the Terraform AWS Provider, import using the <code>bucket</code> and <code>expected_bucket_owner</code> separated by a comma (<code>,</code>):</p>

<div class="codehilite"><pre><span></span><code><span class="nb">import</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket_lifecycle_configuration.example</span><span class="w"></span>
<span class="w">  </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bucket-name,123456789012"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Using <code>terraform import</code>, import an S3 bucket lifecycle configuration using the <code>bucket</code> or the <code>bucket</code> and <code>expected_bucket_owner</code> separated by a comma (<code>,</code>). For example:</p>

<p>If the owner (account ID) of the source bucket is the same account used to configure the Terraform AWS Provider, import using the <code>bucket</code>:</p>

<div class="codehilite"><pre><span></span><code><span class="gp">% </span>terraform import aws_s3_bucket_lifecycle_configuration.example bucket-name
</code></pre></div>

<p>If the owner (account ID) of the source bucket differs from the account used to configure the Terraform AWS Provider, import using the <code>bucket</code> and <code>expected_bucket_owner</code> separated by a comma (<code>,</code>):</p>

<div class="codehilite"><pre><span></span><code><span class="gp">% </span>terraform import aws_s3_bucket_lifecycle_configuration.example bucket-name,123456789012
</code></pre></div>

            
        
    </body></html>