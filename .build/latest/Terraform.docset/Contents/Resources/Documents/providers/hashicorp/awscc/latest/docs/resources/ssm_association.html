<html><!-- Online page at https://registry.terraform.io/providers/hashicorp/awscc/latest/docs/resources/ssm_association --><head>
                <title>awscc_ssm_association</title>
                <meta charset="utf-8"/>
                <link href="../../../../../../style.css" rel="stylesheet"/>
            </head>
            <body>
                <h1 id="awscc_ssm_association-resource">awscc_ssm_association (Resource)</h1>

<p>The AWS::SSM::Association resource associates an SSM document in AWS Systems Manager with EC2 instances that contain a configuration agent to process the document.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Example%20Usage"></a><h2 id="example-usage">Example Usage</h2>

<a class="dashAnchor" name="//apple_ref/cpp/Section/PowerShell%20Script%20Association%20with%20S3%20Output"></a><h3 id="powershell-script-association-with-s3-output">PowerShell Script Association with S3 Output</h3>

<p>Creates an SSM association to run PowerShell script on Production-tagged instances with scheduled execution, storing output in a secure S3 bucket that has proper access controls and bucket policies for SSM service.</p>

<aside class="admonition warning">
    <strong>warning</strong>
    <em>warning</em>
    <p>This example is generated by LLM using Amazon Bedrock and validated using terraform validate, apply and destroy. While we strive for accuracy and quality, please note that the information provided may not be entirely error-free or up-to-date. We recommend independently verifying the content.</p>
</aside>

<div class="codehilite"><pre><span></span><code><span class="c1"># Data sources for region and caller identity</span>
<span class="kr">data</span><span class="w"> </span><span class="nc">"aws_region"</span><span class="w"> </span><span class="nv">"current"</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="kr">data</span><span class="w"> </span><span class="nc">"aws_caller_identity"</span><span class="w"> </span><span class="nv">"current"</span><span class="w"> </span><span class="p">{}</span><span class="c1"></span>

<span class="c1"># Create an AWS SSM Association for running AWS-RunPowerShellScript</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"awscc_ssm_association"</span><span class="w"> </span><span class="nv">"example"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"AWS-RunPowerShellScript"</span><span class="w"></span>
<span class="w">  </span><span class="na">association_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"example-powershell-association"</span><span class="w"></span>

<span class="w">  </span><span class="na">targets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="w"></span>
<span class="w">    </span><span class="na">key</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"tag:Environment"</span><span class="w"></span>
<span class="w">    </span><span class="na">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"Production"</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}]</span><span class="w"></span>

<span class="w">  </span><span class="nb">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"Get-Service"</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="na">schedule_expression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cron(0 0 * * ? *)"</span><span class="w"></span>

<span class="w">  </span><span class="nb">output_location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">s3_location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">output_s3_bucket_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">awscc_s3_bucket.output.id</span><span class="w"></span>
<span class="w">      </span><span class="na">output_s3_key_prefix</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"ssm-output/"</span><span class="w"></span>
<span class="w">      </span><span class="na">output_s3_region</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_region.current.name</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="na">max_concurrency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"50%"</span><span class="w"></span>
<span class="w">  </span><span class="na">max_errors</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"25%"</span><span class="w"></span>
<span class="w">  </span><span class="na">compliance_severity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"MEDIUM"</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1"># Create S3 bucket for output</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"awscc_s3_bucket"</span><span class="w"> </span><span class="nv">"output"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ssm-association-output-${data.aws_caller_identity.current.account_id}-${data.aws_region.current.name}"</span><span class="w"></span>

<span class="w">  </span><span class="nb">public_access_block_configuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">block_public_acls</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">block_public_policy</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">ignore_public_acls</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">    </span><span class="na">restrict_public_buckets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">ownership_controls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="w"></span>
<span class="w">      </span><span class="na">object_ownership</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BucketOwnerPreferred"</span><span class="w"></span>
<span class="w">    </span><span class="p">}]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="w"></span>
<span class="w">    </span><span class="na">key</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"Modified By"</span><span class="w"></span>
<span class="w">    </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"AWSCC"</span><span class="w"></span>
<span class="w">  </span><span class="p">}]</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1"># Create bucket policy for SSM</span>
<span class="kr">data</span><span class="w"> </span><span class="nc">"aws_iam_policy_document"</span><span class="w"> </span><span class="nv">"bucket_policy"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">statement</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Allow"</span><span class="w"></span>
<span class="w">    </span><span class="nb">principals</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"Service"</span><span class="w"></span>
<span class="w">      </span><span class="na">identifiers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"ssm.amazonaws.com"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="na">actions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="s2">"s3:PutObject"</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="na">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="s2">"${awscc_s3_bucket.output.arn}/*"</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="nb">condition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">test</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"StringEquals"</span><span class="w"></span>
<span class="w">      </span><span class="na">variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aws:SourceAccount"</span><span class="w"></span>
<span class="w">      </span><span class="na">values</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">data.aws_caller_identity.current.account_id</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="nb">condition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">test</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"StringEquals"</span><span class="w"></span>
<span class="w">      </span><span class="na">variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aws:SourceRegion"</span><span class="w"></span>
<span class="w">      </span><span class="na">values</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">data.aws_region.current.name</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"awscc_s3_bucket_policy"</span><span class="w"> </span><span class="nv">"allow_ssm"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">bucket</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">awscc_s3_bucket.output.id</span><span class="w"></span>
<span class="w">  </span><span class="na">policy_document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_iam_policy_document.bucket_policy.json</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<!-- schema generated by tfplugindocs -->

<a class="dashAnchor" name="//apple_ref/cpp/Section/Schema"></a><h2 id="schema">Schema</h2>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Required"></a><h3 id="required">Required</h3>

<ul>
<li><code>name</code> (String) The name of the SSM document.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Optional"></a><h3 id="optional">Optional</h3>

<ul>
<li><code>apply_only_at_cron_interval</code> (Boolean)</li>
<li><code>association_name</code> (String) The name of the association.</li>
<li><code>automation_target_parameter_name</code> (String)</li>
<li><code>calendar_names</code> (List of String)</li>
<li><code>compliance_severity</code> (String)</li>
<li><code>document_version</code> (String) The version of the SSM document to associate with the target.</li>
<li><code>instance_id</code> (String) The ID of the instance that the SSM document is associated with.</li>
<li><code>max_concurrency</code> (String)</li>
<li><code>max_errors</code> (String)</li>
<li><code>output_location</code> (Attributes) (see <a href="#nestedatt--output_location">below for nested schema</a>)</li>
<li><code>parameters</code> (Map of List of String) Parameter values that the SSM document uses at runtime.</li>
<li><code>schedule_expression</code> (String) A Cron or Rate expression that specifies when the association is applied to the target.</li>
<li><code>schedule_offset</code> (Number)</li>
<li><code>sync_compliance</code> (String)</li>
<li><code>targets</code> (Attributes List) The targets that the SSM document sends commands to. (see <a href="#nestedatt--targets">below for nested schema</a>)</li>
<li><code>wait_for_success_timeout_seconds</code> (Number)</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Read-Only"></a><h3 id="read-only">Read-Only</h3>

<ul>
<li><code>association_id</code> (String) Unique identifier of the association.</li>
<li><code>id</code> (String) Uniquely identifies the resource.</li>
</ul>

<p><a id="nestedatt--output_location"></a></p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Nested%20Schema%20for%20output_location"></a><h3 id="nested-schema-for-output_location">Nested Schema for <code>output_location</code></h3>

<p>Optional:</p>

<ul>
<li><code>s3_location</code> (Attributes) (see <a href="#nestedatt--output_location--s3_location">below for nested schema</a>)</li>
</ul>

<p><a id="nestedatt--output_location--s3_location"></a></p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Nested%20Schema%20for%20output_location.s3_location"></a><h3 id="nested-schema-for-output_locations3_location">Nested Schema for <code>output_location.s3_location</code></h3>

<p>Optional:</p>

<ul>
<li><code>output_s3_bucket_name</code> (String)</li>
<li><code>output_s3_key_prefix</code> (String)</li>
<li><code>output_s3_region</code> (String)</li>
</ul>

<p><a id="nestedatt--targets"></a></p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Nested%20Schema%20for%20targets"></a><h3 id="nested-schema-for-targets">Nested Schema for <code>targets</code></h3>

<p>Optional:</p>

<ul>
<li><code>key</code> (String)</li>
<li><code>values</code> (List of String)</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Import"></a><h2 id="import">Import</h2>

<p>Import is supported using the following syntax:</p>

<div class="codehilite"><pre><span></span><code>$ terraform import awscc_ssm_association.example <span class="s2">"association_id"</span>
</code></pre></div>

            
        
    </body></html>