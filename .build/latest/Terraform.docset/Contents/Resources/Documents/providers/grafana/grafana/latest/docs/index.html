<html><!-- Online page at https://registry.terraform.io/providers/grafana/grafana/latest/docs --><head>
                <title>Grafana Provider</title>
                <meta charset="utf-8"/>
                <link href="../../../../../style.css" rel="stylesheet"/>
            </head>
            <body>
                <h1 id="grafana-provider">Grafana Provider</h1>

<p>The Grafana provider provides configuration management resources for
<a href="https://grafana.com/">Grafana</a>.</p>

<p>The changelog for this provider can be found here: <a href="https://github.com/grafana/terraform-provider-grafana/releases">https://github.com/grafana/terraform-provider-grafana/releases</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Example%20Usage"></a><h2 id="example-usage">Example Usage</h2>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Creating%20a%20Grafana%20provider"></a><h3 id="creating-a-grafana-provider">Creating a Grafana provider</h3>

<div class="codehilite"><pre><span></span><code><span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">url</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://grafana.example.com/"</span><span class="w"></span>
<span class="w">  </span><span class="na">auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.grafana_auth</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Optional (On-premise, not supported in Grafana Cloud): Create an organization</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_organization"</span><span class="w"> </span><span class="nv">"my_org"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"my_org"</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Create resources (optional: within the organization)</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_folder"</span><span class="w"> </span><span class="nv">"my_folder"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">org_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_organization.my_org.org_id</span><span class="w"></span>
<span class="w">  </span><span class="na">title</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"Test Folder"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_dashboard"</span><span class="w"> </span><span class="nv">"test_folder"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">org_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_organization.my_org.org_id</span><span class="w"></span>
<span class="w">  </span><span class="na">folder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_folder.my_folder.id</span><span class="w"></span>
<span class="w">  </span><span class="na">config_json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span><span class="w"></span>
<span class="w">    </span><span class="s2">"title"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">"My Dashboard Title"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"uid"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">"my-dashboard-uid"</span><span class="c1"></span>
<span class="c1">    // ... other dashboard properties</span>
<span class="w">  </span><span class="p">})</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Creating%20a%20Grafana%20Cloud%20stack%20provider"></a><h3 id="creating-a-grafana-cloud-stack-provider">Creating a Grafana Cloud stack provider</h3>

<div class="codehilite"><pre><span></span><code><span class="c1">// Step 1: Create a stack</span>
<span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">alias</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">"cloud"</span><span class="w"></span>
<span class="w">  </span><span class="na">cloud_access_policy_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"my-token"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_cloud_stack"</span><span class="w"> </span><span class="nv">"my_stack"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.cloud</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"myteststack"</span><span class="w"></span>
<span class="w">  </span><span class="na">slug</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"myteststack"</span><span class="w"></span>
<span class="w">  </span><span class="na">region_slug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"prod-us-east-0"</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Step 2: Create a service account and key for the stack</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_cloud_stack_service_account"</span><span class="w"> </span><span class="nv">"cloud_sa"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.cloud</span><span class="w"></span>
<span class="w">  </span><span class="na">stack_slug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_stack.my_stack.slug</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"cloud service account"</span><span class="w"></span>
<span class="w">  </span><span class="na">role</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"Admin"</span><span class="w"></span>
<span class="w">  </span><span class="na">is_disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_cloud_stack_service_account_token"</span><span class="w"> </span><span class="nv">"cloud_sa"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.cloud</span><span class="w"></span>
<span class="w">  </span><span class="na">stack_slug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_stack.my_stack.slug</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">"my_stack cloud_sa key"</span><span class="w"></span>
<span class="w">  </span><span class="na">service_account_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_stack_service_account.cloud_sa.id</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Step 3: Create resources within the stack</span>
<span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">alias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"my_stack"</span><span class="w"></span>

<span class="w">  </span><span class="na">url</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_stack.my_stack.url</span><span class="w"></span>
<span class="w">  </span><span class="na">auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_stack_service_account_token.cloud_sa.key</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_folder"</span><span class="w"> </span><span class="nv">"my_folder"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.my_stack</span><span class="w"></span>

<span class="w">  </span><span class="na">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Test Folder"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Installing%20Synthetic%20Monitoring%20on%20a%20new%20Grafana%20Cloud%20Stack"></a><h3 id="installing-synthetic-monitoring-on-a-new-grafana-cloud-stack">Installing Synthetic Monitoring on a new Grafana Cloud Stack</h3>

<div class="codehilite"><pre><span></span><code><span class="kr">variable</span><span class="w"> </span><span class="nv">"cloud_access_policy_token"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cloud Access Policy token for Grafana Cloud with the following scopes: accesspolicies:read|write|delete, stacks:read|write|delete"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kr">variable</span><span class="w"> </span><span class="nv">"stack_slug"</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="kr">variable</span><span class="w"> </span><span class="nv">"cloud_region"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"prod-us-east-0"</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Step 1: Create a stack</span>
<span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">alias</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="s2">"cloud"</span><span class="w"></span>
<span class="w">  </span><span class="na">cloud_access_policy_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.cloud_access_policy_token</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_cloud_stack"</span><span class="w"> </span><span class="nv">"sm_stack"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.cloud</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">var.stack_slug</span><span class="w"></span>
<span class="w">  </span><span class="na">slug</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">var.stack_slug</span><span class="w"></span>
<span class="w">  </span><span class="na">region_slug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.cloud_region</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Step 2: Install Synthetic Monitoring on the stack</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_cloud_access_policy"</span><span class="w"> </span><span class="nv">"sm_metrics_publish"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.cloud</span><span class="w"></span>

<span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.cloud_region</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"metric-publisher-for-sm"</span><span class="w"></span>
<span class="w">  </span><span class="na">scopes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"metrics:write", "stacks:read", "logs:write", "traces:write"</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="nb">realm</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">type</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"stack"</span><span class="w"></span>
<span class="w">    </span><span class="na">identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_stack.sm_stack.id</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_cloud_access_policy_token"</span><span class="w"> </span><span class="nv">"sm_metrics_publish"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.cloud</span><span class="w"></span>

<span class="w">  </span><span class="na">region</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="nv">var.cloud_region</span><span class="w"></span>
<span class="w">  </span><span class="na">access_policy_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_access_policy.sm_metrics_publish.policy_id</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">"metric-publisher-for-sm"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_synthetic_monitoring_installation"</span><span class="w"> </span><span class="nv">"sm_stack"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.cloud</span><span class="w"></span>

<span class="w">  </span><span class="na">stack_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_stack.sm_stack.id</span><span class="w"></span>
<span class="w">  </span><span class="na">metrics_publisher_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_access_policy_token.sm_metrics_publish.token</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>


<span class="c1">// Step 3: Interact with Synthetic Monitoring</span>
<span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">alias</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">"sm"</span><span class="w"></span>
<span class="w">  </span><span class="na">sm_access_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_synthetic_monitoring_installation.sm_stack.sm_access_token</span><span class="w"></span>
<span class="w">  </span><span class="na">sm_url</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_synthetic_monitoring_installation.sm_stack.stack_sm_api_url</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"grafana_synthetic_monitoring_probes"</span><span class="w"> </span><span class="nv">"main"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.sm</span><span class="w"></span>
<span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">grafana_synthetic_monitoring_installation.sm_stack</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Managing%20Grafana%20OnCall"></a><h3 id="managing-grafana-oncall">Managing Grafana OnCall</h3>

<div class="codehilite"><pre><span></span><code><span class="c1">// Step 1: Configure provider block.</span>
<span class="c1">// You may need to set oncall_url too, depending on your region or if you are using Grafana OnCall OSS. You can get it in OnCall -&gt; settings -&gt; API URL.</span>
<span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">alias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"oncall"</span><span class="w"></span>
<span class="w">  </span><span class="na">url</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://grafana.example.com/"</span><span class="w"></span>
<span class="w">  </span><span class="na">auth</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.grafana_auth</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"grafana_oncall_user"</span><span class="w"> </span><span class="nv">"alex"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"alex"</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Step 2: Interact with Grafana OnCall</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_oncall_integration"</span><span class="w"> </span><span class="nv">"test-acc-integration"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.oncall</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"my integration"</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"grafana"</span><span class="w"></span>
<span class="w">  </span><span class="nb">default_route</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">escalation_chain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_oncall_escalation_chain.default.id</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_oncall_escalation_chain"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.oncall</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"default"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_oncall_escalation"</span><span class="w"> </span><span class="nv">"example_notify_step"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">escalation_chain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_oncall_escalation_chain.default.id</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"notify_persons"</span><span class="w"></span>
<span class="w">  </span><span class="na">persons_to_notify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="nv">data.grafana_oncall_user.alex.id</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Alternatively, you can also configure the provider block by setting
an specific <code>oncall_access_token</code> instead, that you can create in the web UI:</p>

<div class="codehilite"><pre><span></span><code><span class="c1">// Step 1: Configure provider block.</span>
<span class="c1">// Go to the Grafana OnCall in your stack and create api token in the settings tab.It will be your oncall_access_token.</span>
<span class="c1">// If you are using Grafana OnCall OSS consider set oncall_url. You can get it in OnCall -&gt; settings -&gt; API URL.</span>
<span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">alias</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">"oncall"</span><span class="w"></span>
<span class="w">  </span><span class="na">oncall_access_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"my_oncall_token"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"grafana_oncall_user"</span><span class="w"> </span><span class="nv">"alex"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"alex"</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Step 2: Interact with Grafana OnCall</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_oncall_integration"</span><span class="w"> </span><span class="nv">"test-acc-integration"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.oncall</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"my integration"</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"grafana"</span><span class="w"></span>
<span class="w">  </span><span class="nb">default_route</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">escalation_chain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_oncall_escalation_chain.default.id</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_oncall_escalation_chain"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.oncall</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"default"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_oncall_escalation"</span><span class="w"> </span><span class="nv">"example_notify_step"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">escalation_chain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_oncall_escalation_chain.default.id</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"notify_persons"</span><span class="w"></span>
<span class="w">  </span><span class="na">persons_to_notify</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="nv">data.grafana_oncall_user.alex.id</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Managing%20Frontend%20Observability"></a><h3 id="managing-frontend-observability">Managing Frontend Observability</h3>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Obtaining%20Frontend%20Observability%20Access%20Token"></a><h4 id="obtaining-frontend-observability-access-token">Obtaining Frontend Observability Access Token</h4>

<p>Before using the Terraform Provider to manage Grafana Frontend Observability resources, such as your apps, you need to create an access policy token on the Grafana Cloud Portal. This token is used to authenticate the provider to the Grafana Frontend Observability API.
<a href="https://grafana.com/docs/grafana-cloud/security-and-account-management/authentication-and-permissions/access-policies/using-an-access-policy-token/#create-an-access-policy-for-a-stack">These docs</a> will guide you on how to create
an access policy. The required permissions, or scopes, are <code>frontend-observability:read</code>, <code>frontend-observability:write</code>, <code>frontend-observability:delete</code> and <code>stacks:read</code>.</p>

<p>You can also use the <code>cloud_access_policy_token</code> provided it has the aforementioned scopes included.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Configuring%20the%20Provider%20to%20use%20the%20Frontend%20Observability%20API"></a><h4 id="configuring-the-provider-to-use-the-frontend-observability-api">Configuring the Provider to use the Frontend Observability API</h4>

<p>Once you have the token you can configure the provider as follows:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">frontend_o11y_api_access_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;Access Token from previous step&gt;"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<!-- schema generated by tfplugindocs -->

<a class="dashAnchor" name="//apple_ref/cpp/Section/Schema"></a><h2 id="schema">Schema</h2>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Optional"></a><h3 id="optional">Optional</h3>

<ul>
<li><code>auth</code> (String, Sensitive) API token, basic auth in the <code>username:password</code> format or <code>anonymous</code> (string literal). May alternatively be set via the <code>GRAFANA_AUTH</code> environment variable.</li>
<li><code>ca_cert</code> (String) Certificate CA bundle (file path or literal value) to use to verify the Grafana server's certificate. May alternatively be set via the <code>GRAFANA_CA_CERT</code> environment variable.</li>
<li><code>cloud_access_policy_token</code> (String, Sensitive) Access Policy Token for Grafana Cloud. May alternatively be set via the <code>GRAFANA_CLOUD_ACCESS_POLICY_TOKEN</code> environment variable.</li>
<li><code>cloud_api_url</code> (String) Grafana Cloud's API URL. May alternatively be set via the <code>GRAFANA_CLOUD_API_URL</code> environment variable.</li>
<li><code>cloud_provider_access_token</code> (String, Sensitive) A Grafana Cloud Provider access token. May alternatively be set via the <code>GRAFANA_CLOUD_PROVIDER_ACCESS_TOKEN</code> environment variable.</li>
<li><code>cloud_provider_url</code> (String) A Grafana Cloud Provider backend address. May alternatively be set via the <code>GRAFANA_CLOUD_PROVIDER_URL</code> environment variable.</li>
<li><code>connections_api_access_token</code> (String, Sensitive) A Grafana Connections API access token. May alternatively be set via the <code>GRAFANA_CONNECTIONS_API_ACCESS_TOKEN</code> environment variable.</li>
<li><code>connections_api_url</code> (String) A Grafana Connections API address. May alternatively be set via the <code>GRAFANA_CONNECTIONS_API_URL</code> environment variable.</li>
<li><code>fleet_management_auth</code> (String, Sensitive) A Grafana Fleet Management basic auth in the <code>username:password</code> format. May alternatively be set via the <code>GRAFANA_FLEET_MANAGEMENT_AUTH</code> environment variable.</li>
<li><code>fleet_management_url</code> (String) A Grafana Fleet Management API address. May alternatively be set via the <code>GRAFANA_FLEET_MANAGEMENT_URL</code> environment variable.</li>
<li><code>frontend_o11y_api_access_token</code> (String, Sensitive) A Grafana Frontend Observability API access token. May alternatively be set via the <code>GRAFANA_FRONTEND_O11Y_API_ACCESS_TOKEN</code> environment variable.</li>
<li><code>http_headers</code> (Map of String, Sensitive) Optional. HTTP headers mapping keys to values used for accessing the Grafana and Grafana Cloud APIs. May alternatively be set via the <code>GRAFANA_HTTP_HEADERS</code> environment variable in JSON format.</li>
<li><code>insecure_skip_verify</code> (Boolean) Skip TLS certificate verification. May alternatively be set via the <code>GRAFANA_INSECURE_SKIP_VERIFY</code> environment variable.</li>
<li><code>oncall_access_token</code> (String, Sensitive) A Grafana OnCall access token. May alternatively be set via the <code>GRAFANA_ONCALL_ACCESS_TOKEN</code> environment variable.</li>
<li><code>oncall_url</code> (String) An Grafana OnCall backend address. May alternatively be set via the <code>GRAFANA_ONCALL_URL</code> environment variable.</li>
<li><code>retries</code> (Number) The amount of retries to use for Grafana API and Grafana Cloud API calls. May alternatively be set via the <code>GRAFANA_RETRIES</code> environment variable.</li>
<li><code>retry_status_codes</code> (Set of String) The status codes to retry on for Grafana API and Grafana Cloud API calls. Use <code>x</code> as a digit wildcard. Defaults to 429 and 5xx. May alternatively be set via the <code>GRAFANA_RETRY_STATUS_CODES</code> environment variable.</li>
<li><code>retry_wait</code> (Number) The amount of time in seconds to wait between retries for Grafana API and Grafana Cloud API calls. May alternatively be set via the <code>GRAFANA_RETRY_WAIT</code> environment variable.</li>
<li><code>sm_access_token</code> (String, Sensitive) A Synthetic Monitoring access token. May alternatively be set via the <code>GRAFANA_SM_ACCESS_TOKEN</code> environment variable.</li>
<li><code>sm_url</code> (String) Synthetic monitoring backend address. May alternatively be set via the <code>GRAFANA_SM_URL</code> environment variable. The correct value for each service region is cited in the <a href="https://grafana.com/docs/grafana-cloud/testing/synthetic-monitoring/set-up/set-up-private-probes/#probe-api-server-url">Synthetic Monitoring documentation</a>. Note the <code>sm_url</code> value is optional, but it must correspond with the value specified as the <code>region_slug</code> in the <code>grafana_cloud_stack</code> resource. Also note that when a Terraform configuration contains multiple provider instances managing SM resources associated with the same Grafana stack, specifying an explicit <code>sm_url</code> set to the same value for each provider ensures all providers interact with the same SM API.</li>
<li><code>store_dashboard_sha256</code> (Boolean) Set to true if you want to save only the sha256sum instead of complete dashboard model JSON in the tfstate.</li>
<li><code>tls_cert</code> (String) Client TLS certificate (file path or literal value) to use to authenticate to the Grafana server. May alternatively be set via the <code>GRAFANA_TLS_CERT</code> environment variable.</li>
<li><code>tls_key</code> (String) Client TLS key (file path or literal value) to use to authenticate to the Grafana server. May alternatively be set via the <code>GRAFANA_TLS_KEY</code> environment variable.</li>
<li><code>url</code> (String) The root URL of a Grafana server. May alternatively be set via the <code>GRAFANA_URL</code> environment variable.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Managing%20Cloud%20Provider"></a><h3 id="managing-cloud-provider">Managing Cloud Provider</h3>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Obtaining%20Cloud%20Provider%20access%20token"></a><h4 id="obtaining-cloud-provider-access-token">Obtaining Cloud Provider access token</h4>

<p>Before using the Terraform Provider to manage Grafana Cloud Provider Observability resources, such as AWS CloudWatch scrape jobs, you need to create an access policy token on the Grafana Cloud Portal. This token is used to authenticate the provider to the Grafana Cloud Provider API.
<a href="https://grafana.com/docs/grafana-cloud/account-management/authentication-and-permissions/access-policies/using-an-access-policy-token/#create-an-access-policy-for-a-stack">These docs</a> will guide you on how to create
an access policy. The required permissions, or scopes, are <code>integration-management:read</code>, <code>integration-management:write</code> and <code>stacks:read</code>.</p>

<p>Also, by default the Access Policies UI will not show those scopes, to find name you need to use the <code>Add Scope</code> textbox, as shown in the following image:</p>

<p><img src="https://grafana.com/media/docs/grafana-cloud/aws/cloud-provider-terraform-access-policy-creation.png" width="700"/></p>

<p>Having created an Access Policy, you can now create a token that will be used to authenticate the provider to the Cloud Provider API. You can do so just after creating the access policy, following
the in-screen instructions, of following <a href="https://grafana.com/docs/grafana-cloud/account-management/authentication-and-permissions/access-policies/using-an-access-policy-token/#create-one-or-more-access-policy-tokens">this guide</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Obtaining%20Cloud%20Provider%20API%20hostname"></a><h4 id="obtaining-cloud-provider-api-hostname">Obtaining Cloud Provider API hostname</h4>

<p>Having created the token, we can find the correct Cloud Provider API hostname by running the following script, that requires <code>curl</code> and <a href="https://jqlang.org/"><code>jq</code></a> installed:</p>

<div class="codehilite"><pre><span></span><code>curl -sH <span class="s2">"Authorization: Bearer &lt;Access Token from previous step&gt;"</span> <span class="s2">"https://grafana.com/api/instances"</span> <span class="p">|</span> <span class="se">\</span>
  jq <span class="s1">'[.items[]|{stackName: .slug, clusterName:.clusterSlug, cloudProviderAPIURL: "https://cloud-provider-api-\(.clusterSlug).grafana.net"}]'</span>
</code></pre></div>

<p>This script will return a list of all the Grafana Cloud stacks you own, with the Cloud Provider API hostname for each one. Choose the correct hostname for the stack you want to manage.
For example, in the following response, the correct hostname for the <code>herokublogpost</code> stack is <code>https://cloud-provider-api-prod-us-central-0.grafana.net</code>.</p>

<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">"stackName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"herokublogpost"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">"clusterName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"prod-us-central-0"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">"cloudProviderAPIURL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://cloud-provider-api-prod-us-central-0.grafana.net"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">]</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Configuring%20the%20Provider%20to%20use%20the%20Cloud%20Provider%20API"></a><h4 id="configuring-the-provider-to-use-the-cloud-provider-api">Configuring the Provider to use the Cloud Provider API</h4>

<p>Once you have the token and Cloud Provider API hostanme, you can configure the provider as follows:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">  // ...</span>
<span class="w">  </span><span class="na">cloud_provider_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">&lt;Cloud</span><span class="w"> </span><span class="err">Provider</span><span class="w"> </span><span class="err">API</span><span class="w"> </span><span class="err">URL</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">previous</span><span class="w"> </span><span class="err">step&gt;</span><span class="w"></span>
<span class="w">  </span><span class="na">cloud_provider_access_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">&lt;Access</span><span class="w"> </span><span class="err">Token</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">previous</span><span class="w"> </span><span class="err">step&gt;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>The following are examples on how the <em>Account</em> and <em>Scrape Job</em> resources can be configured:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"grafana_cloud_stack"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">slug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gcloudstacktest"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"aws_iam_role"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"my-role"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_cloud_provider_aws_account"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">stack_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.grafana_cloud_stack.test.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_iam_role.test.arn</span><span class="w"></span>
<span class="w">  </span><span class="na">regions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="s2">"us-east-1"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"us-east-2"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"us-west-1"</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"grafana_cloud_stack"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">slug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gcloudstacktest"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"aws_iam_role"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"my-role"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_cloud_provider_aws_account"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">stack_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.grafana_cloud_stack.test.id</span><span class="w"></span>
<span class="w">  </span><span class="na">role_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_iam_role.test.arn</span><span class="w"></span>
<span class="w">  </span><span class="na">regions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="s2">"us-east-1"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"us-east-2"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"us-west-1"</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_cloud_provider_aws_cloudwatch_scrape_job"</span><span class="w"> </span><span class="nv">"test"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">stack_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">data.grafana_cloud_stack.test.id</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="s2">"my-cloudwatch-scrape-job"</span><span class="w"></span>
<span class="w">  </span><span class="na">aws_account_resource_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_provider_aws_account.test.resource_id</span><span class="w"></span>
<span class="w">  </span><span class="na">export_tags</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>

<span class="w">  </span><span class="nb">service</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"AWS/EC2"</span><span class="w"></span>
<span class="w">    </span><span class="nb">metric</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"CPUUtilization"</span><span class="w"></span>
<span class="w">      </span><span class="na">statistics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"Average"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="nb">metric</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"StatusCheckFailed"</span><span class="w"></span>
<span class="w">      </span><span class="na">statistics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"Maximum"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="na">scrape_interval_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span><span class="w"></span>
<span class="w">    </span><span class="nb">resource_discovery_tag_filter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">key</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"k8s.io/cluster-autoscaler/enabled"</span><span class="w"></span>
<span class="w">      </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"true"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="na">tags_to_add_to_metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"eks:cluster-name"</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">custom_namespace</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"CoolApp"</span><span class="w"></span>
<span class="w">    </span><span class="nb">metric</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"CoolMetric"</span><span class="w"></span>
<span class="w">      </span><span class="na">statistics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"Maximum", "Sum"</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="na">scrape_interval_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">static_labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="s2">"label1"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"value1"</span><span class="w"></span>
<span class="w">    </span><span class="s2">"label2"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"value2"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Managing%20Connections"></a><h3 id="managing-connections">Managing Connections</h3>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Obtaining%20Connections%20access%20token"></a><h4 id="obtaining-connections-access-token">Obtaining Connections access token</h4>

<p>Before using the Terraform Provider to manage Grafana Connections resources, such as metrics endpoint scrape jobs, you need to create an access policy token on the Grafana Cloud Portal. This token is used to authenticate the provider to the Grafana Connections API.
<a href="https://grafana.com/docs/grafana-cloud/account-management/authentication-and-permissions/access-policies/using-an-access-policy-token/#create-an-access-policy-for-a-stack">These docs</a> will guide you on how to create
an access policy. The required permissions, or scopes, are <code>integration-management:read</code>, <code>integration-management:write</code> and <code>stacks:read</code>.</p>

<p>Also, by default the Access Policies UI will not show those scopes, instead, search for it using the <code>Add Scope</code> textbox, as shown in the following image:</p>

<p><img src="https://grafana.com/media/docs/grafana-cloud/connections/connections-terraform-access-policy-create.png" width="700"/></p>

<ol>
<li>Use the <code>Add Scope</code> textbox to search for the permissions you need to add to the access policy: <code>integration-management:read</code>, <code>integration-management:write</code> and <code>stacks:read</code>.</li>
<li>Once done, you should see the scopes selected with checkboxes.</li>
</ol>

<p>Having created an Access Policy, you can now create a token that will be used to authenticate the provider to the Connections API. You can do so just after creating the access policy, following
the in-screen instructions, of following <a href="https://grafana.com/docs/grafana-cloud/account-management/authentication-and-permissions/access-policies/using-an-access-policy-token/#create-one-or-more-access-policy-tokens">this guide</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Obtaining%20Connections%20API%20hostname"></a><h4 id="obtaining-connections-api-hostname">Obtaining Connections API hostname</h4>

<p>Having created the token, we can find the correct Connections API hostname by running the following script, that requires <code>curl</code> and <a href="https://jqlang.org/"><code>jq</code></a> installed:</p>

<div class="codehilite"><pre><span></span><code>curl -sH <span class="s2">"Authorization: Bearer &lt;Access Token from previous step&gt;"</span> <span class="s2">"https://grafana.com/api/instances"</span> <span class="p">|</span> <span class="se">\</span>
  jq <span class="s1">'[.items[]|{stackName: .slug, clusterName:.clusterSlug, connectionsAPIURL: "https://connections-api-\(.clusterSlug).grafana.net"}]'</span>
</code></pre></div>

<p>This script will return a list of all the Grafana Cloud stacks you own, with the Connections API hostname for each one. Choose the correct hostname for the stack you want to manage.
For example, in the following response, the correct hostname for the <code>examplestackname</code> stack is <code>https://connections-api-prod-eu-west-0.grafana.net</code>.</p>

<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">"stackName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"examplestackname"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">"clusterName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"prod-eu-west-0"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">"connectionsAPIURL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://connections-api-prod-eu-west-0.grafana.net"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">]</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Configuring%20the%20Provider%20to%20use%20the%20Connections%20API"></a><h4 id="configuring-the-provider-to-use-the-connections-api">Configuring the Provider to use the Connections API</h4>

<p>Once you have the token and Connections API hostname, you can configure the provider as follows:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">connections_api_url</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;Connections API URL from previous step&gt;"</span><span class="w"></span>
<span class="w">  </span><span class="na">connections_api_access_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;Access Token from previous step&gt;"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Managing%20Grafana%20Fleet%20Management"></a><h3 id="managing-grafana-fleet-management">Managing Grafana Fleet Management</h3>

<div class="codehilite"><pre><span></span><code><span class="c1">// Variables</span>
<span class="kr">variable</span><span class="w"> </span><span class="nv">"cloud_access_policy_token"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cloud access policy token with scopes: accesspolicies:read|write|delete, stacks:read"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">"stack_slug"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Subdomain that the Grafana Cloud instance is available at: https://&lt;stack_slug&gt;.grafana.net"</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Step 1: Retrieve stack details</span>
<span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">alias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cloud"</span><span class="w"></span>

<span class="w">  </span><span class="na">cloud_access_policy_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.cloud_access_policy_token</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"grafana_cloud_stack"</span><span class="w"> </span><span class="nv">"stack"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.cloud</span><span class="w"></span>

<span class="w">  </span><span class="na">slug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.stack_slug</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Step 2: Create an access policy and token for Fleet Management</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_cloud_access_policy"</span><span class="w"> </span><span class="nv">"policy"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.cloud</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"fleet-management-policy"</span><span class="w"></span>
<span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.grafana_cloud_stack.stack.region_slug</span><span class="w"></span>

<span class="w">  </span><span class="na">scopes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="s2">"fleet-management:read"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"fleet-management:write"</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>

<span class="w">  </span><span class="nb">realm</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">type</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"stack"</span><span class="w"></span>
<span class="w">    </span><span class="na">identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.grafana_cloud_stack.stack.id</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_cloud_access_policy_token"</span><span class="w"> </span><span class="nv">"token"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.cloud</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">"fleet-management-token"</span><span class="w"></span>
<span class="w">  </span><span class="na">region</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_access_policy.policy.region</span><span class="w"></span>
<span class="w">  </span><span class="na">access_policy_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana_cloud_access_policy.policy.policy_id</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Step 3: Interact with Fleet Management</span>
<span class="kr">provider</span><span class="w"> </span><span class="nv">"grafana"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">alias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fm"</span><span class="w"></span>

<span class="w">  </span><span class="na">fleet_management_auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"${data.grafana_cloud_stack.stack.fleet_management_user_id}:${grafana_cloud_access_policy_token.token.token}"</span><span class="w"></span>
<span class="w">  </span><span class="na">fleet_management_url</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">data.grafana_cloud_stack.stack.fleet_management_url</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_fleet_management_collector"</span><span class="w"> </span><span class="nv">"collector"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.fm</span><span class="w"></span>

<span class="w">  </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"my_collector"</span><span class="w"></span>
<span class="w">  </span><span class="nb">remote_attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="s2">"env"</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"PROD"</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"owner"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"TEAM-A"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"grafana_fleet_management_pipeline"</span><span class="w"> </span><span class="nv">"pipeline"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">grafana.fm</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"my_pipeline"</span><span class="w"></span>
<span class="w">  </span><span class="na">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">file</span><span class="p">(</span><span class="s2">"config.alloy"</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="na">matchers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="s2">"collector.os=\"linux\""</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">"env=\"PROD\""</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Authentication"></a><h2 id="authentication">Authentication</h2>

<p>One, or many, of the following authentication settings must be set. Each authentication setting allows a subset of resources to be used</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/auth"></a><h3 id="auth"><code>auth</code></h3>

<p>This can be a Grafana API key, basic auth <code>username:password</code>, or a
<a href="https://grafana.com/docs/grafana/latest/developers/http_api/examples/create-api-tokens-for-org/">Grafana Service Account token</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/cloud_access_policy_token"></a><h3 id="cloud_access_policy_token"><code>cloud_access_policy_token</code></h3>

<p>An access policy token created on the <a href="https://grafana.com/docs/grafana-cloud/account-management/authentication-and-permissions/access-policies/using-an-access-policy-token/">Grafana Cloud Portal</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/sm_access_token"></a><h3 id="sm_access_token"><code>sm_access_token</code></h3>

<p><a href="https://grafana.com/docs/grafana-cloud/testing/synthetic-monitoring/">Grafana Synthetic Monitoring</a> uses distinct tokens for API access.
You can use the <code>grafana_synthetic_monitoring_installation</code> resource as shown above or you can request a new Synthetic Monitoring API key in Synthetics -&gt; Config page.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/oncall_access_token"></a><h3 id="oncall_access_token"><code>oncall_access_token</code></h3>

<p><a href="https://grafana.com/docs/oncall/latest/oncall-api-reference/">Grafana OnCall</a>
uses API keys to allow access to the API. You can request a new OnCall API key in OnCall -&gt; Settings page.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/cloud_provider_access_token"></a><h3 id="cloud_provider_access_token"><code>cloud_provider_access_token</code></h3>

<p>An access policy token created to manage <a href="https://grafana.com/docs/grafana-cloud/monitor-infrastructure/monitor-cloud-provider/">Grafana Cloud Provider Observability</a>.
To create one, follow the instructions in the <a href="#obtaining-cloud-provider-access-token">obtaining cloud provider access token section</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/connections_api_access_token"></a><h3 id="connections_api_access_token"><code>connections_api_access_token</code></h3>

<p>An access policy token created on the <a href="https://grafana.com/docs/grafana-cloud/account-management/authentication-and-permissions/access-policies/using-an-access-policy-token/">Grafana Cloud Portal</a> to manage
connections resources, such as Metrics Endpoint jobs.
For guidance on creating one, see section <a href="#obtaining-connections-access-token">obtaining connections access token</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/fleet_management_auth"></a><h3 id="fleet_management_auth"><code>fleet_management_auth</code></h3>

<p><a href="https://grafana.com/docs/grafana-cloud/send-data/fleet-management/api-reference/">Grafana Fleet Management</a>
uses basic auth to allow access to the API, where the username is the Fleet Management instance ID and the
password is the API token. You can access the instance ID and request a new Fleet Management API token on the
Connections -&gt; Collector -&gt; Fleet Management page, in the API tab.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/frontend_o11y_access_token"></a><h3 id="frontend_o11y_access_token"><code>frontend_o11y_access_token</code></h3>

<p>An access policy token created on the <a href="https://grafana.com/docs/grafana-cloud/security-and-account-management/authentication-and-permissions/access-policies/">Grafana Cloud Portal</a> to manage Frontend Observability apps.
For guidance on creating one, see section <a href="#obtaining-frontend-observability-access-token">obtaining Frontend Observability access token</a>.</p>

            
        
    </body></html>