<html><!-- Online page at https://registry.terraform.io/providers/aliyun/alicloud/latest/docs/resources/emr_cluster --><head>
                <title>alicloud_emr_cluster</title>
                <meta charset="utf-8"/>
                <link href="../../../../../../style.css" rel="stylesheet"/>
            </head>
            <body>
                <h1 id="alicloud_emr_cluster">alicloud_emr_cluster</h1>

<p>Provides a EMR Cluster resource. With this you can create, read, and release  EMR Cluster. </p>

<aside class="admonition note">
    <strong>note</strong>
    <em>DEPRECATED</em>
    <p>This resource has been deprecated from version <code>1.204.0</code>. Please use new resource <a href="https://registry.terraform.io/providers/aliyun/alicloud/latest/docs/resources/emrv2_cluster">emrv2_cluster</a>.</p>
</aside>

<aside class="admonition note">
    <strong>note</strong>
    <em>note</em>
    <p>Available in 1.57.0+.</p>
</aside>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Example%20Usage"></a><h2 id="example-usage">Example Usage</h2>

<a class="dashAnchor" name="//apple_ref/cpp/Section/1.%20Create%20A%20Cluster"></a><h4 id="1-create-a-cluster">1. Create A Cluster</h4>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_main_versions"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_instance_types"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"InstanceType"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">support_local_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">support_node_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"MASTER", "CORE", "TASK"</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_disk_types"</span><span class="w"> </span><span class="nv">"data_disk"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"DataDisk"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_disk_types"</span><span class="w"> </span><span class="nv">"system_disk"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SystemDisk"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_vpc"</span><span class="w"> </span><span class="nv">"vpc"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_name</span><span class="w"></span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_cidr</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_security_group"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_name</span><span class="w"></span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vpc.vpc[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// VSwitch Resource for Module</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_vswitch"</span><span class="w"> </span><span class="nv">"vswitch"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">availability_zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.availability_zone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.availability_zone</span><span class="w"></span>
<span class="w">  </span><span class="na">vswitch_name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_name</span><span class="w"></span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_cidr</span><span class="w"></span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vpc.vpc[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Ram role Resource for Module</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_ram_role"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">var.ram_name</span><span class="w"></span>
<span class="w">  </span><span class="na">document</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="dl">EOF</span><span class="sh"></span>
<span class="err">    {</span>
<span class="err">        "Statement": [</span>
<span class="err">        {</span>
<span class="err">            "Action": "sts:AssumeRole",</span>
<span class="err">            "Effect": "Allow",</span>
<span class="err">            "Principal": {</span>
<span class="err">            "Service": [</span>
<span class="err">                "emr.aliyuncs.com",</span>
<span class="err">                "ecs.aliyuncs.com"</span>
<span class="err">            ]</span>
<span class="err">            }</span>
<span class="err">        }</span>
<span class="err">        ],</span>
<span class="err">        "Version": "1"</span>
<span class="err">    }</span>
<span class="err">    EOF</span>
<span class="err">  description = "this is a role test."</span>
<span class="err">  force       = true</span>
<span class="err">}</span>

<span class="err">resource "alicloud_emr_cluster" "default" {</span>
<span class="err">  name = "terraform-create-cluster-test"</span>

<span class="err">  emr_ver = data.alicloud_emr_main_versions.default.main_versions.0.emr_version</span>

<span class="err">  cluster_type = data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span>

<span class="err">  host_group {</span>
<span class="err">    host_group_name   = "master_group"</span>
<span class="err">    host_group_type   = "MASTER"</span>
<span class="err">    node_count        = "2"</span>
<span class="err">    instance_type     = data.alicloud_emr_instance_types.default.types.0.id</span>
<span class="err">    disk_type         = data.alicloud_emr_disk_types.data_disk.types.0.value</span>
<span class="err">    disk_capacity     = data.alicloud_emr_disk_types.data_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.data_disk.types.0.min : 160</span>
<span class="err">    disk_count        = "1"</span>
<span class="err">    sys_disk_type     = data.alicloud_emr_disk_types.system_disk.types.0.value</span>
<span class="err">    sys_disk_capacity = data.alicloud_emr_disk_types.system_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.system_disk.types.0.min : 160</span>
<span class="err">  }</span>

<span class="err">  host_group {</span>
<span class="err">    host_group_name   = "core_group"</span>
<span class="err">    host_group_type   = "CORE"</span>
<span class="err">    node_count        = "3"</span>
<span class="err">    instance_type     = data.alicloud_emr_instance_types.default.types.0.id</span>
<span class="err">    disk_type         = data.alicloud_emr_disk_types.data_disk.types.0.value</span>
<span class="err">    disk_capacity     = data.alicloud_emr_disk_types.data_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.data_disk.types.0.min : 160</span>
<span class="err">    disk_count        = "4"</span>
<span class="err">    sys_disk_type     = data.alicloud_emr_disk_types.system_disk.types.0.value</span>
<span class="err">    sys_disk_capacity = data.alicloud_emr_disk_types.system_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.system_disk.types.0.min : 160</span>
<span class="err">  }</span>

<span class="err">  host_group {</span>
<span class="err">    host_group_name   = "task_group"</span>
<span class="err">    host_group_type   = "TASK"</span>
<span class="err">    node_count        = "2"</span>
<span class="err">    instance_type     = data.alicloud_emr_instance_types.default.types.0.id</span>
<span class="err">    disk_type         = data.alicloud_emr_disk_types.data_disk.types.0.value</span>
<span class="err">    disk_capacity     = data.alicloud_emr_disk_types.data_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.data_disk.types.0.min : 160</span>
<span class="err">    disk_count        = "4"</span>
<span class="err">    sys_disk_type     = data.alicloud_emr_disk_types.system_disk.types.0.value</span>
<span class="err">    sys_disk_capacity = data.alicloud_emr_disk_types.system_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.system_disk.types.0.min : 160</span>
<span class="err">  }</span>

<span class="err">  high_availability_enable  = true</span>
<span class="err">  zone_id                   = data.alicloud_emr_instance_types.default.types.0.zone_id</span>
<span class="err">  security_group_id         = var.security_group_id == "" ? alicloud_security_group.default[0].id : var.security_group_id</span>
<span class="err">  is_open_public_ip         = true</span>
<span class="err">  charge_type               = "PostPaid"</span>
<span class="err">  vswitch_id                = var.vswitch_id == "" ? alicloud_vswitch.vswitch[0].id : var.vswitch_id</span>
<span class="err">  user_defined_emr_ecs_role = alicloud_ram_role.default.name</span>
<span class="err">  ssh_enable                = true</span>
<span class="err">  master_pwd                = "ABCtest1234!"</span>
<span class="err">}</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">"Statement"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Action"</span><span class="o">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Effect"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Principal"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Service"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">                </span><span class="s2">"emr.aliyuncs.com"</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s2">"ecs.aliyuncs.com"</span><span class="w"></span>
<span class="w">            </span><span class="p">]</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="s2">"Version"</span><span class="o">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="err">EOF</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"this is a role test."</span><span class="w"></span>
<span class="w">  </span><span class="na">force</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_emr_cluster"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"terraform-create-cluster-test"</span><span class="w"></span>

<span class="w">  </span><span class="na">emr_ver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.emr_version</span><span class="w"></span>

<span class="w">  </span><span class="na">cluster_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>

<span class="w">  </span><span class="nb">host_group</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"master_group"</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"MASTER"</span><span class="w"></span>
<span class="w">    </span><span class="na">node_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"2"</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_capacity</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"1"</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">host_group</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"core_group"</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"CORE"</span><span class="w"></span>
<span class="w">    </span><span class="na">node_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"3"</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_capacity</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"4"</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">host_group</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"task_group"</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"TASK"</span><span class="w"></span>
<span class="w">    </span><span class="na">node_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"2"</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_capacity</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"4"</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="na">high_availability_enable</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="w">  </span><span class="na">security_group_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_security_group.default[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"></span>
<span class="w">  </span><span class="na">is_open_public_ip</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">charge_type</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">vswitch_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vswitch.vswitch[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"></span>
<span class="w">  </span><span class="na">user_defined_emr_ecs_role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">alicloud_ram_role.default.name</span><span class="w"></span>
<span class="w">  </span><span class="na">ssh_enable</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">master_pwd</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"ABCtest1234!"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/2.%20Scale%20Up"></a><h4 id="2-scale-up">2. Scale Up</h4>

<p>The hosts of EMR Cluster are orginized as host group. Scaling up/down is operating host group. </p>

<p>In the case of scaling up cluster, we should add the node_count of some host group. </p>

<aside class="admonition note">
    <strong>note</strong>
    <em>note</em>
    <p>Scaling up is only applicable to CORE and TASK group. Cost time of scaling up will vary with the number of scaling-up nodes. Scaling down is only applicable to TASK group. If you want to scale down CORE group, please submit tickets or contact EMR support team.</p>
</aside>

<p>As the following case, we scale up the TASK group 2 nodes by increasing host_group.node_count by 2.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_main_versions"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_instance_types"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"InstanceType"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">support_local_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">support_node_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"MASTER", "CORE", "TASK"</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_disk_types"</span><span class="w"> </span><span class="nv">"data_disk"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"DataDisk"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_disk_types"</span><span class="w"> </span><span class="nv">"system_disk"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SystemDisk"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_vpc"</span><span class="w"> </span><span class="nv">"vpc"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_name</span><span class="w"></span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_cidr</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_security_group"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_name</span><span class="w"></span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vpc.vpc[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// VSwitch Resource for Module</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_vswitch"</span><span class="w"> </span><span class="nv">"vswitch"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">availability_zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.availability_zone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.availability_zone</span><span class="w"></span>
<span class="w">  </span><span class="na">vswitch_name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_name</span><span class="w"></span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_cidr</span><span class="w"></span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vpc.vpc[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Ram role Resource for Module</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_ram_role"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">var.ram_name</span><span class="w"></span>
<span class="w">  </span><span class="na">document</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="dl">EOF</span><span class="sh"></span>
<span class="err">    {</span>
<span class="err">        "Statement": [</span>
<span class="err">        {</span>
<span class="err">            "Action": "sts:AssumeRole",</span>
<span class="err">            "Effect": "Allow",</span>
<span class="err">            "Principal": {</span>
<span class="err">            "Service": [</span>
<span class="err">                "emr.aliyuncs.com",</span>
<span class="err">                "ecs.aliyuncs.com"</span>
<span class="err">            ]</span>
<span class="err">            }</span>
<span class="err">        }</span>
<span class="err">        ],</span>
<span class="err">        "Version": "1"</span>
<span class="err">    }</span>
<span class="err">    EOF</span>
<span class="err">  description = "this is a role test."</span>
<span class="err">  force       = true</span>
<span class="err">}</span>

<span class="err">resource "alicloud_emr_cluster" "default" {</span>
<span class="err">  name = "terraform-resize-cluster-test"</span>

<span class="err">  emr_ver = data.alicloud_emr_main_versions.default.main_versions.0.emr_version</span>

<span class="err">  cluster_type = data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span>

<span class="err">  host_group {</span>
<span class="err">    host_group_name   = "master_group"</span>
<span class="err">    host_group_type   = "MASTER"</span>
<span class="err">    node_count        = "2"</span>
<span class="err">    instance_type     = data.alicloud_emr_instance_types.default.types.0.id</span>
<span class="err">    disk_type         = data.alicloud_emr_disk_types.data_disk.types.0.value</span>
<span class="err">    disk_capacity     = data.alicloud_emr_disk_types.data_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.data_disk.types.0.min : 160</span>
<span class="err">    disk_count        = "1"</span>
<span class="err">    sys_disk_type     = data.alicloud_emr_disk_types.system_disk.types.0.value</span>
<span class="err">    sys_disk_capacity = data.alicloud_emr_disk_types.system_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.system_disk.types.0.min : 160</span>
<span class="err">  }</span>

<span class="err">  host_group {</span>
<span class="err">    host_group_name   = "core_group"</span>
<span class="err">    host_group_type   = "CORE"</span>
<span class="err">    node_count        = "3"</span>
<span class="err">    instance_type     = data.alicloud_emr_instance_types.default.types.0.id</span>
<span class="err">    disk_type         = data.alicloud_emr_disk_types.data_disk.types.0.value</span>
<span class="err">    disk_capacity     = data.alicloud_emr_disk_types.data_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.data_disk.types.0.min : 160</span>
<span class="err">    disk_count        = "4"</span>
<span class="err">    sys_disk_type     = data.alicloud_emr_disk_types.system_disk.types.0.value</span>
<span class="err">    sys_disk_capacity = data.alicloud_emr_disk_types.system_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.system_disk.types.0.min : 160</span>
<span class="err">  }</span>

<span class="err">  host_group {</span>
<span class="err">    host_group_name   = "task_group"</span>
<span class="err">    host_group_type   = "TASK"</span>
<span class="err">    node_count        = "4"</span>
<span class="err">    instance_type     = data.alicloud_emr_instance_types.default.types.0.id</span>
<span class="err">    disk_type         = data.alicloud_emr_disk_types.data_disk.types.0.value</span>
<span class="err">    disk_capacity     = data.alicloud_emr_disk_types.data_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.data_disk.types.0.min : 160</span>
<span class="err">    disk_count        = "4"</span>
<span class="err">    sys_disk_type     = data.alicloud_emr_disk_types.system_disk.types.0.value</span>
<span class="err">    sys_disk_capacity = data.alicloud_emr_disk_types.system_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.system_disk.types.0.min : 160</span>
<span class="err">  }</span>

<span class="err">  high_availability_enable  = true</span>
<span class="err">  zone_id                   = data.alicloud_emr_instance_types.default.types.0.zone_id</span>
<span class="err">  security_group_id         = var.security_group_id == "" ? alicloud_security_group.default[0].id : var.security_group_id</span>
<span class="err">  is_open_public_ip         = true</span>
<span class="err">  charge_type               = "PostPaid"</span>
<span class="err">  vswitch_id                = var.vswitch_id == "" ? alicloud_vswitch.vswitch[0].id : var.vswitch_id</span>
<span class="err">  user_defined_emr_ecs_role = alicloud_ram_role.default.name</span>
<span class="err">  ssh_enable                = true</span>
<span class="err">  master_pwd                = "ABCtest1234!"</span>
<span class="err">}</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">"Statement"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Action"</span><span class="o">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Effect"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Principal"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Service"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">                </span><span class="s2">"emr.aliyuncs.com"</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s2">"ecs.aliyuncs.com"</span><span class="w"></span>
<span class="w">            </span><span class="p">]</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="s2">"Version"</span><span class="o">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="err">EOF</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"this is a role test."</span><span class="w"></span>
<span class="w">  </span><span class="na">force</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_emr_cluster"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"terraform-resize-cluster-test"</span><span class="w"></span>

<span class="w">  </span><span class="na">emr_ver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.emr_version</span><span class="w"></span>

<span class="w">  </span><span class="na">cluster_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>

<span class="w">  </span><span class="nb">host_group</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"master_group"</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"MASTER"</span><span class="w"></span>
<span class="w">    </span><span class="na">node_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"2"</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_capacity</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"1"</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">host_group</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"core_group"</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"CORE"</span><span class="w"></span>
<span class="w">    </span><span class="na">node_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"3"</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_capacity</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"4"</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">host_group</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"task_group"</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"TASK"</span><span class="w"></span>
<span class="w">    </span><span class="na">node_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"4"</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_capacity</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"4"</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="na">high_availability_enable</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="w">  </span><span class="na">security_group_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_security_group.default[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"></span>
<span class="w">  </span><span class="na">is_open_public_ip</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">charge_type</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">vswitch_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vswitch.vswitch[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"></span>
<span class="w">  </span><span class="na">user_defined_emr_ecs_role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">alicloud_ram_role.default.name</span><span class="w"></span>
<span class="w">  </span><span class="na">ssh_enable</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">master_pwd</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"ABCtest1234!"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/3.%20Scale%20Down"></a><h4 id="3-scale-down">3. Scale Down</h4>

<p>In the case of scaling down a cluster, we need to specified the host group and the instance list. </p>

<aside class="admonition note">
    <strong>note</strong>
    <em>note</em>
    <p>Graceful decommission of hadoop cluster has been supported Available in 1.168.0+.</p>
</aside>

<p>The following is an example. We scale down the cluster by decreasing the node count by 2, and specifying the scale-down instance list.</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_main_versions"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_instance_types"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"InstanceType"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">support_local_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">support_node_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"MASTER", "CORE", "TASK"</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_disk_types"</span><span class="w"> </span><span class="nv">"data_disk"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"DataDisk"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_disk_types"</span><span class="w"> </span><span class="nv">"system_disk"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SystemDisk"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_vpc"</span><span class="w"> </span><span class="nv">"vpc"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_name</span><span class="w"></span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_cidr</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_security_group"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_name</span><span class="w"></span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vpc.vpc[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// VSwitch Resource for Module</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_vswitch"</span><span class="w"> </span><span class="nv">"vswitch"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">availability_zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.availability_zone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.availability_zone</span><span class="w"></span>
<span class="w">  </span><span class="na">vswitch_name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_name</span><span class="w"></span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_cidr</span><span class="w"></span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vpc.vpc[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Ram role Resource for Module</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_ram_role"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">var.ram_name</span><span class="w"></span>
<span class="w">  </span><span class="na">document</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="dl">EOF</span><span class="sh"></span>
<span class="err">    {</span>
<span class="err">        "Statement": [</span>
<span class="err">        {</span>
<span class="err">            "Action": "sts:AssumeRole",</span>
<span class="err">            "Effect": "Allow",</span>
<span class="err">            "Principal": {</span>
<span class="err">            "Service": [</span>
<span class="err">                "emr.aliyuncs.com",</span>
<span class="err">                "ecs.aliyuncs.com"</span>
<span class="err">            ]</span>
<span class="err">            }</span>
<span class="err">        }</span>
<span class="err">        ],</span>
<span class="err">        "Version": "1"</span>
<span class="err">    }</span>
<span class="err">    EOF</span>
<span class="err">  description = "this is a role test."</span>
<span class="err">  force       = true</span>
<span class="err">}</span>

<span class="err">resource "alicloud_emr_cluster" "default" {</span>
<span class="err">  name = "terraform-resize-cluster-test"</span>

<span class="err">  emr_ver = data.alicloud_emr_main_versions.default.main_versions.0.emr_version</span>

<span class="err">  cluster_type = data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span>

<span class="err">  host_group {</span>
<span class="err">    host_group_name   = "master_group"</span>
<span class="err">    host_group_type   = "MASTER"</span>
<span class="err">    node_count        = "2"</span>
<span class="err">    instance_type     = data.alicloud_emr_instance_types.default.types.0.id</span>
<span class="err">    disk_type         = data.alicloud_emr_disk_types.data_disk.types.0.value</span>
<span class="err">    disk_capacity     = data.alicloud_emr_disk_types.data_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.data_disk.types.0.min : 160</span>
<span class="err">    disk_count        = "1"</span>
<span class="err">    sys_disk_type     = data.alicloud_emr_disk_types.system_disk.types.0.value</span>
<span class="err">    sys_disk_capacity = data.alicloud_emr_disk_types.system_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.system_disk.types.0.min : 160</span>
<span class="err">  }</span>

<span class="err">  host_group {</span>
<span class="err">    host_group_name   = "core_group"</span>
<span class="err">    host_group_type   = "CORE"</span>
<span class="err">    node_count        = "3"</span>
<span class="err">    instance_type     = data.alicloud_emr_instance_types.default.types.0.id</span>
<span class="err">    disk_type         = data.alicloud_emr_disk_types.data_disk.types.0.value</span>
<span class="err">    disk_capacity     = data.alicloud_emr_disk_types.data_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.data_disk.types.0.min : 160</span>
<span class="err">    disk_count        = "4"</span>
<span class="err">    sys_disk_type     = data.alicloud_emr_disk_types.system_disk.types.0.value</span>
<span class="err">    sys_disk_capacity = data.alicloud_emr_disk_types.system_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.system_disk.types.0.min : 160</span>
<span class="err">  }</span>

<span class="err">  host_group {</span>
<span class="err">    host_group_name   = "task_group"</span>
<span class="err">    host_group_type   = "TASK"</span>
<span class="err">    node_count        = "2"</span>
<span class="err">    instance_type     = data.alicloud_emr_instance_types.default.types.0.id</span>
<span class="err">    disk_type         = data.alicloud_emr_disk_types.data_disk.types.0.value</span>
<span class="err">    disk_capacity     = data.alicloud_emr_disk_types.data_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.data_disk.types.0.min : 160</span>
<span class="err">    disk_count        = "4"</span>
<span class="err">    sys_disk_type     = data.alicloud_emr_disk_types.system_disk.types.0.value</span>
<span class="err">    sys_disk_capacity = data.alicloud_emr_disk_types.system_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.system_disk.types.0.min : 160</span>
<span class="err">  }</span>

<span class="err">  high_availability_enable  = true</span>
<span class="err">  zone_id                   = data.alicloud_emr_instance_types.default.types.0.zone_id</span>
<span class="err">  security_group_id         = var.security_group_id == "" ? alicloud_security_group.default[0].id : var.security_group_id</span>
<span class="err">  is_open_public_ip         = true</span>
<span class="err">  charge_type               = "PostPaid"</span>
<span class="err">  vswitch_id                = var.vswitch_id == "" ? alicloud_vswitch.vswitch[0].id : var.vswitch_id</span>
<span class="err">  user_defined_emr_ecs_role = alicloud_ram_role.default.name</span>
<span class="err">  ssh_enable                = true</span>
<span class="err">  master_pwd                = "ABCtest1234!"</span>
<span class="err">}</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">"Statement"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Action"</span><span class="o">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Effect"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Principal"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Service"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">                </span><span class="s2">"emr.aliyuncs.com"</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s2">"ecs.aliyuncs.com"</span><span class="w"></span>
<span class="w">            </span><span class="p">]</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="s2">"Version"</span><span class="o">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="err">EOF</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"this is a role test."</span><span class="w"></span>
<span class="w">  </span><span class="na">force</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_emr_cluster"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"terraform-resize-cluster-test"</span><span class="w"></span>

<span class="w">  </span><span class="na">emr_ver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.emr_version</span><span class="w"></span>

<span class="w">  </span><span class="na">cluster_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>

<span class="w">  </span><span class="nb">host_group</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"master_group"</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"MASTER"</span><span class="w"></span>
<span class="w">    </span><span class="na">node_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"2"</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_capacity</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"1"</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">host_group</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"core_group"</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"CORE"</span><span class="w"></span>
<span class="w">    </span><span class="na">node_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"3"</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_capacity</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"4"</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nb">host_group</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"task_group"</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"TASK"</span><span class="w"></span>
<span class="w">    </span><span class="na">node_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"2"</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_capacity</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"4"</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="na">high_availability_enable</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="w">  </span><span class="na">security_group_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_security_group.default[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"></span>
<span class="w">  </span><span class="na">is_open_public_ip</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">charge_type</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">vswitch_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vswitch.vswitch[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"></span>
<span class="w">  </span><span class="na">user_defined_emr_ecs_role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">alicloud_ram_role.default.name</span><span class="w"></span>
<span class="w">  </span><span class="na">ssh_enable</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">master_pwd</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"ABCtest1234!"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/4.%20Create%20a%20emr%20gateway%20cluster"></a><h4 id="4-create-a-emr-gateway-cluster">4. Create a emr gateway cluster</h4>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_main_versions"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_instance_types"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"InstanceType"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">support_local_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">support_node_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"GATEWAY"</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_disk_types"</span><span class="w"> </span><span class="nv">"data_disk"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"DataDisk"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="nc">"alicloud_emr_disk_types"</span><span class="w"> </span><span class="nv">"system_disk"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">destination_resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SystemDisk"</span><span class="w"></span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.cluster_types.0</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_charge_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">instance_type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_vpc"</span><span class="w"> </span><span class="nv">"vpc"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_name</span><span class="w"></span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_cidr</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_security_group"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_name</span><span class="w"></span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vpc.vpc[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// VSwitch Resource for Module</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_vswitch"</span><span class="w"> </span><span class="nv">"vswitch"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"></span>

<span class="w">  </span><span class="na">availability_zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.availability_zone</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.availability_zone</span><span class="w"></span>
<span class="w">  </span><span class="na">vswitch_name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_name</span><span class="w"></span>
<span class="w">  </span><span class="na">cidr_block</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_cidr</span><span class="w"></span>
<span class="w">  </span><span class="na">vpc_id</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vpc.vpc[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vpc_id</span><span class="w"></span>
<span class="p">}</span><span class="c1"></span>

<span class="c1">// Ram role Resource for Module</span>
<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_ram_role"</span><span class="w"> </span><span class="nv">"default"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">var.ram_name</span><span class="w"></span>
<span class="w">  </span><span class="na">document</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="dl">EOF</span><span class="sh"></span>
<span class="err">    {</span>
<span class="err">        "Statement": [</span>
<span class="err">        {</span>
<span class="err">            "Action": "sts:AssumeRole",</span>
<span class="err">            "Effect": "Allow",</span>
<span class="err">            "Principal": {</span>
<span class="err">            "Service": [</span>
<span class="err">                "emr.aliyuncs.com",</span>
<span class="err">                "ecs.aliyuncs.com"</span>
<span class="err">            ]</span>
<span class="err">            }</span>
<span class="err">        }</span>
<span class="err">        ],</span>
<span class="err">        "Version": "1"</span>
<span class="err">    }</span>
<span class="err">    EOF</span>
<span class="err">  description = "this is a role test."</span>
<span class="err">  force       = true</span>
<span class="err">}</span>

<span class="err">resource "alicloud_emr_cluster" "gateway" {</span>
<span class="err">  name = "terraform-gateway-cluster-test"</span>

<span class="err">  emr_ver = data.alicloud_emr_main_versions.default.main_versions.0.emr_version</span>

<span class="err">  # supported 'GATEWAY' available in 1.61.0+.</span>
<span class="err">  cluster_type = "GATEWAY"</span>

<span class="err">  host_group {</span>
<span class="err">    host_group_name   = "master_group"</span>
<span class="err">    host_group_type   = "GATEWAY"</span>
<span class="err">    node_count        = "1"</span>
<span class="err">    instance_type     = data.alicloud_emr_instance_types.default.types.0.id</span>
<span class="err">    disk_type         = data.alicloud_emr_disk_types.data_disk.types.0.value</span>
<span class="err">    disk_capacity     = data.alicloud_emr_disk_types.data_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.data_disk.types.0.min : 160</span>
<span class="err">    disk_count        = "1"</span>
<span class="err">    sys_disk_type     = data.alicloud_emr_disk_types.system_disk.types.0.value</span>
<span class="err">    sys_disk_capacity = data.alicloud_emr_disk_types.system_disk.types.0.min &gt; 160 ? data.alicloud_emr_disk_types.system_disk.types.0.min : 160</span>
<span class="err">  }</span>

<span class="err">  high_availability_enable  = true</span>
<span class="err">  zone_id                   = data.alicloud_emr_instance_types.default.types.0.zone_id</span>
<span class="err">  security_group_id         = var.security_group_id == "" ? alicloud_security_group.default[0].id : var.security_group_id</span>
<span class="err">  is_open_public_ip         = true</span>
<span class="err">  charge_type               = "PostPaid"</span>
<span class="err">  vswitch_id                = var.vswitch_id == "" ? alicloud_vswitch.vswitch[0].id : var.vswitch_id</span>
<span class="err">  user_defined_emr_ecs_role = alicloud_ram_role.default.name</span>
<span class="err">  ssh_enable                = true</span>
<span class="err">  master_pwd                = "ABCtest1234!"</span>

<span class="err">  // the gateway related emr cluster id, if you want to bind a cluster dynamically, please refer to the examples.</span>
<span class="err">  related_cluster_id = related_cluster_id</span>
<span class="err">}</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">"Statement"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Action"</span><span class="o">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Effect"</span><span class="o">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Principal"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">"Service"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">                </span><span class="s2">"emr.aliyuncs.com"</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s2">"ecs.aliyuncs.com"</span><span class="w"></span>
<span class="w">            </span><span class="p">]</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="s2">"Version"</span><span class="o">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="err">EOF</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"this is a role test."</span><span class="w"></span>
<span class="w">  </span><span class="na">force</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">"alicloud_emr_cluster"</span><span class="w"> </span><span class="nv">"gateway"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"terraform-gateway-cluster-test"</span><span class="w"></span>

<span class="w">  </span><span class="na">emr_ver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_main_versions.default.main_versions.0.emr_version</span><span class="c1"></span>

<span class="c1">  # supported 'GATEWAY' available in 1.61.0+.</span>
<span class="w">  </span><span class="na">cluster_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GATEWAY"</span><span class="w"></span>

<span class="w">  </span><span class="nb">host_group</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"master_group"</span><span class="w"></span>
<span class="w">    </span><span class="na">host_group_type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"GATEWAY"</span><span class="w"></span>
<span class="w">    </span><span class="na">node_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"1"</span><span class="w"></span>
<span class="w">    </span><span class="na">instance_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.id</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_type</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_capacity</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.data_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">    </span><span class="na">disk_count</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"1"</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_type</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.value</span><span class="w"></span>
<span class="w">    </span><span class="na">sys_disk_capacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">160</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">data.alicloud_emr_disk_types.system_disk.types.0.min</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m">160</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="na">high_availability_enable</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">zone_id</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">data.alicloud_emr_instance_types.default.types.0.zone_id</span><span class="w"></span>
<span class="w">  </span><span class="na">security_group_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_security_group.default[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.security_group_id</span><span class="w"></span>
<span class="w">  </span><span class="na">is_open_public_ip</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">charge_type</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">"PostPaid"</span><span class="w"></span>
<span class="w">  </span><span class="na">vswitch_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">alicloud_vswitch.vswitch[0].id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">var.vswitch_id</span><span class="w"></span>
<span class="w">  </span><span class="na">user_defined_emr_ecs_role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">alicloud_ram_role.default.name</span><span class="w"></span>
<span class="w">  </span><span class="na">ssh_enable</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="w">  </span><span class="na">master_pwd</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">"ABCtest1234!"</span><span class="c1"></span>

<span class="c1">  // the gateway related emr cluster id, if you want to bind a cluster dynamically, please refer to the examples.</span>
<span class="w">  </span><span class="na">related_cluster_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">related_cluster_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Argument%20Reference"></a><h2 id="argument-reference">Argument Reference</h2>

<p>The following arguments are supported:</p>

<ul>
<li><code>name</code> - (Required) The name of emr cluster. The name length must be less than 64. Supported characters: chinese character, english character, number, "-", "_".</li>
<li><code>emr_ver</code> - (Required, ForceNew) EMR Version, e.g. EMR-3.22.0. You can find the all valid EMR Version in emr web console.</li>
<li><code>cluster_type</code> - (Required, ForceNew) EMR Cluster Type, e.g. HADOOP, KAFKA, DRUID, GATEWAY etc. You can find all valid EMR cluster type in emr web console. Supported 'GATEWAY' available in 1.61.0+.</li>
<li><code>charge_type</code> - (Required, ForceNew) Charge Type for this cluster. Supported value: PostPaid or PrePaid. Default value: PostPaid.</li>
<li><code>zone_id</code> - (Required, ForceNew) Zone ID, e.g. cn-huhehaote-a</li>
<li><code>security_group_id</code> (Optional, ForceNew) Security Group ID for Cluster, you can also specify this key for each host group.</li>
<li><code>vswitch_id</code> (Optional, ForceNew) Global vswitch id, you can also specify it in host group.</li>
<li><code>option_software_list</code> (Optional, ForceNew) Optional software list.</li>
<li><code>high_availability_enable</code> (Optional, ForceNew) High Available for HDFS and YARN. If this is set true, MASTER group must have two nodes.</li>
<li><code>use_local_metadb</code> (Optional, ForceNew) Use local metadb. Default is false.</li>
<li><code>ssh_enable</code> (Optional, ForceNew) If this is set true, we can ssh into cluster. Default value is false.</li>
<li><code>master_pwd</code> (Optional, ForceNew) Master ssh password.</li>
<li><code>eas_enable</code> (Optional, ForceNew) High security cluster (true) or not. Default value is false.</li>
<li><code>user_defined_emr_ecs_role</code> (Optional, ForceNew) Alicloud EMR uses roles to perform actions on your behalf when provisioning cluster resources, running applications, dynamically scaling resources. EMR uses the following roles when interacting with other Alicloud services. Default value is AliyunEmrEcsDefaultRole.</li>
<li><code>key_pair_name</code> (Optional, ForceNew) Ssh key pair.</li>
<li><code>deposit_type</code> (Optional, ForceNew) Cluster deposit type, HALF_MANAGED or FULL_MANAGED.</li>
<li><code>related_cluster_id</code> (Optional, ForceNew) This specify the related cluster id, if this cluster is a Gateway.</li>
<li><code>host_group</code> - (Optional) Groups of Host, You can specify MASTER as a group, CORE as a group (just like the above example).</li>
<li><code>tags</code> - (Optional, Available in v1.67.0+) A mapping of tags to assign to the resource.</li>
<li><code>period</code> - (Optional, Available in v1.101.0+) If charge type is PrePaid, this should be specified, unit is month. Supported value: 1、2、3、4、5、6、7、8、9、12、24、36.</li>
<li><code>is_open_public_ip</code> (Optional, ForceNew) Whether the MASTER node has a public IP address enabled. Default value is false.</li>
<li><code>bootstrap_action</code> (Optional) Boot action parameters.</li>
<li><code>resource_group_id</code> - (Optional, Available in 1.182.0+) The Id of resource group which the emr-cluster belongs.</li>
<li><code>meta_store_type</code> - (Optional, Available in 1.182.0+) The type of emr-cluster service component metadata storage. ’dlf’ or ’local’ or ’user_rds’ .</li>
<li><code>meta_store_conf</code> - (Optional, Available in 1.182.0+) The configuration of emr-cluster service component metadata storage. If meta store type is ’user_rds’, this should be specified.</li>
<li><code>configs</code> - (Optional, Available in 1.182.0+) The custom configurations of emr-cluster service.</li>
<li><code>modify_cluster_service_config</code> - (Optional, Available in 1.182.0+) The configurations of emr-cluster service modification after cluster created.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Block%20host_group"></a><h4 id="block-host_group">Block host_group</h4>

<p>The host_group mapping supports the following: </p>

<ul>
<li><code>host_group_name</code> - (Required, ForceNew) host group name.</li>
<li><code>host_group_type</code> - (Required) host group type, supported value: MASTER, CORE or TASK, supported 'GATEWAY' available in 1.61.0+.</li>
<li><code>charge_type</code> - (Optional) Charge Type for this group of hosts: PostPaid or PrePaid. If this is not specified, charge type will follow global charge_type value.</li>
<li><code>period</code> - (Optional) If charge type is PrePaid, this should be specified, unit is month. Supported value: 1、2、3、4、5、6、7、8、9、12、24、36.</li>
<li><code>node_count</code> - (Required) Host number in this group.</li>
<li><code>instance_type</code> - (Required) Host Ecs instance type.</li>
<li><code>disk_type</code> - (Required) Data disk type. Supported value: cloud,cloud_efficiency,cloud_ssd,local_disk,cloud_essd.</li>
<li><code>disk_capacity</code> - (Required) Data disk capacity.</li>
<li><code>disk_count</code> - (Required) Data disk count.</li>
<li><code>sys_disk_type</code> - (Required) System disk type. Supported value: cloud,cloud_efficiency,cloud_ssd,cloud_essd.</li>
<li><code>sys_disk_capacity</code> - (Required) System disk capacity.</li>
<li><code>auto_renew</code> - (Optional) Auto renew for prepaid, ’true’ or ‘false’ . Default value: false.</li>
<li><code>instance_list</code> - (Optional) Instance list for cluster scale down. This value follows the json format, e.g. ["instance_id1","instance_id2"]. escape character for " is \".</li>
<li><code>enable_graceful_decommission</code> - (Optional, Available in 1.168.0+) Enable hadoop cluster of task node graceful decommission, ’true’ or ‘false’ . Default value: false.</li>
<li><code>decommission_timeout</code> - (Optional, Available in 1.168.0+) Graceful decommission timeout, unit: seconds.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Block%20bootstrap_action"></a><h4 id="block-bootstrap_action">Block bootstrap_action</h4>

<p>The bootstrap_action mapping supports the following:</p>

<ul>
<li><code>name</code> - (Optional, Available in 1.71.2+) bootstrap action name.</li>
<li><code>path</code> - (Optional, Available in 1.71.2+) bootstrap action path, e.g. "oss://bucket/path".</li>
<li><code>arg</code> - (Optional, Available in 1.71.2+) bootstrap action args, e.g. "--a=b".</li>
<li><code>execution_target</code> - (Optional, Available in 1.173.0+) bootstrap action execution target, you can specify the host group name, e.g. "core_group". If this is not specified, the bootstrap action execution target is whole cluster.</li>
<li><code>execution_moment</code> - (Optional, Available in 1.173.0+) bootstrap action execution moment, ’BEFORE_INSTALL’ or ‘AFTER_STARTED’ . Default value: "BEFORE_INSTALL".</li>
<li><code>execution_fail_strategy</code> - (Optional, Available in 1.173.0+) bootstrap action execution fail strategy, ’FAILED_BLOCKED’ or ‘FAILED_CONTINUE’ . Default value: "FAILED_BLOCKED</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Block%20meta_store_conf"></a><h3 id="block-meta_store_conf">Block meta_store_conf</h3>

<p>The meta_store_conf mapping supports the following:</p>

<ul>
<li><code>db_url</code> - (Optional, Available in 1.182.0+) Custom rds database connection url.</li>
<li><code>db_user_name</code> - (Optional, Available in 1.182.0+) Custom rds database user name.</li>
<li><code>db_password</code> - (Optional, Available in 1.182.0+) Custom rds database password.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Block%20configs"></a><h3 id="block-configs">Block configs</h3>

<p>The configs mapping supports the following:</p>

<ul>
<li><code>service_name</code> - (Optional, Available in 1.182.0+) Custom configuration service name, e.g. ’HDFS’.</li>
<li><code>file_name</code> - (Optional, Available in 1.182.0+) Custom configuration service file name, e.g. ’hdfs-site’.</li>
<li><code>config_key</code> - (Optional, Available in 1.182.0+) Custom configuration service config key, e.g. ’dfs.replication’.</li>
<li><code>config_value</code> - (Optional, Available in 1.182.0+) Custom configuration service config value, e.g. ’3’.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Block%20modify_cluster_service_config"></a><h3 id="block-modify_cluster_service_config">Block modify_cluster_service_config</h3>

<p>The configs mapping supports the following:</p>

<ul>
<li><code>service_name</code> - (Optional, Available in 1.182.0+) Cluster service configuration modification name, e.g. ’HDFS’.</li>
<li><code>config_params</code> - (Optional, Available in 1.182.0+) Cluster service configuration modification params, e.g. ’{"hdfs-site":{"dfs.replication":"3"}}’.</li>
<li><code>custom_config_params</code> - (Optional, Available in 1.182.0+) Cluster service configuration modification custom params, e.g. ’{"tez-site":{"key":{"Value":"value"}}}’.</li>
<li><code>group_id</code> - (Optional, Available in 1.182.0+) Cluster service configuration modification node group id, e.g. ’G-XXX’.</li>
<li><code>host_instance_id</code> - (Optional, Available in 1.182.0+) Cluster service configuration modification host instance id, e.g. ’i-bp146tnrkq4tcxxxxx’.</li>
<li><code>config_type</code> - (Optional, Available in 1.182.0+) Cluster service configuration modification type.</li>
<li><code>comment</code> - (Optional, Available in 1.182.0+) Cluster service configuration modification comment, e.g. "Modify tez configuration".</li>
<li><code>refresh_host_config</code> - (Optional, Available in 1.182.0+) Cluster service configuration modification refresh host config, ’true’ or ’false’.</li>
<li><code>gateway_cluster_id_list</code> - (Optional, Available in 1.182.0+) Cluster service configuration modification related gateway cluster id list.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Timeouts"></a><h4 id="timeouts">Timeouts</h4>

<p>The <code>timeouts</code> block allows you to specify <a href="https://www.terraform.io/docs/configuration-0-11/resources.html#timeouts">timeouts</a> for certain actions:</p>

<ul>
<li><code>create</code> - (Defaults to 20 mins) Used when creating the cluster (until it reaches the initial <code>IDLE</code> status). </li>
<li><code>delete</code> - (Defaults to 10 mins) Used when terminating the instance.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Attribute%20Reference"></a><h2 id="attribute-reference">Attribute Reference</h2>

<p>The following attributes are exported:</p>

<ul>
<li><code>id</code> - The cluster ID.</li>
</ul>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Import"></a><h2 id="import">Import</h2>

<p>Aliclioud E-MapReduce cluster can be imported using the id e.g.</p>

<div class="codehilite"><pre><span></span><code>$ terraform import alicloud_emr_cluster.default C-B47FB8FE96C67XXXX
</code></pre></div>

            
        
    </body></html>