<html><!-- Online page at https://registry.terraform.io/providers/Azure/azapi/latest/docs/guides/feature_list_resources --><head>
                <title>Feature: List Resources</title>
                <meta charset="utf-8"/>
                <link href="../../../../../../style.css" rel="stylesheet"/>
            </head>
            <body>
                <p>The <code>azapi_resource_list</code> data source is used to list resources in Azure. This data source is useful when you need to get a list of resources that match a specific criteria, such as all virtual machines in a subscription or all storage accounts in a resource group.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/List%20Resources%20by%20Subscription"></a><h2 id="list-resources-by-subscription">List Resources by Subscription</h2>

<p>The following example demonstrates how to list all virtual machines in a subscription:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"azapi_resource_list"</span><span class="w"> </span><span class="nv">"listVirtualMachinesBySubscription"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"Microsoft.Compute/virtualMachines@2020-06-01"</span><span class="w"></span>
<span class="w">  </span><span class="na">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/subscriptions/00000000-0000-0000-0000-000000000000"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>The <code>output</code> attribute contains the result of the query, if default output is enabled(default output feature is introduced and by default enabled in version 2.1.0, you can disable it by setting <code>disable_default_output = true</code>):</p>

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVirtualMachine"</span><span class="w"></span>
<span class="w">      </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myVirtualMachine"</span><span class="w"></span>
<span class="w">      </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Microsoft.Compute/virtualMachines"</span><span class="w"></span>
<span class="w">      </span><span class="na">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"eastus"</span><span class="w"></span>
<span class="w">      </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">      </span><span class="nb">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">        // more properties</span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVirtualMachine2"</span><span class="w"></span>
<span class="w">      </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myVirtualMachine2"</span><span class="w"></span>
<span class="w">      </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Microsoft.Compute/virtualMachines"</span><span class="w"></span>
<span class="w">      </span><span class="na">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"eastus"</span><span class="w"></span>
<span class="w">      </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">      </span><span class="nb">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="c1"></span>
<span class="c1">        // more properties</span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/List%20Resources%20by%20Resource%20Group"></a><h2 id="list-resources-by-resource-group">List Resources by Resource Group</h2>

<p>The following example demonstrates how to list all virtual machines in a resource group:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"azapi_resource_list"</span><span class="w"> </span><span class="nv">"listVirtualMachinesByResourceGroup"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"Microsoft.Compute/virtualMachines@2020-06-01"</span><span class="w"></span>
<span class="w">  </span><span class="na">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/List%20Resources%20by%20Parent%20Resource"></a><h2 id="list-resources-by-parent-resource">List Resources by Parent Resource</h2>

<p>The following example demonstrates how to list all subnets in a virtual network:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"azapi_resource_list"</span><span class="w"> </span><span class="nv">"listSubnetsByVirtualNetwork"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"Microsoft.Network/virtualNetworks/subnets@2020-06-01"</span><span class="w"></span>
<span class="w">  </span><span class="na">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup/providers/Microsoft.Network/virtualNetworks/myVirtualNetwork"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/List%20Extension%20Resources"></a><h2 id="list-extension-resources">List Extension Resources</h2>

<p>The following example demonstrates how to list all role definitions for a storage account:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"azapi_resource_list"</span><span class="w"> </span><span class="nv">"roleDefinitions"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"Microsoft.Authorization/roleDefinitions@2022-04-01"</span><span class="w"></span>
<span class="w">  </span><span class="na">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup/providers/Microsoft.Storage/storageAccounts/myStorageAccount"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Filter%20Resources"></a><h2 id="filter-resources">Filter Resources</h2>

<p>There are several ways to filter resources using the <code>azapi_resource_list</code> data source. You can filter resources by HCL expressions and by using the <code>JMESPath</code> query language.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Filter%20by%20HCL%20Expressions"></a><h3 id="filter-by-hcl-expressions">Filter by HCL Expressions</h3>

<p>With default output enabled, you can filter resources by HCL expressions. For example, to filter virtual machines by location:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"azapi_resource_list"</span><span class="w"> </span><span class="nv">"listVirtualMachinesBySubscription"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"Microsoft.Compute/virtualMachines@2020-06-01"</span><span class="w"></span>
<span class="w">  </span><span class="na">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/subscriptions/00000000-0000-0000-0000-000000000000"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">output</span><span class="w"> </span><span class="nv">"vmIds"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="err">for</span><span class="w"> </span><span class="err">vm</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">data.azapi_resource_list.listVirtualMachinesBySubscription.output.value</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">vm.id</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="nv">vm.location</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s2">"southeastasia"</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>It uses the <code>for</code> expression to iterate over the list of virtual machines and filter them by location.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Filter%20by%20JMESPath"></a><h3 id="filter-by-jmespath">Filter by JMESPath</h3>

<p>You can also filter resources using the <code>JMESPath</code> query language. For example, to filter virtual machines by location:</p>

<div class="codehilite"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">"azapi_resource_list"</span><span class="w"> </span><span class="nv">"listVirtualMachinesBySubscription"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"Microsoft.Compute/virtualMachines@2020-06-01"</span><span class="w"></span>
<span class="w">  </span><span class="na">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/subscriptions/00000000-0000-0000-0000-000000000000"</span><span class="w"></span>
<span class="w">  </span><span class="nb">response_export_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">vmIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"value[?location == 'southeastasia'].id"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">output</span><span class="w"> </span><span class="nv">"vmIds"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.azapi_resource_list.listVirtualMachinesBySubscription.output.vmIds</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>It uses the <code>response_export_values</code> attribute to specify the <code>JMESPath</code> query to filter virtual machines by location. More details about using <code>JMESPath</code> query language to filter resources can be found <a href="./feature_jmes_query.html">here</a>.</p>

            
        
    </body></html>