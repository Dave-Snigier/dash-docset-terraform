<html><!-- Online page at https://www.terraform.io/language/stacks/reference/tfdeploy --><head>
                <title>Deployment configuration file reference</title>
                <meta charset="utf-8"/>
                <link href="../../../../style.css" rel="stylesheet"/>
            </head>
            <body>
                <h1 id="deployment-configuration-file-reference">Deployment configuration file reference</h1>

<p>A deployment configuration file defines how to deploy your Stack's infrastructure. Each Stack deployment runs in its agent, wholly isolated from other Stack deployments.</p>

<p>Every Stack needs a deployment configuration file, <code>tfdeploy.hcl</code>, and this page describes all of the blocks you can use within a deployment configuration file. Note that none of the blocks in the deployment configuration file support <a href="../../../terraform/language/resources/syntax.html#meta-arguments">meta-arguments</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/deployment%20block%20configuration"></a><h2 id="deployment-block-configuration"><code>deployment</code> block configuration</h2>

<p>The <code>deployment</code> block is where you define how many times you want to deploy your Stack's infrastructure. Each Stack requires at least one <code>deployment</code> block, and you can add a new <code>deployment</code> block every time you want to deploy your Stack’s infrastructure again.</p>

<aside class="admonition note">
    <strong>note</strong>
    <em>note</em>
    <p>: HCP Terraform supports up to a maximum of 20 deployments.</p>
</aside>

<p>The following list outlines field hierarchy, language-specific data types, and requirements in the <code>deployment</code> block.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Complete%20configuration"></a><h3 id="complete-configuration">Complete configuration</h3>

<p>When every field is defined, a <code>deployment</code> block has the following form:</p>

<div class="codehilite"><pre><span></span><code><span class="err">deployment</span><span class="w"> </span><span class="s2">"unique_name"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">key</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"value"</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>For examples and guidance on defining deployments, refer to <a href="../../../terraform/language/stacks/deploy/config.html">Define deployment configuration</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specification"></a><h3 id="specification">Specification</h3>

<p>This section details the fields you can configure in the <code>deployment</code> block.</p>

<p>Each Stack must have at least one <code>deployment</code> block, and the label of the <code>deployment</code> block must be unique within your Stack. The <code>deployment</code> block is a map that defines the appropriate input values for each Stack instance to deploy.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
  <th style="text-align:left;">Required</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>inputs</code></td>
  <td style="text-align:left;">A mapping of Stack variable names for this deployment.  The keys in this map must correspond to the names of variables defined in the Stack. The values must be valid HCL literals meeting the type constraint of those variables.</td>
  <td style="text-align:left;">map</td>
  <td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Reference"></a><h3 id="reference">Reference</h3>

<p>For example, the following <code>deployment</code> block accepts inputs for variables named <code>aws_region</code> and <code>instance_count</code> and creates a new deployment in HCP Terraform named “production”.</p>

<div class="codehilite"><pre><span></span><code><span class="err">deployment</span><span class="w"> </span><span class="s2">"production"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nb">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="na">aws_region</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"us-west-1"</span><span class="w"></span>
<span class="w">        </span><span class="na">instance_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>To learn more about defining deployments, refer to <a href="../../../terraform/language/stacks/deploy/config.html">Define deployment configuration</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/orchestrate%20block%20configuration"></a><h2 id="orchestrate-block-configuration"><code>orchestrate</code> block configuration</h2>

<p>The orchestrate block defines orchestration rules that you can use to manage your deployment plans. Your orchestration rules can automate tasks like auto-approving plans that meet specific conditions.</p>

<p>The following list outlines field hierarchy, language-specific data types, and requirements in the <code>orchestrate</code> block.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Complete%20configuration"></a><h3 id="complete-configuration-2">Complete configuration</h3>

<p>When every field is defined, an <code>orchestrate</code> block has the following form:</p>

<div class="codehilite"><pre><span></span><code><span class="c1"># auto_approve is the rule type</span>
<span class="err">orchestrate</span><span class="w"> </span><span class="s2">"auto_approve" "name_of_check"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">check</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">&lt;the</span><span class="w"> </span><span class="err">condition</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">HCP</span><span class="w"> </span><span class="err">Terraform</span><span class="w"> </span><span class="err">evaluates&gt;</span><span class="w"></span>
<span class="w">    </span><span class="na">reason</span><span class="w"> </span><span class="o">=</span><span class="s2">"Provide the reason why this check failed."</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>The <code>orchestrate</code> block label includes the rule type and the rule name, which together must be unique within the Stack.</p>

<p>There are two orchestration rules to choose from:</p>

<ul>
<li>The <code>auto_approve</code> rule executes after a Stack creates a plan and automatically approves a plan if all checks pass.</li>
<li>The <code>replan</code> rule executes after a Stack applies a plan, automatically triggering a replan if all the checks pass.</li>
</ul>

<p>HCP Terraform evaluates the <code>check</code> blocks within your <code>orchestrate</code> block to determine if it should approve a plan. If all of the checks pass, then HCP Terraform approves the plan for you. If one or more <code>conditions</code> do not pass, then HCP Terraform shows the <code>reason</code> why, and you must manually approve that plan.</p>

<p>By default, each Stack has an <code>auto_approve</code> rule named <code>empty_plan</code>, which automatically approves a plan if it contains no changes.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specification"></a><h3 id="specification-2">Specification</h3>

<p>This section provides details about the fields you can configure in the <code>orchestrate</code> block.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
  <th style="text-align:left;">Required</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>check</code></td>
  <td style="text-align:left;">A block containing conditions and reasons for the orchestration rule. All checks must pass for an orchestration rule to be triggered.</td>
  <td style="text-align:left;">block</td>
  <td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<p>The <code>check</code> block contains the following configurable fields.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
  <th style="text-align:left;">Required</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>condition</code></td>
  <td style="text-align:left;">An expression that determines whether the check passes.</td>
  <td style="text-align:left;">expression</td>
  <td style="text-align:left;">Required</td>
</tr>
<tr>
  <td style="text-align:left;"><code>reason</code></td>
  <td style="text-align:left;">A message explaining why the check failed is shown in HCP Terraform, prompting you to manually approve a plan.</td>
  <td style="text-align:left;">string</td>
  <td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Orchestration%20Context"></a><h3 id="orchestration-context">Orchestration Context</h3>

<p>A <code>check</code> block’s <code>condition</code> field has access to a <code>context</code> variable, which includes information about the context of the current deployment plan. The <code>context</code> variable contains the following fields.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>operation</code></td>
  <td style="text-align:left;">The current operation HCP Terraform is performing.</td>
  <td style="text-align:left;">string ("plan" or "apply")</td>
</tr>
<tr>
  <td style="text-align:left;"><code>success</code></td>
  <td style="text-align:left;">Indicates whether the operation failed. If this field is <code>false</code>, then the <code>errors</code> field contains the message of why the operation failed.</td>
  <td style="text-align:left;">boolean</td>
</tr>
<tr>
  <td style="text-align:left;"><code>plan</code></td>
  <td style="text-align:left;">An object including data about the current plan.</td>
  <td style="text-align:left;">object</td>
</tr>
<tr>
  <td style="text-align:left;"><code>errors</code></td>
  <td style="text-align:left;">A set of diagnostic error message objects.</td>
  <td style="text-align:left;">set of objects</td>
</tr>
<tr>
  <td style="text-align:left;"><code>warnings</code></td>
  <td style="text-align:left;">A set of diagnostic warning message objects.</td>
  <td style="text-align:left;">set of objects</td>
</tr>
</tbody>
</table>

<p>The diagnostic message objects that the <code>context.errors</code> and <code>context.warnings</code> fields return includes the following information.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>summary</code></td>
  <td style="text-align:left;">A brief summary of the diagnostic message</td>
  <td style="text-align:left;">string</td>
</tr>
<tr>
  <td style="text-align:left;"><code>detail</code></td>
  <td style="text-align:left;">Detailed information about the diagnostic message</td>
  <td style="text-align:left;">string</td>
</tr>
</tbody>
</table>

<p>The <code>context.plan</code> field returns an object including the following fields.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>mode</code></td>
  <td style="text-align:left;">The plan mode.</td>
  <td style="text-align:left;">string ("normal", "refresh-only", or "destroy")</td>
</tr>
<tr>
  <td style="text-align:left;"><code>applyable</code></td>
  <td style="text-align:left;">Whether or not the plan can be applied.</td>
  <td style="text-align:left;">boolean</td>
</tr>
<tr>
  <td style="text-align:left;"><code>changes</code></td>
  <td style="text-align:left;">A change summary object.</td>
  <td style="text-align:left;">object</td>
</tr>
<tr>
  <td style="text-align:left;"><code>component_changes</code></td>
  <td style="text-align:left;">A map of change summary objects for each component instance.</td>
  <td style="text-align:left;">map of objects</td>
</tr>
<tr>
  <td style="text-align:left;"><code>replans</code></td>
  <td style="text-align:left;">The number of replans in this plan's sequence, starting at <code>0</code>.</td>
  <td style="text-align:left;">integer</td>
</tr>
<tr>
  <td style="text-align:left;"><code>deployment</code></td>
  <td style="text-align:left;">A direct reference to the current deployment.</td>
  <td style="text-align:left;">Deployment object containing a <code>deployment_name</code> field.</td>
</tr>
</tbody>
</table>

<p>The objects in the <code>context.plan.component_changes</code> field include the following fields.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>add</code></td>
  <td style="text-align:left;">Number of resources to be added.</td>
  <td style="text-align:left;">integer</td>
</tr>
<tr>
  <td style="text-align:left;"><code>change</code></td>
  <td style="text-align:left;">Number of resources to be changed.</td>
  <td style="text-align:left;">integer</td>
</tr>
<tr>
  <td style="text-align:left;"><code>import</code></td>
  <td style="text-align:left;">Number of resources to be imported.</td>
  <td style="text-align:left;">integer</td>
</tr>
<tr>
  <td style="text-align:left;"><code>remove</code></td>
  <td style="text-align:left;">Number of resources to be removed.</td>
  <td style="text-align:left;">integer</td>
</tr>
<tr>
  <td style="text-align:left;"><code>total</code></td>
  <td style="text-align:left;">Total number of resource actions.</td>
  <td style="text-align:left;">integer</td>
</tr>
</tbody>
</table>

<p>The object in the <code>context.plan.deployment</code> field includes the following fields.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>deployment_name</code></td>
  <td style="text-align:left;">The name of the current deployment HCP Terraform is running this plan on.  You can use this field to check which deployment is running this plan. For example, you can check if this plan is on your production deployment: <code>context.plan.deployment == deployment.production</code>.</td>
  <td style="text-align:left;">string</td>
</tr>
</tbody>
</table>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Reference"></a><h3 id="reference-2">Reference</h3>

<p>For example, the following <code>orchestrate</code> block automatically approves deployments if a component has not changed.</p>

<div class="codehilite"><pre><span></span><code><span class="err">orchestrate</span><span class="w"> </span><span class="s2">"auto_approve" "no_pet_changes"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">check</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">context.plan.component_changes</span><span class="p">[</span><span class="s2">"component.pet"</span><span class="p">].</span><span class="na">total</span><span class="w"> </span><span class="o">=</span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="w">    </span><span class="na">reason</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"Changes proposed to pet component."</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>If nothing changes in the <code>component.pet</code> component, HCP Terraform automatically approves the plan.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/identity_token%20block%20configuration"></a><h2 id="identity_token-block-configuration"><code>identity_token</code> block configuration</h2>

<p>The <code>identity_token</code> block defines a JSON Web Token (JWT) that Terraform generates for a given deployment if that <code>deployment</code> block references an <code>identity_token</code> in its <code>inputs</code>.</p>

<p>You can directly pass the token generated by the <code>identity_token</code> block to a provider's configuration for OIDC authentication. For more information on authenticating a Stack using OIDC, refer to <a href="../../../terraform/language/stacks/deploy/authenticate.html">Authenticate a Stack</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Complete%20configuration"></a><h3 id="complete-configuration-3">Complete configuration</h3>

<p>When every field is defined, an <code>identity_token</code> block has the following form:</p>

<div class="codehilite"><pre><span></span><code><span class="err">identity_token</span><span class="w"> </span><span class="s2">"unique_to_stack_name"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"audience this token is intended for"</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specification"></a><h3 id="specification-3">Specification</h3>

<p>This section provides details about the fields you can configure in the <code>identity_token</code> block.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
  <th style="text-align:left;">Required</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>audience</code></td>
  <td style="text-align:left;">The audience of your token is the resource(s) that uses this token after Terraform generates it. You specify an audience to ensure that the cloud service authorizing the workload is confident that the token you present is intended for that service.</td>
  <td style="text-align:left;">set of strings</td>
  <td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Reference"></a><h3 id="reference-3">Reference</h3>

<p>Once defined, you can reference an identity token's <code>jwt</code> attribute in a deployment's inputs. For example, below we generate a token for a particular role ARN in AWS.</p>

<div class="codehilite"><pre><span></span><code><span class="c1"># main.tfdeploy.hcl</span>
<span class="err">identity_token</span><span class="w"> </span><span class="s2">"aws"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">"aws.workload.identity"</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="err">deployment</span><span class="w"> </span><span class="s2">"staging"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">aws_region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"eu-west-1"</span><span class="w"></span>
<span class="w">    </span><span class="na">role_arn</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"arn:aws:iam::123456789101:role/my-oidc-role"</span><span class="w"></span>
<span class="w">    </span><span class="na">aws_token</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">identity_token.aws.jwt</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Terraform generates an identity token that you can use in your Stack configuration to configure your AWS provider with your role in AWS.</p>

<div class="codehilite"><pre><span></span><code><span class="c1"># providers.tfstack.hcl</span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">"aws_token"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="w">  </span><span class="na">ephemeral</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">"aws_region"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">variable</span><span class="w"> </span><span class="nv">"aws_role"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kr">provider</span><span class="w"> </span><span class="nc">"aws"</span><span class="w"> </span><span class="nv">"this"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">config</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.aws_region</span><span class="w"></span>
<span class="w">    </span><span class="nb">assume_role_with_web_identity</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="na">role_arn</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="nv">var.aws_role</span><span class="w"></span>
<span class="w">      </span><span class="na">web_identity_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.aws_token</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>With this setup, every time your <code>staging</code> deployment performs a plan or apply operation, we authenticate with AWS using your established ARN role and a new JWT token. For more information on authenticating a Stack using OIDC, refer to <a href="../../../terraform/language/stacks/authenticate.html">Authenticate a Stack</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/store%20block%20configuration"></a><h2 id="store-block-configuration"><code>store</code> block configuration</h2>

<p>Use the <code>store</code> block to define key-value secrets in your deployment configuration. After storing a secret, you can reference it in your deployment block input variable values.</p>

<p>When you define a <code>store</code> block, you define two headers: the first specifies the store type, and the second is the store's name.</p>

<p>When every field is defined, a <code>store</code> block has the following form.</p>

<div class="codehilite"><pre><span></span><code><span class="err">store</span><span class="w"> </span><span class="s2">"store_type" "store_name"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="err">&lt;store</span><span class="w"> </span><span class="err">type</span><span class="w"> </span><span class="err">specific</span><span class="w"> </span><span class="err">arguments&gt;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>A store’s type defines where Terraform should look for that store’s credentials and how to decode the credentials it finds. You cannot share arguments across store types.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/varset%20specification%20and%20configuration"></a><h3 id="varset-specification-and-configuration"><code>varset</code> specification and configuration</h3>

<p>Use the <code>varset</code> store to enable your Stacks to access <a href="../../../terraform/cloud-docs/workspaces/variables/managing-variables.html#variable-sets">variable sets</a> in HCP Terraform. Your Stack must have access to the variable set you are targeting, meaning it must be globally available or assigned to the project containing your Stack.</p>

<p>This section details the fields you can configure in the <code>store</code> block that uses the <code>varset</code> store type.</p>

<div class="codehilite"><pre><span></span><code><span class="err">store</span><span class="w"> </span><span class="s2">"varset" "store_name"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;variable_set_id&gt;"</span><span class="w"></span>
<span class="w">  </span><span class="na">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">&lt;</span><span class="s2">"terraform" or "env"</span><span class="err">&gt;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>The <code>varset</code> store type accepts the following fields.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
  <th style="text-align:left;">Required</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>id</code></td>
  <td style="text-align:left;">The external ID of the variable set you want to access.</td>
  <td style="text-align:left;">string</td>
  <td style="text-align:left;">Required</td>
</tr>
<tr>
  <td style="text-align:left;"><code>category</code></td>
  <td style="text-align:left;">The <code>category</code> argument specifies whether to use Terraform or environment variables from the variable set. Specify "terraform" or "env" depending on the variable you want to access.</td>
  <td style="text-align:left;">string</td>
  <td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<p>The <code>store.varset</code> block can only use a variable set’s Terraform or environment variables. You can define two <code>store</code> blocks if you need to access Terraform and environment variables in your deployment configuration.</p>

<div class="codehilite"><pre><span></span><code><span class="err">store</span><span class="w"> </span><span class="s2">"varset" "tokens"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"varset-###"</span><span class="w"></span>
<span class="w">  </span><span class="na">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"terraform"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="err">store</span><span class="w"> </span><span class="s2">"varset" "available_regions"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"varset-###"</span><span class="w"></span>
<span class="w">  </span><span class="na">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"env"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="err">deployment</span><span class="w"> </span><span class="s2">"main"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">regions</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">store.varset.available_regions.regions</span><span class="w"></span>
<span class="w">    </span><span class="na">tfe_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">store.varset.tokens.tfe_token</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You can access specific environment variables by key from the <code>store.varset.available_regions</code> store, and you can access specific Terraform variables by key using the <code>store.varset.tokens</code> store.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Reference"></a><h3 id="reference-4">Reference</h3>

<p>For example, if you have an HCP Terraform <a href="../../../terraform/cloud-docs/workspaces/variables/managing-variables.html#variable-sets">variable set</a> that contains a value you want to use in your deployment, you can create a <code>store</code> block to access that variable set.</p>

<div class="codehilite"><pre><span></span><code><span class="err">store</span><span class="w"> </span><span class="s2">"varset" "tokens"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">"&lt;variable_set_id&gt;"</span><span class="w"></span>
<span class="w">  </span><span class="na">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"terraform"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="err">deployment</span><span class="w"> </span><span class="s2">"main"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">store.varset.tokens.example_token</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>You cannot access an entire store and must specifically access individual keys within that store. Meaning, we can access your example’s <code>example_token</code> variable by accessing the store’s <code>varset</code> type, <code>store.varset</code>, then accessing the specific store, <code>store.varset.tokens.example_token</code>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/locals%20block%20configuration"></a><h2 id="locals-block-configuration"><code>locals</code> block configuration</h2>

<p>A local value assigns a name to an expression, so you can use the name multiple times within your Stack configuration instead of repeating the expression. The <code>locals</code> block works exactly as it does in traditional Terraform configurations. Learn more about <a href="../../../terraform/language/values/locals.html">the <code>locals</code> block</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/publish_output%20block%20configuration"></a><h2 id="publish_output-block-configuration"><code>publish_output</code> block configuration</h2>

<p>The <code>publish_output</code> block requires at least Terraform version <code>terraform_1.10.0-alpha20241009</code> or higher. Download <a href="https://releases.hashicorp.com/terraform/">latest version of Terraform</a> to use the most up-to-date functionality.</p>

<p>The <code>publish_output</code> block specifies a value to export from your current Stack, which other Stacks in the same project can consume. Declare one <code>publish_output</code> block for each value to export from your Stack.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Complete%20configuration"></a><h3 id="complete-configuration-4">Complete configuration</h3>

<p>When every field is defined, a <code>publish_output</code> block has the following form:</p>

<p><codeblockconfig hideclipboard=""></codeblockconfig></p>

<div class="codehilite"><pre><span></span><code><span class="err">publish_</span><span class="kr">output</span><span class="w"> </span><span class="nv">"output_name"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Description of the purpose of this output"</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">deployment.deployment_name.some_value</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p></p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specification"></a><h3 id="specification-4">Specification</h3>

<p>This section provides details about the fields you can configure in the output block.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
  <th style="text-align:left;">Required</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>description</code></td>
  <td style="text-align:left;">A human-friendly description for the output.</td>
  <td style="text-align:left;">string</td>
  <td style="text-align:left;">Optional</td>
</tr>
<tr>
  <td style="text-align:left;"><code>value</code></td>
  <td style="text-align:left;">The value to output.</td>
  <td style="text-align:left;">any</td>
  <td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Reference"></a><h3 id="reference-5">Reference</h3>

<p>For example, you could output the VPC ID from your networking deployment, making it available to other Stacks to input.</p>

<p><codeblockconfig filename="network.tfdeploy.hcl"></codeblockconfig></p>

<div class="codehilite"><pre><span></span><code><span class="c1"># Network Stack's deployment configuration</span>

<span class="err">publish_</span><span class="kr">output</span><span class="w"> </span><span class="nv">"vpc_id"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"The networking Stack's VPC's ID."</span><span class="w"></span>
<span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">deployment.network.vpc_id</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p></p>

<p>To learn more about passing information between Stacks, refer to <a href="../../../terraform/language/stacks/deploy/pass-data.html">Pass data from one Stack to another</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/upstream_input%20block%20configuration"></a><h2 id="upstream_input-block-configuration"><code>upstream_input</code> block configuration</h2>

<p>The <code>upstream_input</code> block requires at least Terraform version <code>terraform_1.10.0-alpha20241009</code> or higher. Download <a href="https://releases.hashicorp.com/terraform/">latest version of Terraform</a> to use the most up-to-date functionality.</p>

<p>The <code>upstream_input</code> block specifies another Stack in the same project to consume outputs from. Declare an <code>upstream_input</code> block for each Stack you want to reference. If an output from a upstream Stack changes, HCP Terraform automatically triggers runs for any Stacks that depend on those outputs.</p>

<p>To learn more about passing information between Stacks, refer to <a href="../../../terraform/language/stacks/deploy/link-stacks.html">Pass data from one Stack to another</a>.</p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Complete%20configuration"></a><h3 id="complete-configuration-5">Complete configuration</h3>

<p>When every field is defined, an <code>upstream_input</code> block has the following form:</p>

<p><codeblockconfig hideclipboard=""></codeblockconfig></p>

<div class="codehilite"><pre><span></span><code><span class="err">upstream_input</span><span class="w"> </span><span class="s2">"upstream_stack_name"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"stack"</span><span class="w"></span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"app.terraform.io/{organization_name}/{project_name}/{upstream_stack_name}"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p></p>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Specification"></a><h3 id="specification-5">Specification</h3>

<p>This section provides details about the fields you can configure in the <code>upstream_input</code> block.</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Field</th>
  <th style="text-align:left;">Description</th>
  <th style="text-align:left;">Type</th>
  <th style="text-align:left;">Required</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code>type</code></td>
  <td style="text-align:left;">The only supported type is “stack”.</td>
  <td style="text-align:left;">string</td>
  <td style="text-align:left;">Required</td>
</tr>
<tr>
  <td style="text-align:left;"><code>source</code></td>
  <td style="text-align:left;">The upstream Stack’s URL, in the format: <code>"app.terraform.io/{organization_name}/{project_name}/{upstream_stack_name}"</code></td>
  <td style="text-align:left;">string</td>
  <td style="text-align:left;">Required</td>
</tr>
</tbody>
</table>

<a class="dashAnchor" name="//apple_ref/cpp/Section/Reference"></a><h3 id="reference-6">Reference</h3>

<p>For example, you could input a VPC ID from an upstream Stack that manages your shared networking service. You can use the <code>upstream_input</code> block to pass information from your network Stack into your application Stack.</p>

<p><codeblockconfig filename="application.tfdeploy.hcl"></codeblockconfig></p>

<div class="codehilite"><pre><span></span><code><span class="c1"># Application Stack's deployment configuration</span>

<span class="err">upstream_input</span><span class="w"> </span><span class="s2">"network_stack"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">"stack"</span><span class="w"></span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"app.terraform.io/hashicorp/Default Project/networking-stack"</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="err">deployment</span><span class="w"> </span><span class="s2">"application"</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nb">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="na">vpc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">upstream_input.network_stack.vpc_id</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p></p>

<p>Your application Stack can now securely consume and use outputs from your network Stack. To learn more about passing information between Stacks, reference <a href="../../../terraform/language/stacks/deploy/pass-data.html">Pass data from one Stack to another</a>.</p>

            
        
    </body></html>